var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,s){function a(t){try{h(n.next(t))}catch(e){s(e)}}function o(t){try{h(n["throw"](t))}catch(e){s(e)}}function h(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(a,o)}h((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(r)throw new TypeError("Generator is already executing.");for(;h;)try{if(r=1,s&&(a=s[2&i[0]?"return":i[0]?"throw":"next"])&&!(a=a.call(s,i[1])).done)return a;switch(s=0,a&&(i=[0,a.value]),i[0]){case 0:case 1:a=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,s=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(a=h.trys,!(a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){h.label=i[1];break}if(6===i[0]&&h.label<a[1]){h.label=a[1],a=i;break}if(a&&h.label<a[2]){h.label=a[2],h.ops.push(i);break}a[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(n){i=[6,n],s=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,s,a,o,h={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},BaseEuiLayer=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.percentWidth=100,e.percentHeight=100,e.touchEnabled=!1,e}return __extends(e,t),e}(eui.Group);__reflect(BaseEuiLayer.prototype,"BaseEuiLayer");var BaseView=function(t){function e(){var e=t.call(this)||this;return e.event=[],e.addEvent(egret.Event.COMPLETE,e,e.euiCompete),e}return __extends(e,t),e.prototype.addTouchEvent=function(t,e){this.addEvent(egret.TouchEvent.TOUCH_TAP,t,e)},e.prototype.addTouchEndEvent=function(t,e){this.addEvent(egret.TouchEvent.TOUCH_END,t,e)},e.prototype.addChangeEvent=function(t,e){this.addEvent(egret.TouchEvent.CHANGE,t,e)},e.prototype.addEvent=function(t,e,i){if(!e){var n=this.skinName+".exml文件错误";return console.error(n),void alert(n)}e.addEventListener(t,i,this),this.event.push([t,i,e])},e.prototype.removeTouchEvent=function(t,e){t.removeEventListener(egret.TouchEvent.TOUCH_TAP,e,this)},e.prototype.removeEvents=function(){for(var t=0,e=this.event;t<e.length;t++){var i=e[t];i[2].removeEventListener(i[0],i[1],this)}},e.prototype.euiCompete=function(){},e.prototype.$onClose=function(){var t=function(i){for(var n=0;n<i.numChildren;n++){var r=i.getChildAt(n);r instanceof e?r.$onClose():r instanceof egret.DisplayObjectContainer&&t(r)}};t(this),this.removeEvents()},e.prototype.bindLogic=function(t,e){t.__proto__=e},e}(eui.Component);__reflect(BaseView.prototype,"BaseView");var DisplayMapObject=function(t){function e(){var e=t.call(this)||this;return e.nStaticLevel=0,e.nDynamicLevel=1,e.nOffsetX=0,e.nOffsetY=0,e.nStartMoveTick=0,e.nTargetX=void 0,e.nTargetY=void 0,e.onMoveing=!1,e.getTimer=egret.getTimer,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAdded,e),e}return __extends(e,t),e.prototype.onAdded=function(t){var e=this.calcDisplayIndex(this.parent);this.parent.addChildAt(this,e)},e.prototype.setCurrentXY=function(t,e){(t!=this.nCurrentX||e!=this.nCurrentY)&&this.sortOnContainer(this.nCurrentX,t,this.nCurrentY,e),this.nCurrentX=t,this.nCurrentY=e},Object.defineProperty(e.prototype,"currentX",{get:function(){return this.nCurrentX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentY",{get:function(){return this.nCurrentY},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distX",{get:function(){return void 0!=this.nTargetX?this.nTargetX:this.nCurrentX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distY",{get:function(){return void 0!=this.nTargetY?this.nTargetY:this.nCurrentY},enumerable:!0,configurable:!0}),e.prototype.setPosition=function(t,i){t==this.nCurrentX&&i==this.nCurrentY||!this.parent||this.sortOnContainer(this.nCurrentX,t,this.nCurrentY,i),this.setCurrentXY(t,i),this.x=(this.nCurrentX+.5)*e.MAP_CELL_WIDE+this.nOffsetX,this.y=(this.nCurrentY+.5)*e.MAP_CELL_HIDE+this.nOffsetY},e.prototype.setOffset=function(t,e){this.nOffsetX=t,this.nOffsetY=e},e.prototype.moveTo=function(t,i,n){return this.nTargetX==t&&this.nTargetY==i?!1:(this.onMoveing=!0,this.nTargetX=t,this.nTargetY=i,this.nStartMoveTick=this.getTimer(),this.nEndMoveTick=this.nStartMoveTick+n,this.nSteppingX=(this.nTargetX-this.nCurrentX)*e.MAP_CELL_WIDE/n,this.nSteppingY=(this.nTargetY-this.nCurrentY)*e.MAP_CELL_HIDE/n,!0)},e.prototype.processMove=function(t){if(!(this.nStartMoveTick<=0)){if(t>this.nEndMoveTick)return void this.endMove();var i=t-this.nStartMoveTick;this.x=(this.nCurrentX+.5)*e.MAP_CELL_WIDE+this.nSteppingX*i+this.nOffsetX,this.y=(this.nCurrentY+.5)*e.MAP_CELL_HIDE+this.nSteppingY*i+this.nOffsetY}},e.prototype.endMove=function(t){void 0===t&&(t=!0),this.onMoveing=!1,this.nStartMoveTick>0&&void 0!=this.nTargetX&&void 0!=this.nTargetY&&t?this.setPosition(this.nTargetX,this.nTargetY):(this.nTargetX=Math.floor(this.x/e.MAP_CELL_WIDE),this.nTargetY=Math.floor(this.y/e.MAP_CELL_HIDE),this.setPosition(this.nTargetX,this.nTargetY)),this.nEndMoveTick=this.getTimer(),this.nStartMoveTick=0,this.nTargetX=void 0,this.nTargetY=void 0},Object.defineProperty(e.prototype,"isMoving",{get:function(){return this.onMoveing},enumerable:!0,configurable:!0}),e.prototype.calcDisplayIndex=function(t){for(var e,i=t.numChildren-1;i>-1;)if(e=t.getChildAt(i),e!=this){if(e.nStaticLevel<this.nStaticLevel)break;if(e.nStaticLevel==this.nStaticLevel){if(e.nCurrentY<this.nCurrentY)break;if(e.nCurrentY==this.nCurrentY){if(e.nDynamicLevel<this.nDynamicLevel)break;if(e.nDynamicLevel==this.nDynamicLevel&&e.nCurrentX>this.nCurrentX)break}}i--}else i--;return i+1},Object.defineProperty(e.prototype,"depthPriority",{set:function(t){if(this.nStaticLevel!=t&&(this.nStaticLevel=t,this.parent)){var e=this.calcDisplayIndex(this.parent);this.parent.addChildAt(this,e)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dynamicLevel",{set:function(t){this.nDynamicLevel=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e){},e.prototype.distance=function(t,e,i){if(!t)return Math.max(Math.abs(e-this.distX),Math.abs(i-this.distY));var e=Math.abs(t.distX-this.distX),i=Math.abs(t.distY-this.distY);return e>i?e:i},e.prototype.getDirctionByTarget=function(t){var i=0,n=t.distX-this.nCurrentX,r=t.distY-this.nCurrentY,s=new egret.Point(Math.abs(n)/n,Math.abs(r)/r);for(i;i<e.DIR_LS.length;i++)if(e.DIR_LS[i].x==s.x&&e.DIR_LS[i].y==s.y)return i;return 0},e.prototype.countAngle2=function(t){return 180*Math.atan2(t.y-50-this.y,t.x-this.x)/Math.PI},e.prototype.countAngle=function(t,e,i){if(t.distX==this.nCurrentX&&t.distY==this.nCurrentY&&void 0!=e)return e;var n=Math.atan2(t.distY-this.nCurrentY,t.distX-this.nCurrentX)+Math.PI/2;return n=180*n/Math.PI,n=(720+n)%360,i||(n=7&Math.round(n/45)),n},e.prototype.countTargetDirection=function(t,e){var i=Math.abs(this.currentX-t.distX),n=Math.abs(this.currentY-t.distY);if(n>i){if(t.distY>this.currentY)return 4;if(t.distY<this.currentY)return 0}else{if(!(i>n))return t.distX>this.currentX?t.distY>this.currentY?3:1:t.distX<this.currentX?t.distY>this.currentY?5:7:0==i&&void 0!=e?e:5;if(t.distX>this.currentX)return 2;if(t.distX<this.currentX)return 6}return 0},e.prototype.countPointDirection=function(t,e){var i=Math.abs(this.currentX-t.x),n=Math.abs(this.currentY-t.y);if(n>i){if(t.y>this.currentY)return 4;if(t.y<this.currentY)return 0}else{if(!(i>n))return t.x>this.currentX?t.y>this.currentY?3:1:t.x<this.currentX?t.y>this.currentY?5:7:0==i&&void 0!=e?e:5;if(t.x>this.currentX)return 2;if(t.x<this.currentX)return 6}return 0},e.prototype.sortOnContainer=function(t,e,i,n){var r;if(this.parent){var s=this.parent.numChildren,a=this.parent.getChildIndex(this),o=a;if(i>n){for(o--;o>-1&&(r=this.parent.getChildAt(o),!(r.nStaticLevel<this.nStaticLevel));){if(r.nStaticLevel==this.nStaticLevel){if(r.nCurrentY<n)break;if(r.nCurrentY==n){if(r.nDynamicLevel<this.nDynamicLevel)break;if(r.nDynamicLevel==this.nDynamicLevel&&r.nCurrentX>e)break}}o--}o++}else if(n>i){for(o++;s>o&&(r=this.parent.getChildAt(o),!(r.nStaticLevel>this.nStaticLevel));){if(r.nStaticLevel==this.nStaticLevel){if(r.nCurrentY>n)break;if(r.nCurrentY==n){if(r.nDynamicLevel>this.nDynamicLevel)break;if(r.nDynamicLevel==this.nDynamicLevel&&r.nCurrentX<e)break}}o++}o--}else if(t>e){for(o++;s>o&&(r=this.parent.getChildAt(o),!(r.nStaticLevel>this.nStaticLevel));){if(r.nStaticLevel==this.nStaticLevel){if(r.nCurrentY>n)break;if(r.nCurrentY==n){if(r.nDynamicLevel>this.nDynamicLevel)break;if(r.nDynamicLevel==this.nDynamicLevel&&r.nCurrentX<e)break}}o++}o--}else if(e>t){for(o--;o>-1&&(r=this.parent.getChildAt(o),!(r.nStaticLevel<this.nStaticLevel));){if(r.nStaticLevel==this.nStaticLevel){if(r.nCurrentY<n)break;if(r.nCurrentY==n){if(r.nDynamicLevel<this.nDynamicLevel)break;if(r.nDynamicLevel==this.nDynamicLevel&&r.nCurrentX>e)break}}o--}o++}o!=a&&this.parent.setChildIndex(this,o)}},e.calcForwardPosition=function(t,e,i,n){switch(i){case 0:return new egret.Point(t,e-n);case 1:return new egret.Point(t+n,e-n);case 2:return new egret.Point(t+n,e);case 3:return new egret.Point(t+n,e+n);case 4:return new egret.Point(t,e+n);case 5:return new egret.Point(t-n,e+n);case 6:return new egret.Point(t-n,e);case 7:return new egret.Point(t-n,e-n);default:throw new Error("计算前方位置时传递了无效的方向:"+i)}},e.jumpDestXY=function(t,i,n,r){for(var s,a=new egret.Point(t,i),o=0;r>o&&(s=e.calcForwardPosition(a.x,a.y,n,1),MapVo.ins.moveable(s.x,s.y));o++)a.x=s.x,a.y=s.y;return s=null,a},e.MAP_CELL_WIDE=48,e.MAP_CELL_HIDE=32,e.MAP_IMG_WIDE=256,e.MAP_IMG_HIDE=256,e.MAPCELLUNITWIDTH_DEN=1/48,e.MAPCELLUNITHEIGHT_DEN=1/32,e.MINMAP_SCALE=6,e.DIR_LS=[new egret.Point(0,-1),new egret.Point(1,-1),new egret.Point(1,0),new egret.Point(1,1),new egret.Point(0,1),new egret.Point(-1,1),new egret.Point(-1,0),new egret.Point(-1,-1)],e}(egret.DisplayObjectContainer);__reflect(DisplayMapObject.prototype,"DisplayMapObject");var BaseClass=function(){function t(){}return t.ins=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this;return i._instance||(i._instance=new(i.bind.apply(i,[void 0].concat(t))),i._instance.initEvent()),i._instance},t.prototype.initEvent=function(){},t}();__reflect(BaseClass.prototype,"BaseClass");var BaseEuiView=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!1,e.percentWidth=100,e.percentHeight=100,e}return __extends(e,t),e.prototype.isShow=function(){return null!=this.stage&&this.visible},e.prototype.addToParent=function(t){t.addChild(this)},e.prototype.removeFromParent=function(t){this.destroy()},e.prototype.destroy=function(){null!=!this.parent&&this.parent.removeChild(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.win&&(this.newCloseBtn01=this.win.newCloseBtn01,this.newCloseBtn00=this.win.newCloseBtn00,this.newCloseBtn01&&(this.addChild(this.newCloseBtn01),this.addTouchEvent(this.newCloseBtn01,this.closeCall),UIDmgr.bindingUID(this.newCloseBtn01,uid.back2)),this.newCloseBtn00&&(this.addChild(this.newCloseBtn00),this.addTouchEvent(this.newCloseBtn00,this.closeCall),UIDmgr.bindingUID(this.newCloseBtn00,uid.back0)))},e.prototype.closeCall=function(){ViewManager.ins().close(this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!0},e}(BaseView);__reflect(BaseEuiView.prototype,"BaseEuiView");var BaseActor=function(t){function e(e,i){var n=t.call(this)||this;return n.handleId=0,n.selected=0,n.distanceByTarget=Number.MAX_VALUE,n.nBodyid=0,n.nWeaponId=0,n.nWingId=0,n.nMoveSpeed=300,n.nActionSpeed=250,n.nAttackSpeed=500,n.nReadySpeed=0,n.nDie=!1,n._sleep=!0,n.canBeAttacked=!0,n.nTargeter=null,n.nLockTarget=null,n.nDirection=0,n._delayShow=-1,n.receiveTime=0,n._dirLayerList=new Array,n.nPlayingType=ActionType.STAND,n.nActionTick=-1,n.readytime=0,n.delayHitHandle=-1,n.delayFilters=0,n.targetHandle=0,n.globalPosition=new egret.Point(0,0),n.rect=new egret.Rectangle,n.mabiArr=[],n.skills=[],n.useingSkill=[],n.nShadow=new eui.Image,n.nShadow.source=ResMgr.getGameOtherPng("shadow"),n.nShadow.x=-46,n.nShadow.y=-32,n.addChild(n.nShadow),n.nRace=e,n.nAIRate=i,n.direction=0,n.nTargetPoint=new egret.Point(-1,-1),n.nEffectlst=new Array,n.nActionTypeQueue=new Array,n.nActionEffectQueue=new Array,n.effectQueueParm=[],n.nBuffs=new Array,n.nBodyclip||(n.nBodyclip=new clips.BmpClip),n.nHPBar=new ActorHPBar,n.nHPBar.y=-109,n.nWeaponclip=clips.BmpClip.create(),n.nWingclip=clips.BmpClip.create(),n.addChild(n.nBodyclip),n.addChild(n.nHPBar),n.addChild(n.nWeaponclip),n.addChild(n.nWingclip),n.switchDirIndex(),n}return __extends(e,t),Object.defineProperty(e.prototype,"moveSpeed",{get:function(){return this.nMoveSpeed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sleep",{get:function(){return this._sleep},set:function(t){this._sleep=t,this._sleep&&this.nPlayingType!=ActionType.DIE&&this.playActionType(ActionType.STAND)},enumerable:!0,configurable:!0}),e.prototype.setPosition=function(e,i){t.prototype.setPosition.call(this,e,i),this.syncMapPosition()},e.prototype.removeAllEffects=function(){for(var t;this.nEffectlst.length;)t=this.nEffectlst.pop(),t.stop(),t==this.actionEff&&(this.actionEff=null),t.destruct();this.nActionEffectQueue.length=0,this.effectQueueParm.length=0},e.prototype.initBaseActor=function(t){void 0===t&&(t=!0),t&&(e.handleSeed++,this.handleId=e.handleSeed);for(var i=this.nBuffs.length-1;i>=0;i--)this.removeBuff(i);this.nBuffs.length=0,this.nBodyclip||(this.nBodyclip=new clips.BmpClip),this.selected=0,this.nDie=!1,this.nSelectdSkill=null,this.nTargeter=null,this.nLockTarget=null,this.nTargetX=void 0,this.nTargetY=void 0,this.nPlayingType="",this.nBodyclip.alpha=1,this.nActionTypeQueue.length=0,this.removeAllEffects(),this.nBodyclip.addEventListener(egret.Event.LOOP_COMPLETE,this.playNextAction,this),this.nBodyclip.addEventListener(egret.Event.COMPLETE,this.playNextAction,this),this.addChild(this.nBodyclip),this.addChild(this.nHPBar),this.addChild(this.nWeaponclip),this.addChild(this.nWingclip),this.switchDirIndex()},e.getDefaultBody=function(){if(!e._defaultBody){var t=RES.getRes("LoadingDefaultBody"),i=new Object;i.res={0:{x:0,y:0,w:t.textureWidth,h:t.textureHeight}};var n={frames:[{res:"0",x:-t.textureWidth/2,y:-t.textureHeight}],labels:[],frameRate:"12"};i.mc={mov_1:n};var r=JSON.parse(JSON.stringify(i)),s=new egret.MovieClipDataFactory(r,t);e._defaultBody=s.generateMovieClipData()}return e._defaultBody},e.prototype.setBodyId=function(t){this.nBodyid!=t&&(this.nBodyid=t,this.renderAction(this.nPlayingType))},e.prototype.setWeaponId=function(t){t!=this.nWeaponId&&(this.nWeaponId=t)},e.prototype.setWingId=function(t){t!=this.nWingId&&(this.nWingId=t)},Object.defineProperty(e.prototype,"direction",{get:function(){return this.nDirection},set:function(t){this.nDirection!=t&&(this.nDirection=t,this.renderAction(this.nPlayingType),this.switchDirIndex())},enumerable:!0,configurable:!0}),e.prototype.switchDirIndex=function(){e.lrDirs[this.direction];switch(this.direction){case 6:case 2:this._dirLayerList[0]=this.nBodyclip,this._dirLayerList[1]=this.nWeaponclip,this._dirLayerList[2]=this.nWingclip;break;case 1:case 7:this._dirLayerList[0]=this.nWeaponclip,this._dirLayerList[1]=this.nBodyclip,this._dirLayerList[2]=this.nWingclip;break;case 0:this._dirLayerList[0]=this.nWeaponclip,this._dirLayerList[1]=this.nBodyclip,this._dirLayerList[2]=this.nWingclip;break;case 3:case 4:case 5:this._dirLayerList[0]=this.nWingclip,this._dirLayerList[1]=this.nBodyclip,this._dirLayerList[2]=this.nWeaponclip}for(var t=3;t>=0;t--)this._dirLayerList[t]&&(this._dirLayerList[t]==this.nWingclip&&this.nWingId<=0?null!=this.nWingclip.parent&&this.removeChild(this.nWingclip):this.addChildAt(this._dirLayerList[t],0));this.addChildAt(this.nShadow,0),this.bottmEff&&this.addChildAt(this.bottmEff,1)},e.prototype.getBodyModel=function(t,e){ModelResMgr.getHumanModel(t,this.nBodyclip,e)},e.prototype.formatActDir=function(t,e){return ActionType.getAct(t)+e.toString()},e.prototype.renderAction=function(t,i){void 0===i&&(i=!1),t==ActionType.READY&&(this.readytime=GameLogic.ins.gameRunTick+this.nReadySpeed,this.nBodyclip.playLoopTime=this.nActionSpeed,t=ActionType.STAND),this.nPlayingType=t,t==ActionType.WALK||t==ActionType.RUN||void 0==this.nTargeter||this.nTargeter&&(this.direction=this.countAngle(this.nTargeter,this.direction));var n=e.lrDirs[this.direction],r=this.formatActDir(t,n);t==ActionType.ATTACK88?(this.nBodyclip.stop(),this.nBodyclip.visible=!1):(this.nBodyclip.visible=!0,this.nBodyid&&(t==ActionType.DIE?(this.getBodyModel(10026,""),this.nBodyclip.alpha=.5):this.getBodyModel(this.nBodyid,r)),this.nBodyclip.isComplete||(this.nBodyclip.movieClipData=e.getDefaultBody()),this.nBodyclip.play(-1));var s=1;s=this.nRace==ActorRace.MONSTER&&-1==e.smId.indexOf(this.nBodyid)?t==ActionType.FIGHT?this.direction>=4?-Math.abs(this.nBodyclip.scaleX):Math.abs(this.nBodyclip.scaleX):this.direction>0&&this.direction<4?-Math.abs(this.nBodyclip.scaleX):Math.abs(this.nBodyclip.scaleX):this.direction>=4?-Math.abs(this.nBodyclip.scaleX):Math.abs(this.nBodyclip.scaleX),this.nBodyclip.setScaleX(s),i||(this.nActionTick=GameLogic.ins.gameRunTick+this.nBodyclip.playLoopTime),-1==this.nActionTick&&(this.nActionTick=GameLogic.ins.gameRunTick+this.nActionSpeed),this.nWeaponId&&(this.nWeaponclip.playLoopTime=this.nBodyclip.playLoopTime,this.nWeaponclip.setScaleX(s),this.getWeaponModel(this.nWeaponId,r),this.nWeaponclip.play(-1)),this.nWingId&&(this.nWingclip.playLoopTime=this.nBodyclip.playLoopTime,this.nWingclip.setScaleX(s),this.getWingModel(this.nWingId,r),this.nWingclip.play(-1)),this.switchDirIndex()},e.prototype.getWeaponModel=function(t,e){ModelResMgr.getWeaponModel(t,this.nWeaponclip,e)},e.prototype.getWingModel=function(t,e){ModelResMgr.getWingModel(t,this.nWingclip,e)},e.prototype.playActionType=function(t){this.renderAction(t),this.nActionTypeQueue.length=0,this.nActionEffectQueue.length=0,this.effectQueueParm.length=0},e.prototype.playNextAction=function(t){if(0==this.mabiArr.length&&void 0==this._sprintTarget){if(this.nActionTypeQueue.length){this.nActionTypeQueue.shift();if(this.nPlayingType==ActionType.DIE||this.isDie)this.sendDie();else{if(this.nActionTypeQueue.length>0){if(this.renderAction(this.nActionTypeQueue[0]),this.nActionEffectQueue.length){var e=this.nActionEffectQueue.shift(),i=this.effectQueueParm.shift();this.playEffect(e,1,this.nAttackSpeed,i.currDir,i.nScaleX)}return}this.onMoveing?this.nRace==ActorRace.MONSTER?this.playActionType(ActionType.WALK):this.playActionType(ActionType.RUN):this.playActionType(ActionType.STAND)}}this.AI(),(this.nPlayingType==ActionType.DIE||this.isDie)&&this.sendDie()}},e.prototype.sendDie=function(){},e.prototype.update=function(t){if(this.triggerBuffResult(t),null!=this.m_JumpPoints&&!this.isMoving)return void this.runJump();if(this.processMove(t),0==this.mabiArr.length){this.nActionTick<t&&this.nActionTick>-1&&(this.nActionTick=-1,this.playNextAction(null));var e,i;for(e=this.nEffectlst.length-1;e>=0;e--)i=this.nEffectlst[e],(0==i.lastPlayTimes||0==i.onPlaying||i.endPlayloop>0&&i.endPlayloop<t)&&(this.nEffectlst.splice(e,1),i==this.actionEff&&(this.actionEff=null),i.destruct());this.readytime=t>=this.readytime?0:this.readytime,this.AI()}},e.prototype.triggerBuffResult=function(t){var e,i;for(e=this.nBuffs.length-1;e>=0;e--)if(i=this.nBuffs[e],0!=i.endTime)if(t>i.endTime&&i.triggerCount==i.interval.length)this.removeBuff(e);else{for(var n=0,r=i.interval.length-1;r>=0;r--)if(t>=i.interval[r]){n=r+1;break}for(;i.triggerCount!=n;){switch(i.type){case BuffType.SUSTAIN_HP:this.addHp[i.value];break;case ComAttribute.hurtPCT:this.addHp[i.value];break;default:throw new Error("未知间隔BUFF类型!")}n--}}},e.prototype.addBuff=function(t){for(var e=0;e>this.nBuffs.length;e++)if(this.nBuffs[e].type==t.type&&this.nBuffs[e].value==t.value&&this.nBuffs[e].hurtType==t.hurtType)return void(this.nBuffs[e].endTime=t.endTime);if(0==t.interval.length){if(t.type==ComAttribute.giddyPCT)return this.mabiArr.push(t.handle),void this.playActionType(ActionType.READY);if(t.type==ComAttribute.frost)return this.mabiArr.push(t.handle),void this.playActionType(ActionType.READY);AttributeUtlis.BuffAttributeByTarge(t,this.actorVo,!0)}this.nBuffs.push(t)},e.prototype.removeBuff=function(t,e){var i;if(e){for(var n=0;n<this.nBuffs.length;n++)if(this.nBuffs[n].handle==e){i=this.nBuffs[n],t=n;break}}else i=this.nBuffs[t];return i?(0==i.interval.length&&(i.type==ComAttribute.giddyPCT||i.type==ComAttribute.frost?this.mabiArr.splice(this.mabiArr.indexOf(i.handle),1):AttributeUtlis.BuffAttributeByTarge(i,this.actorVo,!1)),i.destruct(),void this.nBuffs.splice(t,1)):void egret.log("BUFF移除失败!")},e.prototype.addActionQueue=function(t){return t==ActionType.READY&&this.onMoveing&&(t=this.nRace==ActorRace.MONSTER?ActionType.WALK:ActionType.RUN),t!=ActionType.STAND&&t!=ActionType.READY||this.nActionTypeQueue[0]!=t?(this.nActionTypeQueue.push(t),this.nActionTypeQueue.length<=1?(this.renderAction(this.nActionTypeQueue[0]),!0):!1):void 0},Object.defineProperty(e.prototype,"currentActionType",{get:function(){return this.nActionTypeQueue.length<=0?this.nPlayingType:this.nActionTypeQueue[0]},enumerable:!0,configurable:!0}),e.prototype.AI=function(){},e.prototype.getAllys=function(){return new Array},e.prototype.getEnemy=function(){return new Array},e.prototype.die=function(){this.nDie||(this.selected=0,this.nDie=!0,this.nActionTypeQueue.length=0,this.playActionType(ActionType.DIE),this.endMove(!1))},e.prototype.endMove=function(e){void 0===e&&(e=!0),t.prototype.endMove.call(this,e),void 0!=this._sprintTarget&&(this._sprintTarget=void 0,this.setAttackTarget(void 0)),this.syncMapPosition()},Object.defineProperty(e.prototype,"isDie",{get:function(){return this.nDie},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bodyFilters",{set:function(t){var e=this;if(t){if(0!=this.delayFilters&&null!=this.nBodyclip.filters)return;this.nBodyclip.filters=t,this.delayFilters=egret.setTimeout(function(){e.bodyFilters=null,e.delayFilters=0},this,500)}else this.nBodyclip.filters=t,0!=this.delayFilters&&egret.clearTimeout(this.delayFilters),this.delayFilters=0},enumerable:!0,configurable:!0}),e.prototype.destruct=function(t){void 0===t&&(t=!1),this.sleep=!0,this.bodyFilters=null,this.receive(),t&&(this.nBodyclip.destruct(),this.nBodyclip=null)},e.prototype.receive=function(){this.mabiArr.length=this.skills.length=this.useingSkill.length=0,this.m_JumpPoints=null,this.nTargeter=void 0,this.receiveTime=egret.getTimer(),this.sleep=!0,-1!=this.delayHitHandle&&(egret.clearTimeout(this.delayHitHandle),this.delayHitHandle=-1),this.parent&&this.parent.removeChild(this),this.nBodyclip.stop(),this.nBodyclip.clearData(),this.nWeaponclip.stop(),this.nWeaponclip.clearData(),this.nWingclip.stop(),this.nWingclip.clearData();for(var t=this.nBuffs.length-1;t>=0;t--)this.removeBuff(t);this.nBuffs.length=0,this.nActionTypeQueue.length=0,this.removeAllEffects(),this.nBodyclip.removeEventListener(egret.Event.LOOP_COMPLETE,this.playNextAction,this),this.nBodyclip.removeEventListener(egret.Event.COMPLETE,this.playNextAction,this)},e.prototype.jumpTo=function(t,i,n,r){void 0===n&&(n=!1),void 0===r&&(r=10);var s,a;this.m_nJumpDestX=t,this.m_nJumpDestY=i,this.m_nJumpTime=Math.max(Math.abs(t-this.currentX)/e.DefaultJumpSpeed,Math.abs(i-this.currentY)/e.DefaultJumpSpeed),s=2*this.m_nJumpTime,this.m_nJumpTime>r&&(this.m_nJumpTime=r),a=this.m_nJumpTime*e.DefaultJumpUpInterval,this.m_dwJumpStartTick=GameLogic.ins.gameRunTick,this.m_nJumpUpInterval=a/s;var o=0;n&&(o=6*Math.abs(this.currentX-t)+20*Math.random()),this.m_JumpPoints=Parabola.MakeParabolaPoints((this.currentX+.5)*DisplayMapObject.MAP_CELL_WIDE,(this.currentY+.5)*DisplayMapObject.MAP_CELL_HIDE,(t+.5)*DisplayMapObject.MAP_CELL_WIDE,(i+.5)*DisplayMapObject.MAP_CELL_HIDE,this.m_nJumpTime,s,o),this.m_nJumpPointIdx=0,this.setPosition(t,i),this.nTargetX=t,this.nTargetY=i},e.prototype.runJump=function(){var t=Math.floor((GameLogic.ins.gameRunTick-this.m_dwJumpStartTick)/this.m_nJumpUpInterval);if(t!=this.m_nJumpPointIdx)if(isNaN(t)||t>=this.m_JumpPoints.length)this.endJump();else if(t>=0){this.m_nJumpPointIdx=t;var e=this.m_JumpPoints[t];this.updateJumpOffset(e)}},e.prototype.endJump=function(){this.m_JumpPoints=null,this.setCurrentXY(this.m_nJumpDestX,this.m_nJumpDestY)},e.prototype.updateJumpOffset=function(t){this.x=t.x,this.y=t.y},e.prototype.setAttackTarget=function(t){(!this.nLockTarget||this.nLockTarget.isDie||this.nLockTarget.sleep)&&(this.nLockTarget=void 0),!this.nLockTarget||this.nLockTarget.isDie||this.nLockTarget.sleep?(this.nTargeter=t,this.nTargeter&&(this.nTargeter.isDie||this.nTargeter.sleep)&&(this.nTargeter=void 0)):this.nTargeter=this.nLockTarget},e.prototype.lockAttackTarget=function(t){this.nLockTarget=t,this.nTargeter!=t&&this.setAttackTarget(t)},Object.defineProperty(e.prototype,"currLockTarget",{get:function(){return!this.nLockTarget||this.nLockTarget.isDie||this.nLockTarget.sleep?null:this.nLockTarget},enumerable:!0,configurable:!0}),e.prototype.playSkill=function(t,e){void 0===e&&(e=!0),t.useSkill(),this.nCurrentSkill=t,this.nBodyclip.playLoopTime=this.nAttackSpeed;var i,n,r=t.stdSkill;for(e&&(this.nTargeter?this.nDirection=this.countTargetDirection(this.nTargeter,this.nDirection):-1!=this.nTargetPoint.x&&-1!=this.nTargetPoint.y&&(this.nDirection=this.countPointDirection(this.nTargetPoint,this.nDirection))),t.dir=this.nDirection,i=0;i<t.actions.length;i++)if(n=t.actions[i],this.addActionQueue(n.act)){var s=this.playEffect(n,1,this.nAttackSpeed);s&&n.act==ActionType.ATTACK88&&(this.actionEff=s)}else this.effectQueueParm.push({currDir:this.direction,nScaleX:this.nBodyclip.scaleX}),this.nActionEffectQueue.push(n);this.addActionQueue(ActionType.READY),this.targetHandle=e?this.nTargeter.handleId:0,-1==this.delayHitHandle&&(this.delayHitHandle=egret.setTimeout(this.skillHitTarget,this,this.nAttackSpeed-r.hitTime,this.targetHandle,t))},e.prototype.playEffect=function(t,i,n,r,s){if(void 0===i&&(i=1),void 0===r&&(r=-1),void 0===s&&(s=void 0),!t)return null;var a,o,h;if(a=t,"number"==typeof t?o=Number(t):(o=a.effect,h=a.hasDir),!o)return null;var l;if(h||-1!=r){var p=e.lrDirs[-1==r?this.nDirection:r];l=ModelResMgr.getSkillEffect(o,null,p.toString()),l.setScaleX(this.nBodyclip.scaleX)}else l=ModelResMgr.getSkillEffect(o);return l.isComplete?(-1!=n&&(1==i?l.playLoopTime=n:l.endPlayloop=n),l.play(i),this.addChild(l),this.nEffectlst.push(l),l):-1==i?(l.play(i),this.addChild(l),this.nEffectlst.push(l),l):(l.destruct(),null)},e.prototype.skillHitTarget=function(t,e){-1!=this.delayHitHandle&&(egret.clearTimeout(this.delayHitHandle),this.delayHitHandle=-1),(0==t||void 0!=this.nTargeter&&!this.nTargeter.sleep&&!this.nTargeter.isDie&&this.nTargeter.handleId==t)&&(SkillMgr.ins.isMaxSkill(e)&&GameMap.ins().shake(20,20,500),GameLogic.ins.skillHitTarget(this.nCurrentSkill,this,this.nTargeter)),this.endSkill()},e.prototype.endSkill=function(){-1!=this.delayHitHandle&&(egret.clearTimeout(this.delayHitHandle),this.delayHitHandle=-1),this.nTargeter=void 0,this.lockAttackTarget(this.nLockTarget),this.nSelectdSkill=void 0,this.nCurrentSkill=void 0},e.prototype.addHp=function(t){},e.prototype.sprint=function(t,e,i,n){this.nDirection=t,this.nActionTypeQueue.length=0;for(var r=DisplayMapObject.DIR_LS[this.nDirection],s=this.currentX,a=this.currentY,o=1;e>=o;o++){if(!GameMap.ins().moveable(s+r.x*o,a+r.y*o)){egret.log("冲刺遇到障碍!!!");break}s+=r.x,a+=r.y}var h=Math.abs(s-this.currentX),l=Math.abs(a-this.currentY),p=Math.max(h,l);if(p>0){this._sprintTarget=i;var c=this.nMoveSpeed*p/n;this.moveTo(s,a,c)}return p},e.prototype.getBuffByType=function(t){for(var e=0;e<this.nBuffs.length;e++)if(this.nBuffs[e].type==t)return!0;return!1},e.prototype.processMove=function(e){t.prototype.processMove.call(this,e),this.syncMapPosition()},e.prototype.syncMapPosition=function(){if(this.stage&&(this.lastX!=this.x||this.lastY!=this.y||GameMap.ins().m_dwShakingOverTick)&&(this.lastX=this.x,this.lastY=this.y,this.nRace==ActorRace.HUMAN)){this.globalPosition=this.stage.globalToLocal(GlobalVo.GAME_W/2,GlobalVo.GAME_H/2);var t=this.globalPosition.x-this.x,e=this.globalPosition.y-this.y,i=MapVo.ins.minXYpo,n=t>0?0:t<i.x?i.x:t,r=e>0?0:e<i.y?i.y:e;GameMap.ins().titleLayXY(n,r,0!=GameMap.ins().m_dwShakingOverTick),DataEventDispatcher.dispatchEventWith(GameEvent.CHANGE_MINIMAP,{a:this.x,b:this.y})}},e.handleSeed=0,e.smId=[],e.lrDirs=[0,1,2,3,4,3,2,1],e.DefaultJumpSpeed=1/3,e.DefaultJumpUpInterval=50,e}(DisplayMapObject);__reflect(BaseActor.prototype,"BaseActor");var LayerManager=function(){function t(){}return t.mapLayer=new eui.UILayer,t.UI_Main=new BaseEuiLayer,t.UI_MainUI=new BaseEuiLayer,t.UI_Popup=new BaseEuiLayer,t.UI_Tips=new BaseEuiLayer,t.guideLayer=new eui.UILayer,t}();__reflect(LayerManager.prototype,"LayerManager");var ViewManager=function(t){function e(){var e=t.call(this)||this;return e._opens=[],e._regesterInfo={},e._views={},e._hCode2Key={},e._opens=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.reg=function(t,e){if(null!=t){var i=egret.getQualifiedClassName(t);this._regesterInfo[i]||(this._regesterInfo[i]=[t,e])}},e.prototype.getKey=function(t){return egret.getQualifiedClassName(t)},e.prototype.destroy=function(t){var e=this._hCode2Key[t.hashCode];delete this._views[e]},e.prototype.open=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(SystemOpenMgr.checkOpen(t,!0)){if(e)for(var n=0;n<e.length;n++)if(e[n]instanceof BaseView&&!SystemOpenMgr.checkOpen(e[n],!0))return;var r=this.getKey(t);this._regesterInfo[r];if(!t.openCheck.apply(t,e))return null;var s=this.openEasy.apply(this,[t].concat(e));return s}},e.prototype.close=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(!this.isShow(t))return null;var n=this.getKey(t),r=this._views[n];if(r){var s=this._opens.indexOf(n);if(s>=0&&this._opens.splice(s,1),r.close.bind(r).apply(void 0,e),r.$onClose.apply(r),r.parent==LayerManager.UI_MainUI){var a=egret.Tween.get(r);a.to({x:-GlobalVo.GAME_W},200).call(function(){r.x=GlobalVo.GAME_W,r.removeFromParent()},this)}else r.removeFromParent()}return r},e.prototype.isShow=function(t){return this._opens.indexOf(this.getKey(t))>=0},e.prototype.openEasy=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=this.getKey(t),r=this._views[n],s=this._regesterInfo[n];if(r||(r=new s[0],this._views[n]=r,this._hCode2Key[r.hashCode]=n),!r)return console.log("UI_"+n+"不存在"),null;if(r.isShow())return r;if(s[1]==LayerManager.UI_MainUI){r.x=GlobalVo.GAME_W;var a=egret.Tween.get(r);a.to({x:0},200)}return r.addToParent(s[1]),r.open.bind(r).apply(void 0,e),-1==this._opens.indexOf(n)&&this._opens.push(n),r},e.prototype.getView=function(t){var e=this.getKey(t);return this._views[e]},e.prototype.closeTopLevel=function(t){void 0===t&&(t=null);for(var e=this._opens.length-1;e>=0;e--){var i=this._opens[e],n=this.getView(egret.getDefinitionByName(i));n!=t&&n.isTopLevel&&this.close(i,[])}},e.getView=function(t){switch(t){case ViewID.shop:return ShopWin;case ViewID.pveII:return PVEWinII;case ViewID.pvp:return PVPWin}return null},e.redToTarge=function(t,i){var n=e.redDic[t.hashCode];i?(n||(t.red&&(n=t.red),n||(n=new eui.Image,n.x=t.x+t.width-32,n.y=t.y,n.source=RES.getRes("red"),t.parent&&t.parent.addChild(n)),n.touchEnabled=!1,e.redDic[t.hashCode]=n),n.visible=!0):n&&(n.visible=!1)
},e.effectToTarge=function(t,i){var n=e.redDic[t.hashCode];i?(n||(t.red&&(n=t.red),n||(n=ObjectPool.pop("clips.BmpClip"),n.x=t.x+t.width/2,n.y=t.y+t.height+9.5,ModelResMgr.getOtherEffect(10013,n),t.parent&&t.parent.addChild(n)),n.play(-1),n.touchEnabled=!1,e.effectDic[t.hashCode]=n),n.visible=!0):n&&(n.stop(),n.visible=!1)},e.redDic={},e.effectDic={},e}(BaseClass);__reflect(ViewManager.prototype,"ViewManager");var ViewID;!function(t){t[t.dx=0]="dx",t[t.shop=1]="shop",t[t.pvp=2]="pvp",t[t.pveII=3]="pveII",t[t.points=4]="points"}(ViewID||(ViewID={}));var BaseSound=function(){function t(){this._cache={},this._loadingCache=new Array,TimerManager.ins().doTimer(6e4,0,this.dealSoundTimer,this)}return t.prototype.dealSoundTimer=function(){for(var t=egret.getTimer(),e=Object.keys(this._cache),i=0,n=e.length;n>i;i++){var r=e[i];this.checkCanClear(r)&&t-this._cache[r]>=SoundManager.CLEAR_TIME&&(delete this._cache[r],RES.destroyRes(r))}},t.prototype.getSound=function(t){var e=RES.getRes(t);if(e)this._cache[t]&&(this._cache[t]=egret.getTimer());else{if(-1!=this._loadingCache.indexOf(t))return null;this._loadingCache.push(t),RES.getResAsync(t,this.onResourceLoadComplete,this)}return e},t.prototype.onResourceLoadComplete=function(t,e){var i=this._loadingCache.indexOf(e);-1!=i&&(this._loadingCache.splice(i,1),this._cache[e]=egret.getTimer(),this.loadedPlay(e))},t.prototype.loadedPlay=function(t){},t.prototype.checkCanClear=function(t){return!0},t}();__reflect(BaseSound.prototype,"BaseSound");var BaseMap=function(t){function e(e){var i=t.call(this)||this;return i.m_nLayersOffsetX=0,i.m_nLayersOffsetY=0,i.changeMap=!1,i.mapResPool=new Array,i.imgHashMap=new HashMap,i.m_MapLayerRoot=e,i.bg=new eui.Image,i.bg.scaleX=i.bg.scaleY=DisplayMapObject.MINMAP_SCALE,i.m_MapLayerRoot.addChild(i.bg),i.mapContainer=new eui.UILayer,i.m_MapLayerRoot.addChild(i.mapContainer),i.actorLayer=new eui.UILayer,i.actorLayer.name="模型层",i.actorLayer.touchEnabled=i.actorLayer.touchChildren=!1,i.m_MapLayerRoot.addChild(i.actorLayer),i.bg.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onMove,i),i.mapContainer.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onMove,i),i.mAsPath=new ASPath,i}return __extends(e,t),e.prototype.addActor=function(t){this.actorLayer.addChild(t)},e.prototype.setDisplaySize=function(t,e){if(t!=this.m_nDisplayWidth||e!=this.m_nDisplayHeight){this.m_nDisplayWidth=t,this.m_nDisplayHeight=e;MapVo.ins;this.m_nHCellCount=Math.ceil(t/DisplayMapObject.MAP_IMG_WIDE),this.m_nVCellCount=Math.ceil(e/DisplayMapObject.MAP_IMG_HIDE)}},e.prototype.moveable=function(t,e){return MapVo.ins.moveable(t,e)},Object.defineProperty(e.prototype,"onHookMap",{get:function(){return this.mapType==MapType.TYPE_0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inFBMap",{get:function(){return this.mapType==MapType.TYPE_2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inBossMap",{get:function(){return this.mapType==MapType.TYPE_1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inJJCMap",{get:function(){return this.mapType==MapType.TYPE_3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapType",{get:function(){return this._mapType},enumerable:!0,configurable:!0}),e.prototype.gotoScene=function(t,i){this.currMapID=t;var n;if(i?(n=ConfigMgr.gameConfig.partInfo[t+""],this._mapType=MapType.TYPE_2):(n=ConfigMgr.gameConfig.pointInfo[t+""],this._mapType=n.maptype),!n)throw new Error("找不到地图"+t+i);GuideMgr._instance&&GuideMgr.dispatchTiggerEvent(tigger.sceneType),this.lastFile!=n.sectionId&&this.clearRes(),this.lastFile=n.sectionId,this.mc=n;var r=TMXMgr.ins().mapDic[this.lastFile+".xy"];if(!r)return!1;var s=MapVo.ins;return s.mapData=r,this.startX=this.startY=-1,this.bg.source=ResMgr.getMapImage(this.lastFile+".jpg"),this.mAsPath.initFromMap(),MapVo.ins.data=n,DataEventDispatcher.dispatchEventWith(e.LOAD_MAP_COMPLETE),!0},e.prototype.titleLayXY=function(t,e,i){if(void 0===i&&(i=!1),t+=(this.m_MapLayerRoot.scaleX-1)*MapVo.ins.mapW,e+=(this.m_MapLayerRoot.scaleY-1)*MapVo.ins.mapH,this.bgX==t&&this.bgY==e&&!i)return!1;i||(this.bgX=t,this.bgY=e);var n=(MapVo.ins,t+this.m_nLayersOffsetX),r=e+this.m_nLayersOffsetY;this.m_MapLayerRoot.x=n,this.m_MapLayerRoot.y=r;var s=Math.floor(Math.abs(n)/DisplayMapObject.MAP_IMG_WIDE/this.m_MapLayerRoot.scaleX);s=0>s?0:s;var a=Math.floor(Math.abs(r)/DisplayMapObject.MAP_IMG_HIDE/this.m_MapLayerRoot.scaleX);return a=0>a?0:a,(this.startX!=s||this.startY!=a||this.changeMap)&&(this.startX=s,this.startY=a,this.changeMap=!1,this.upMapImg(n,r)),!0},e.prototype.upMapImg=function(t,e,i){void 0===i&&(i=!0);var n,r=MapVo.ins,s=[],a=this.startX+this.m_nHCellCount,o=this.startY+this.m_nVCellCount;for(t=this.startX;a>=t;t++)for(e=this.startY;o>=e;e++)n=e*r.imgCols+t,n<r.imgRows*r.imgCols&&s.push(n);var h,n,l;for(l=this.mapContainer.numChildren-1;l>-1;l--)h=this.mapContainer.getChildAt(l),n=s.indexOf(Number(h.name)),-1!=n?s.splice(n,1):i&&h.parent.removeChildAt(l);for(var p;s.length;)n=s.pop(),p=ResMgr.getMapImage(r.mapFile+"/"+n+".jpg"),h=this.getImg(p),h.name=n+"",h.x=n%r.imgCols*DisplayMapObject.MAP_IMG_WIDE,h.y=Math.floor(n/r.imgCols)*DisplayMapObject.MAP_IMG_HIDE,this.mapContainer.addChild(h)},e.prototype.clearRes=function(){for(var t,e,i=egret.getTimer();this.imgHashMap.length;)e=this.imgHashMap.shift(),t=e.value,null!=t.parent&&t.parent.removeChild(t),t.source=null,RES.destroyRes(e.key),t.name=i+"",this.mapResPool.push(t);this.imgHashMap.clear(),this.bg.source&&RES.destroyRes(ResMgr.getMapImage(MapVo.ins.mapFile+".jpg"),!1),this.bg.source=null},e.prototype.getImg=function(t){var e=this.imgHashMap.get(t);return null==e&&(e=this.mapResPool.length>0&&egret.getTimer()-Number(this.mapResPool[0].name)>1e3?this.mapResPool.shift():new eui.Image,e.source=t,this.imgHashMap.add(t,e)),e},e.prototype.getPath=function(t,e,i,n,r,s){void 0===r&&(r=1),void 0===s&&(s=0);var a;if(a=this.mAsPath.getPatch(t,e,i,n),!a)return null;if(1==r)return a;if(1==a.length)return null;for(var o=Math.floor(a.length*r)+Math.floor(s/2);o;)a.shift(),o--;return a},e.prototype.onMove=function(t){var e=this,i=(t.localX,t.localY,this.screenToCoord(t.stageX,t.stageY));MapVo.ins.moveable(i.x,i.y)&&(this.clickEff||(this.clickEff=ObjectPool.pop("clips.BmpClip"),ModelResMgr.getOtherEffect(10044,this.clickEff),this.clickEff.addEventListener(egret.Event.COMPLETE,function(t){e.clickEff.gotoAndStop(1),e.clickEff.parent&&e.clickEff.parent.removeChild(e.clickEff)},this)),this.clickEff.x=i.x*DisplayMapObject.MAP_CELL_WIDE,this.clickEff.y=i.y*DisplayMapObject.MAP_CELL_HIDE,this.clickEff.play(2),this.actorLayer.addChild(this.clickEff),Human.ins.path=this.getPath(Human.ins.distX,Human.ins.distY,i.x,i.y))},e.prototype.screenToCoord=function(t,e){var i=new egret.Point(Math.floor((t-this.m_MapLayerRoot.x)/this.m_MapLayerRoot.scaleX*DisplayMapObject.MAPCELLUNITWIDTH_DEN),Math.floor((e-this.m_MapLayerRoot.y)/this.m_MapLayerRoot.scaleX*DisplayMapObject.MAPCELLUNITHEIGHT_DEN));i.x<0&&(i.x=0);var n=MapVo.ins;return i.x>=n.gridCols&&(i.x=n.gridCols-1),i.y<0&&(i.y=0),i.y>=n.gridRows&&(i.y=n.gridRows-1),i},e.LOAD_MAP_COMPLETE="LOAD_MAP_COMPLETE",e}(BaseClass);__reflect(BaseMap.prototype,"BaseMap");var MapType=function(){function t(){}return t.TYPE_0=0,t.TYPE_1=1,t.TYPE_2=2,t.TYPE_3=3,t}();__reflect(MapType.prototype,"MapType");var BaseActivityPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"activetyID",{get:function(){return this.aID},set:function(t){this.aID=t,this.cf=ActivetyMgr.ins().activeConfig[t],this.dg.itemRenderer=ActivityItem,this.dg.dataProvider=new eui.ArrayCollection(this.cf),this.bg.source="a"+t+"_png",DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20032,this.backGetAward,this),DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_30006,this.completeActive,this)},enumerable:!0,configurable:!0}),e.prototype.backGetAward=function(t){t.data.isSuccess&&this.aID==t.data.activityId&&this.dg.getElementAt(t.data.activityIndex-1).upStatus(!1)},e.prototype.completeActive=function(t){this.aID==t.data.activityId&&this.dg.getElementAt(t.data.activityIndex-1).upStatus(!0)},e}(eui.Component);__reflect(BaseActivityPanel.prototype,"BaseActivityPanel");var BaseItemRender=function(t){function e(){var e=t.call(this)||this;return e._data=null,e._selected=!1,e.itemIndex=-1,e.touchCaptured=!1,e}return __extends(e,t),e.prototype.ontouchcancel=function(t){this.touchCaptured=!1;var e=t.$currentTarget;e.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.ontouchcancel,this),e.removeEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouchEnd,this),this.invalidateState(),this.tapHandleFun()},e.prototype.onTouchBegin=function(t){this.$stage.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.ontouchcancel,this),this.$stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouchEnd,this),this.touchEnabled=!0,this.invalidateState(),t.updateAfterEvent()},e.prototype.onStageTouchEnd=function(t){var e=t.$currentTarget;e.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.ontouchcancel,this),e.removeEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouchEnd,this),this.touchEnabled=!0,this.invalidateState(),this.tapHandleFun()},e.prototype.tapHandleFun=function(){},e.prototype.getCurrentState=function(){var t="up";if(this.touchCaptured&&(t="down"),this._selected){var e=t+"AndSelected",i=this.skin;return i&&i.hasState(e)?e:"disabled"==t?"disabled":"down"}return t},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.dataChanged()},enumerable:!0,configurable:!0}),e.prototype.dataChanged=function(){},Object.defineProperty(e.prototype,"selected",{get:function(){return this._selected},set:function(t){this._selected!=t&&(this._selected=t,this.invalidateState())},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._data=null,this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},e}(BaseView);__reflect(BaseItemRender.prototype,"BaseItemRender",["eui.IItemRenderer","eui.UIComponent","egret.DisplayObject"]),eui.registerBindable(BaseItemRender.prototype,"data");var Human=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n.selectSkillQue=[],n.nextMovePoin=new ASPathNode(0,0,0),n.nNameLabel=new egret.TextField,n.nNameLabel.touchEnabled=!1,n.nNameLabel.stroke=1,n.nNameLabel.strokeColor=3081220,n.nNameLabel.fontFamily="黑体",n.nNameLabel.bold=!0,n.nNameLabel.textAlign=egret.HorizontalAlign.CENTER,n.nNameLabel.textColor=16771584,n.nNameLabel.bold=!0,n.nNameLabel.size=18,n.addChild(n.nNameLabel),n.dynamicLevel=2,n.nHPBar.y=-200,n.nBodyclip.setScaleX(1.3),n.nBodyclip.scaleY=1.3,n.nRace==ActorRace.HUMAN&&(n.lvlEff=new clips.BmpClip,ModelResMgr.getOtherEffect(10024,n.lvlEff),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.level,function(){n.lvlEff.parent||(n.addChild(n.lvlEff),n.lvlEff.play(1),n.lvlEff.addEventListener(egret.Event.COMPLETE,function(){n.lvlEff.gotoAndStop(1),n.lvlEff.parent&&n.removeChild(n.lvlEff)},n))},n)),n.bottmEff=new clips.BmpClip,n.addChildAt(n.bottmEff,0),n}return __extends(e,t),e.prototype.setModelData=function(e){this.actorVo=e,this.upSpeed(),this.nBodyclip.playLoopTime=this.nActionSpeed,this.useingSkill=[],this.skills=[],this.sleep=!1,this.visible=!0,t.prototype.initBaseActor.call(this),SkillMgr.ins.createSkill(e.jobId,e.skillTabs,e.skillColumn,this),this.nRace==ActorRace.HUMAN?ModelResMgr.getOtherEffect(10019+e.sex,this.bottmEff):ModelResMgr.getOtherEffect(10022,this.bottmEff),this.bottmEff.play(-1)},e.prototype.upSpeed=function(){if(this.actorVo){var t=ConfigMgr.gameConfig.globalConfig,e=ConfigMgr.gameConfig.heroAttribute[this.actorVo.jobId];e.movingSpeed>this.actorVo.playerAttrInfo.movingSpeed?this.nMoveSpeed=e.movingSpeed+e.movingSpeed-this.actorVo.playerAttrInfo.movingSpeed:this.nMoveSpeed=e.movingSpeed-(this.actorVo.playerAttrInfo.movingSpeed-e.movingSpeed),e.attackSpeed>this.actorVo.playerAttrInfo.attackSpeed?this.nAttackSpeed=e.attackSpeed+e.attackSpeed-this.actorVo.playerAttrInfo.attackSpeed:this.nAttackSpeed=e.attackSpeed-(this.actorVo.playerAttrInfo.attackSpeed-e.attackSpeed),this.nActionSpeed=t.humanActionSpeed,this.nReadySpeed=500,this.nHPBar.setPosition(this.actorVo.nHp,this.actorVo.nMaxHp)}},e.prototype.start=function(){this.direction=0,this.nActionTypeQueue.length<=0&&""==this.nPlayingType&&this.playActionType(ActionType.STAND),this.readytime=0,this.nBodyclip.playLoopTime=this.nActionSpeed,this.nActionTick=GameLogic.ins.gameRunTick+100},e.prototype.stop=function(){this.actionEff&&(this.nEffectlst.splice(this.nEffectlst.indexOf(this.actionEff),1),this.actionEff.destruct(),this.actionEff=null),-1!=this.delayHitHandle&&(egret.clearTimeout(this.delayHitHandle),this.delayHitHandle=-1),this.endMove(!0),this.endSkill()},e.prototype.revival=function(){this.selectSkillQue.length=0,this.path=null,this.nDie=!1,this.sleep=!1,this.visible=!0,this.nTargetPoint.x=this.nTargetPoint.y=-1,this.nTargeter=void 0,this.addHp(this.actorVo.nMaxHp,!1),this.nHPBar.setPosition(this.actorVo.nHp,this.actorVo.nMaxHp);for(var t=this.nBuffs.length-1;t>=0;t--)0!=this.nBuffs[t].endTime&&this.removeBuff(t)},Object.defineProperty(e.prototype,"sleep",{get:function(){return this._sleep},set:function(t){this._sleep=t,this._sleep&&this.playActionType(ActionType.STAND)},enumerable:!0,configurable:!0}),e.prototype.sendDie=function(){t.prototype.sendDie.call(this),this.visible=!1},e.prototype.addHp=function(i,n){void 0===n&&(n=!0),t.prototype.addHp.call(this,i),e.ins==this&&(1==e.WU_DI||3==e.WU_DI)&&0>i||(this.actorVo.nHp+=i,this.actorVo.nHp>this.actorVo.nMaxHp&&(this.actorVo.nHp=this.actorVo.nMaxHp),this.actorVo.nHp<=0&&(this.actorVo.nHp=0,this.nDie=!0,this.sleep=!0),this.nHPBar.setPosition(this.actorVo.nHp,this.actorVo.nMaxHp))},e.prototype.addSkill=function(t){return t.canUse?this.selectSkillQue.length>0?(UserTips.ins().showTipsBigToSmall("等待释放!"),!1):(UserTips.ins().showTipsBigToSmall("等待释放!"),this.selectSkillQue.push(t),!0):(UserTips.ins().showTipsBigToSmall("技能正在CD中!"),!1)},e.prototype.AI=function(){if(!(0!=this.mabiArr.length||this._sprintTarget||this.isDie||this.sleep||1==GameLogic.GAME_STATUS||this.nActionTypeQueue.length>0||this.actionEff||0!=this.readytime))if(this.path&&this.path.length>0){if(!this.onMoveing&&(this.nextMovePoin=this.path.pop(),this.direction=this.nextMovePoin.nDir,this.moveTo(this.nextMovePoin.nX,this.nextMovePoin.nY,this.nMoveSpeed)))return this.nTargetPoint.x=-1,this.nTargetPoint.y=-1,void this.playActionType(ActionType.RUN)}else if(GameLogic.AUTO_FIGHT&&!this.isMoving&&!this.nSelectdSkill){if(!this.nSelectdSkill&&this.selectSkillQue.length>0){var t=!1;if(this.nActionTypeQueue.length>0)return;var e=this.selectSkillQue[0];if(e.needTarge)if(!this.nTargeter||this.nTargeter.isDie){var i=this.chooseTargeter();i&&(this.lockAttackTarget(i),this.distance(this.nTargeter)<=e.dis&&(t=!0))}else this.distance(this.nTargeter)<=e.dis&&(t=!0);else t=!0;if(t)return this.nSelectdSkill=this.selectSkillQue.shift(),void this.playSkill(this.nSelectdSkill,e.needTarge)}if(null!=this.nTargeter&&void 0!=this.nTargeter){if(this.nTargeter.isDie||this.nTargeter.sleep)return this.lockAttackTarget(void 0),void SystemInstance.nextFrameHandle(this.AI,this);var n=this.selectSkillQue.length>0?this.selectSkillQue[0].dis:SkillMgr.COMMON_SKILL[this.actorVo.jobId].dis;if(this.distance(this.nTargeter)>n&&!this.onMoveing&&0==this.nActionTypeQueue.length)return this.path=GameMap.ins().getPath(this.distX,this.distY,this.nTargeter.distX,this.nTargeter.distY,this.moveSpeed/(this.moveSpeed+this.nTargeter.moveSpeed),2==n?n:n-1),void SystemInstance.nextFrameHandle(this.AI,this);if(this.nActionTypeQueue.length>0)return;if(GameMap.ins().inJJCMap)for(var r,s=this.useingSkill.length-1;s>=0;s--)if(r=this.useingSkill[s],r&&!r.initiativeSkill&&!(r.needTarge&&this.distance(this.nTargeter)>r.dis)&&r.canUse)return this.nSelectdSkill=r,void this.playSkill(this.nSelectdSkill);if(!SkillMgr.COMMON_SKILL[this.actorVo.jobId].canUse)return;return this.nSelectdSkill=SkillMgr.COMMON_SKILL[this.actorVo.jobId],void this.playSkill(this.nSelectdSkill)}var a=this.chooseTargeter();if(this.lockAttackTarget(a),!a){if(MapVo.ins.autoChangeDX()&&GameMap.ins().inFBMap)return void FBMgr.ins.checkChangeMap();GameLogic.ins.createMonsters()}return void SystemInstance.nextFrameHandle(this.AI,this)}},e.prototype.chooseTargeter=function(t){void 0===t&&(t=2);var e,i,n,r;switch(t){case 0:r=new Array,r.push(this);break;case 1:break;default:r=this.getEnemy()}var s=Number.MAX_VALUE,a=-1,o=new Array;for(e=0;e<r.length;e++)n=r[e],n.sleep||n.isDie||(i=this.distance(n),s>i?(s=i,a=e):o.push(n));return-1!=a?r[a]:o.length>0?(o.sort(function(t,e){return t.distanceByTarget>e.distanceByTarget?1:void 0}),o[0]):null},e.prototype.getEnemy=function(){var t=GameLogic.ins.getActorsByType(ActorRace.MONSTER);return t=t.concat(GameLogic.ins.getActorsByType(ActorRace.PK_ROLE))},e.prototype.endMove=function(e){void 0===e&&(e=!0),t.prototype.endMove.call(this,e),this.AI()},e.prototype.setPosition=function(e,i){MapVo.ins.unMarkNode(this.currentX,this.currentY,MapNode.PLAYER),t.prototype.setPosition.call(this,e,i),MapVo.ins.markNode(e,i,MapNode.PLAYER)},e.WU_DI=0,e}(BaseActor);__reflect(Human.prototype,"Human");var ArtifactWin=function(t){function e(){var e=t.call(this)||this;return e.isSatisfy=!1,e.isActivation=!1,e.skinName="ArtifactSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.glowFilter=new egret.GlowFilter(16724016,.8,35,35,2,3,!1,!1),this.mc=ObjectPool.pop("clips.BmpClip"),this.aft.addChild(this.mc)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this.selectIndex=0|e[0],this.itemList.itemRenderer=ArtifactItemRender,this.panel1.setTile("当前属性加成",0),this.panel2.setTile("下级属性加成",1),this.update(),this.itemList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UPDATE_ARTIFACT_WIN,this.update,this),this.addTouchEvent(this.btns,this.onTop),UIDmgr.bindingUID(this.gb,uid.afParent)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.itemList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this),DataEventDispatcher.dispatcher.removeEventListener(GameEvent.UPDATE_ARTIFACT_WIN,this.update,this)},e.prototype.update=function(){for(var t=[],e=1;100>e;e++){var i=40001+100*e,n=ConfigMgr.gameConfig.artifact[i];if(!n)break;t.push(n)}this.itemList.dataProvider=new eui.ArrayCollection(t),this.artList=UserVo.ins.artifactInfos,this.selectItem()},e.prototype.onBarItemTap=function(t){this.currItem&&(this.currItem.filters=[]),this.currItem=t.itemRenderer,this.curItem||(this.curItem=this.itemList.getVirtualElementAt(0)),this.currItem&&(this.currItem.filters=[this.glowFilter]),this.selectIndex=t.itemIndex?t.itemIndex:0,this.selectItem()},e.prototype.selectItem=function(){var t=40001+100*(this.selectIndex+1),e=ConfigMgr.gameConfig.item[t];if(e){ModelResMgr.getOtherEffect(e.iconID,this.mc),this.mc.play(-1);var i=(BagVo.ins().getIdItem(t),ConfigMgr.gameConfig.artifact[t]);this.curItem=i,this.isActivation=!1;for(var n=0;n<this.artList.length;n++){var r=ConfigMgr.gameConfig.artifact[this.artList[n]];if(r&&r.artifactType==i.artifactType){this.isActivation=!0,this.curItem=r;break}}this.artNameImg.source=ResMgr.getGameOtherPng("art_name_"+e.iconID),this.panel1.updateType(this.curItem.itemId),this.panel2.updateType(this.curItem.itemId+1);var s=!1;if(this.isActivation)this.btns.icon="升级",this.labNo.visible=!1,s=0==this.curItem.strengthenArtifactStone,this.labNeed.text="消耗神器石："+UserVo.ins.strengthenArtifactStone+"/"+this.curItem.strengthenArtifactStone,UIDmgr.bindingUID(this.btns,uid.af3),this.isSatisfy=UserVo.ins.strengthenArtifactStone>=this.curItem.strengthenArtifactStone;else{if(this.labNo.visible=!0,1==i.access)this.isSatisfy=UserVo.ins.MAX_POINTS>=i.btainConditions,this.labNeed.text="通关关卡："+i.btainConditions;else if(2==i.access)this.isSatisfy=UserVo.ins.rebirthNum>=i.btainConditions,this.labNeed.text="重生："+i.btainConditions;else if(3==i.access)this.isSatisfy=UserVo.ins.vipLevel>=i.btainConditions,this.labNeed.text="VIP等级："+i.btainConditions;else if(4==i.access){this.isSatisfy=BagVo.ins().getIdItem(i.itemId)?!0:!1;var a=BagVo.ins().getItem(i.itemId);this.labNeed.text=a.name+"X 1(首充可获得)"}else if(5==i.access){this.isSatisfy=BagVo.ins().getIdItem(i.itemId)?!0:!1;var a=BagVo.ins().getItem(i.itemId);this.labNeed.text=a.name+"X 1(商城可购买获得)"}this.btns.icon="激活",UIDmgr.bindingUID(this.btns,uid.af2)}this.btns.visible=!0,s&&(this.labNeed.text="神器已达最大等级",this.btns.visible=!1),this.labNeed.textColor=this.isSatisfy?ColorUtlis.COLOR_GREEN:ColorUtlis.COLOR_RED}},e.prototype.onTop=function(){return this.curItem||!GuideMgr.currentGuide||10!=GuideMgr.currentGuide.id&&11!=GuideMgr.currentGuide.id||(this.curItem=this.itemList.getVirtualElementAt(0)),this.isSatisfy?void(this.isActivation?ArtifactVo.ins().sendReinforced(this.curItem.itemId):ArtifactVo.ins().sendActivation(this.curItem.itemId)):void(this.isActivation?UserTips.ins().showTipsBigToSmall("神器石不足"):UserTips.ins().showTipsBigToSmall("条件不足，不可激活神器"))},e}(BaseEuiView);__reflect(ArtifactWin.prototype,"ArtifactWin"),ViewManager.ins().reg(ArtifactWin,LayerManager.UI_MainUI);var EmailView=function(t){function e(){var e=t.call(this)||this;return e.skinName="EmailSkin",e.g0.itemRenderer=EmailRender,e}return __extends(e,t),e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this.addTouchEvent(this.btn0,this.onTap),this.addTouchEvent(this.btn1,this.onTap),this.currDx=-1,this.addEvent(GameEvent.REMOVE_EMAIL,DataEventDispatcher.dispatcher,this.upEmail),this.addEvent(GameEvent.ADD_EMAIL,DataEventDispatcher.dispatcher,this.upEmail),this.upEmail()},e.prototype.upEmail=function(){this.g0.dataProvider=new eui.ArrayCollection(UserVo.ins.emailInfos)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.btn0:HttpMgr.ins.sendMessage(ClientPacket.S_10041,{},ServerPacket.LOGIC_URL,!0);break;case this.btn1:for(var e=!1,i=0;i<UserVo.ins.emailInfos.length;i++)UserVo.ins.emailInfos[i].itemList&&UserVo.ins.emailInfos[i].itemList.length>0&&0==UserVo.ins.emailInfos[i].itemState&&(e=!0);if(!e)return UserTips.ins().showTipsBigToSmall("没有可领取的邮件!");HttpMgr.ins.sendMessage(ClientPacket.S_10039,{},ServerPacket.LOGIC_URL,!0)}},e}(BaseEuiView);__reflect(EmailView.prototype,"EmailView"),ViewManager.ins().reg(EmailView,LayerManager.UI_MainUI);var GemWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="GemSkin",e}return __extends(e,t),e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),this.itemList.itemRenderer=BaseItem,this.itemList.addEventListener(eui.UIEvent.RENDER,function(){UIDmgr.bindingUID(e.itemList.getVirtualElementAt(0),uid.bs1)},this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e);for(var n=0;n<BagVo.EQUIP_MAX;n++)this.addTouchEvent(this["btn"+n],this.onSelectBtn),this.addTouchEndEvent(this["btn"+n],this.onSelectBtn),this["btn"+n].name=n+"";for(var r=0;8>r;r++)this.addTouchEvent(this["gen"+r],this.onItemRender);this.currBtn||this.btn0.dispatchEventWith(egret.TouchEvent.TOUCH_TAP),this.updateGemList(),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UPDATE_GEM_DATA,this.selectEquip,this),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UPDATE_BAG_DATA,this.updateGemList,this),UIDmgr.bindingUID(this.gen0.itemIcon,uid.bs2),UIDmgr.bindingUID(this.gen0.upBtn,uid.bs3),UIDmgr.bindingUID(this.gen0.downBtn,uid.bs4),UIDmgr.bindingUID(this,uid.bsParent),this.addEvent(GameEvent.RED_GEM_LVL,DataEventDispatcher.dispatcher,this.upRed),this.upRed()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];GemVo.ins().equipPos=-1,DataEventDispatcher.dispatcher.removeEventListener(GameEvent.UPDATE_GEM_DATA,this.selectEquip,this),DataEventDispatcher.dispatcher.removeEventListener(GameEvent.UPDATE_BAG_DATA,this.updateGemList,this)},e.prototype.upRed=function(t){void 0===t&&(t=null);for(var e=0;4>e;e++)RemindMgr.GEM_CAN_UP[e].length>0?ViewManager.redToTarge(this["btn"+e],!0):ViewManager.redToTarge(this["btn"+e],!1);for(var e=0;8>e;e++)RemindMgr.GEM_CAN_UP[this.selectIndex]?ViewManager.redToTarge(this["gen"+e].itemIcon,RemindMgr.GEM_CAN_UP[this.selectIndex][e]?!0:!1):ViewManager.redToTarge(this["gen"+e].itemIcon,!1)},e.prototype.onSelectBtn=function(t){var e=this;this.currBtn=t.currentTarget,this.tabBar.$children.forEach(function(t,i){var n=t;n.currentState=n==e.currBtn?"down":"up"}),this.selectIndex=parseInt(this.currBtn.name),this.selectEquip(),this.upRed()},e.prototype.selectEquip=function(){this.currGem&&this.currGem.setBtnGrou(!1),GemVo.ins().equipPos=this.selectIndex,this.selectItem.data=UserVo.ins.Columns[this.selectIndex].itemInfo;var t=UserVo.ins.Columns[this.selectIndex].gemGrooves.gemGrooves,e=0;for(var i in t){var n=t[i];this["gen"+e].data=n,e++}},e.prototype.updateGemList=function(){var t=BagVo.ins().getBagGemList();if(t.length<12)for(var e=0;12>e;e++)t[e]||(t[e]=null);this.itemList.dataProvider=new eui.ArrayCollection(t)},e.prototype.onItemRender=function(t){this.currGem&&this.currGem.setBtnGrou(!1),this.currGem=t.currentTarget,this.currGem.data.gemId>0&&this.currGem.setBtnGrou(!this.currGem.btnGroup.visible,this.currGem==this.gen2?-133:0)},e}(BaseEuiView);__reflect(GemWin.prototype,"GemWin"),ViewManager.ins().reg(GemWin,LayerManager.UI_MainUI);var ReborthWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ReborthSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.reborthBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){HttpMgr.ins.sendMessage(ClientPacket.S_10011,{},ServerPacket.LOGIC_URL),ViewManager.ins().close(e)},this),this.awardGroup.itemRenderer=BaseItem},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e);var n,r=ConfigMgr.gameConfig.rebirthAward[UserVo.ins.points],s=[];for(var a in r){var o=MoneyUtils.isMoneyType(a);-1!=o&&r[a]>0&&(n=new ItemInfo,n.moneyType=MoneyUtils.ALL_MONEY[o],n.itemNum=r[a],s.push(n))}this.awardGroup.dataProvider=new eui.ArrayCollection(s),UIDmgr.bindingUID(this.reborthBtn,uid.cs1)},e}(BaseEuiView);__reflect(ReborthWin.prototype,"ReborthWin"),ViewManager.ins().reg(ReborthWin,LayerManager.UI_MainUI);var PVEWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="PVESkin",e}return __extends(e,t),e.prototype.euiCompete=function(){t.prototype.euiCompete.call(this);for(var e=[],i=0;i<FBMgr.ins.fbData.length;i++)e.push(FBMgr.ins.fbData[i][0]);this.ls.dataProvider=new eui.ArrayCollection(e)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e)},e}(BaseEuiView);__reflect(PVEWin.prototype,"PVEWin"),ViewManager.ins().reg(PVEWin,LayerManager.UI_MainUI);var PVPWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="PVPSkin",e}return __extends(e,t),e.prototype.euiCompete=function(){t.prototype.euiCompete.call(this),this.l1.itemRenderer=AwardShow},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this),this.addEvent(ServerPacket.C_20020,DataEventDispatcher.dispatcher,this.upData),this.addEvent(GameEvent.UP_PLAYER_PROPERTY+propertyType.challengeNum,DataEventDispatcher.dispatcher,this.upChallenge),this.addEvent(GameEvent.UP_PLAYER_PROPERTY+propertyType.fightPower,DataEventDispatcher.dispatcher,this.upPower),this.addEvent(ServerPacket.C_20030,DataEventDispatcher.dispatcher,this.upFightInfos),HttpMgr.ins.sendMessage(ClientPacket.S_10020,{},ServerPacket.LOGIC_URL,!0),this.addTouchEvent(this.btn,this.onClick),this.addTouchEvent(this.btn0,this.onClick),this.upChallenge(),this.upPower(),UIDmgr.bindingUID(this.r0,uid.p1)},e.prototype.onClick=function(t){if(t.currentTarget==this.btn0)return void HttpMgr.ins.sendMessage(ClientPacket.S_10026,{},ServerPacket.LOGIC_URL,!0);var e=PVPMgr.ins().canRefresh;0==e[0]?HttpMgr.ins.sendMessage(ClientPacket.S_10030,{},ServerPacket.LOGIC_URL,!0):ViewManager.ins().open(TipsWin,"确定","是否花费"+e[0]+"刷新挑战对手!","提示","取消",function(){e[1]?HttpMgr.ins.sendMessage(ClientPacket.S_10030,{},ServerPacket.LOGIC_URL,!0):UserTips.ins().showTipsBigToSmall(MoneyUtils.getMoneyName(MoneyUtils.M_3)+"不足,无法购买!")},null,this)},e.prototype.upChallenge=function(){this.l4.text="挑战次数:"+UserVo.ins.challengeNum},e.prototype.upPower=function(){this.l3.text="我的战斗力:"+UserVo.ins.fightPower},e.prototype.upData=function(t){this.l0.text="当前排名:"+t.data.rankings,this.upFightInfos(t);PVPMgr.MyRank=t.data.rankings,this.l1.dataProvider=new eui.ArrayCollection(e.getAwardStr(t.data.rankings))},e.getAwardStr=function(t){var e,i,n=[],r=ConfigMgr.gameConfig.rankingAward;for(e=0;e<r.length;e++)i=r[e].rankingId.split("#"),t>=parseInt(i[0])&&t<=parseInt(i[1])&&(r[e].diamond>0&&n.push([MoneyUtils.M_3,r[e].diamond]),r[e].battleCurrency>0&&n.push([MoneyUtils.M_5,r[e].battleCurrency]));return n},e.prototype.upFightInfos=function(t){for(var e=0;e<t.data.fightTargetInfos.length;e++)this["r"+e].data=t.data.fightTargetInfos[e]?t.data.fightTargetInfos[e]:null},e.PVP_ing=!1,e}(BaseEuiView);__reflect(PVPWin.prototype,"PVPWin"),ViewManager.ins().reg(PVPWin,LayerManager.UI_MainUI);var ShopWin=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e.skinName="shopSkin",e}return __extends(e,t),e.prototype.createChildren=function(){this.list.itemRenderer=ShopItemRender},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this.addTouchEvent(this.b0,this.onTap),this.addTouchEvent(this.b1,this.onTap),this.addTouchEvent(this.b2,this.onTap),this.addTouchEvent(this.b3,this.onTap),this.select||this.b0.dispatchEventWith(egret.TouchEvent.TOUCH_TAP)},e.prototype.update=function(t){for(var e=ConfigMgr.gameConfig.store,i=[],n=0;n<e.length;n++)e[n].down||t!=e[n].storeType||i.push(e[n]);this.list.dataProvider=new eui.ArrayCollection(i),this.itemScroller.stopAnimation(),this.itemScroller.viewport.scrollV=0},e.prototype.onTap=function(t){ViewManager.ins().getView(UIView);switch(t.currentTarget){case this.b0:this.update(1);break;case this.b1:this.update(2);break;case this.b2:this.update(3);break;case this.b3:this.update(4)}this.select&&(this.select.currentState="up"),this.select=t.currentTarget,this.select.currentState="down"},e}(BaseEuiView);__reflect(ShopWin.prototype,"ShopWin"),ViewManager.ins().reg(ShopWin,LayerManager.UI_MainUI);var AchievementWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="AchievementSkin",e.dg.itemRenderer=TaskRender,e}return __extends(e,t),e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this),this.updata(),DataEventDispatcher.dispatcher.addEventListener(GameEvent.RED_ACHEIEVEMENT,this.updata,this),UIDmgr.bindingUID(this,uid.cjParent)},e.prototype.updata=function(t){void 0===t&&(t=null),this.dg.dataProvider=new eui.ArrayCollection(RemindMgr.taskArr[3])},e.isReceive=function(t,e){for(var i=UserVo.ins.getTaskInfo(e),n=0;n<i.length;n++)if(t==i[n].taskId)return i[n].isReceive?!0:!1;return!1},e}(BaseEuiView);__reflect(AchievementWin.prototype,"AchievementWin"),ViewManager.ins().reg(AchievementWin,LayerManager.UI_MainUI);var TaskWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="TaskSkin",e.dg0.itemRenderer=TaskRender,e.dg1.itemRenderer=TaskRender,e.vs.selectedIndex=0,e.btn1.selected=!0,e.btn2.selected=!1,e}return __extends(e,t),e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this),this.addTouchEvent(this.btn1,this.tapCall),this.addTouchEvent(this.btn2,this.tapCall),this.addEvent(GameEvent.RED_MAIN_TASK,DataEventDispatcher.dispatcher,this.updata),this.addEvent(GameEvent.RED_DAY_TASK,DataEventDispatcher.dispatcher,this.updata),this.updata(),UIDmgr.bindingUID(this,uid.rwParent)
},e.prototype.updata=function(t){void 0===t&&(t=null),this.dg0.dataProvider=new eui.ArrayCollection(RemindMgr.taskArr[1]),this.dg1.dataProvider=new eui.ArrayCollection(RemindMgr.taskArr[2]),ViewManager.redToTarge(this.btn1,1==RemindMgr.taskGetSatus[1]),ViewManager.redToTarge(this.btn2,1==RemindMgr.taskGetSatus[2])},e.prototype.tapCall=function(t){switch(t.currentTarget){case this.btn1:this.vs.selectedIndex=0,this.btn1.selected=!0,this.btn2.selected=!1;break;default:this.vs.selectedIndex=1,this.btn2.selected=!0,this.btn1.selected=!1}},e}(BaseEuiView);__reflect(TaskWin.prototype,"TaskWin"),ViewManager.ins().reg(TaskWin,LayerManager.UI_MainUI);var TipsView=function(t){function e(){var e=t.call(this)||this;return e.labCount=0,e.list=[],e.initUI(),e}return __extends(e,t),e.prototype.initUI=function(){this.touchEnabled=!1,this.touchChildren=!1},e.prototype.showTips=function(t){var e=new TipsItem;e.verticalCenter=0,e.horizontalCenter=0,e.labelText=t,this.addChild(e),this.list.unshift(e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeTip,this);for(var i=this.list.length-1;i>=0;i--){egret.Tween.removeTweens(this.list[i]);var n=egret.Tween.get(this.list[i]);n.to({verticalCenter:-30*i+0},500)}},e.prototype.removeTip=function(t){var e=this.list.indexOf(t.currentTarget);this.list.splice(e,1),egret.Tween.removeTweens(t.currentTarget)},e}(BaseEuiView);__reflect(TipsView.prototype,"TipsView"),ViewManager.ins().reg(TipsView,LayerManager.UI_Tips);var DelayOptManager=function(t){function e(){var e=t.call(this)||this;return e.TIME_THRESHOLD=2,e._delayOpts=[],egret.startTick(e.runCachedFun,e),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.addDelayOptFunction=function(t,e,i,n,r){this._delayOpts.push({fun:e,funPara:i,thisObj:t,callBack:n,para:r})},e.prototype.clear=function(){this._delayOpts.length},e.prototype.runCachedFun=function(t){if(0==this._delayOpts.length)return!1;for(var e,i=egret.getTimer();this._delayOpts.length&&(e=this._delayOpts.shift(),e.funPara?e.fun.call(e.thisObj,e.funPara):e.fun.call(e.thisObj),e.callBack&&(void 0!=e.para?e.callBack.call(e.thisObj,e.para):e.callBack()),!(egret.getTimer()-i>this.TIME_THRESHOLD)););return!1},e}(BaseClass);__reflect(DelayOptManager.prototype,"DelayOptManager");var ConsumeGift=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.activetyID=ActivetyMgr.CONSUME_GIFT},e}(BaseActivityPanel);__reflect(ConsumeGift.prototype,"ConsumeGift");var ContinueLogin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.activetyID=ActivetyMgr.CONTINUE_LOGIN},e}(BaseActivityPanel);__reflect(ContinueLogin.prototype,"ContinueLogin");var FirstCharge=function(t){function e(){var e=t.call(this)||this;return e.skinName="FirstChargeSkin",e.rc.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){ViewManager.ins().close(e)},e),e.newCloseBtn00.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){ViewManager.ins().close(e)},e),e.activetyID=ActivetyMgr.FIRST_CHARGE,e}return __extends(e,t),e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this.addEvent(GameEvent.UP_PLAYER_PROPERTY+propertyType.isRecharge,DataEventDispatcher.dispatcher,this.dataChange),this.dataChange()},e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),this.gd.itemRenderer=BaseItem,this.gd.dataProvider=new eui.ArrayCollection(ActivetyMgr.ins().getActivityAwards(ActivetyMgr.ins().activeConfig[ActivetyMgr.FIRST_CHARGE][0])),this.getBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){if("我要充值"==e.getBtn.label)return void ViewManager.ins().open(RechargeWin);var i={activityId:ActivetyMgr.FIRST_CHARGE,activityIndex:1};HttpMgr.ins.sendMessage(ClientPacket.S_10032,i,ServerPacket.LOGIC_URL,!0)},this),this.dataChange()},e.prototype.dataChange=function(){var t=ActivetyMgr.ins().checkAtivityEnd(this.activetyID,1);UserVo.ins.isRecharge?1==t?(this.getBtn.enabled=!1,this.getBtn.label="已 领 取"):(this.getBtn.enabled=!0,this.getBtn.label="领 取"):(this.getBtn.enabled=!0,this.getBtn.label="我要充值")},e}(BaseEuiView);__reflect(FirstCharge.prototype,"FirstCharge"),ViewManager.ins().reg(FirstCharge,LayerManager.UI_MainUI);var InvestPlan=function(t){function e(){var e=t.call(this)||this;return e.skinName="InvestPlanSkin",e}return __extends(e,t),e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),this.activetyID=ActivetyMgr.INVEST_PLAN;UserVo.ins.activityInfos.filter(function(t){return"1004"==t.activityId});0==UserVo.ins.purchaseInvestment?this.getBtn.enabled=!0:this.getBtn.enabled=!1,DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20046,function(t){console.log("----ServerPacket.C_20046----",t.data),0==t.data.code&&(e.getBtn.enabled=!1)},this),this.getBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){UserVo.ins.diamond<500&&ViewManager.ins().open(TipsWin,"确定","钻石不足，请充值","提示","",function(){},null,e),HttpMgr.ins.sendMessage(ClientPacket.S_10046,{},ServerPacket.LOGIC_URL,!0)},this)},e}(BaseActivityPanel);__reflect(InvestPlan.prototype,"InvestPlan");var LimitCard=function(t){function e(){var e=t.call(this)||this;return e.MAX_NUM=50,e.skinName="LimitCardSkin",e.rc.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){ViewManager.ins().close(e)},e),e}return __extends(e,t),e.prototype.createChildren=function(){var t=this;this.getOne.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){if(UserVo.ins.diamond<50)return void ViewManager.ins().open(TipsWin,"确定","钻石不足","提示","",function(){},null,t);var i={drawType:1};HttpMgr.ins.sendMessage(ClientPacket.S_10042,i,ServerPacket.LOGIC_URL,!0)},this),this.getTen.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){if(UserVo.ins.diamond<450)return void ViewManager.ins().open(TipsWin,"确定","钻石不足","提示","",function(){},null,t);var i={drawType:2};HttpMgr.ins.sendMessage(ClientPacket.S_10042,i,ServerPacket.LOGIC_URL,!0)},this)},e}(BaseEuiView);__reflect(LimitCard.prototype,"LimitCard"),ViewManager.ins().reg(LimitCard,LayerManager.UI_MainUI);var MonthCard=function(t){function e(){var e=t.call(this)||this;return e.skinName="MonthCardSkin",e.gd.itemRenderer=BaseItem,e.gd.dataProvider=new eui.ArrayCollection(ActivetyMgr.ins().getActivityAwards(ConfigMgr.gameConfig.monthMember[1])),e.it.data=ActivetyMgr.ins().getActivityAwards(ConfigMgr.gameConfig.monthMember[2])[0],DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20044,function(t){console.log("----ServerPacket.C_20044----",t.data),e.buyBtn.visible=!1,e.getBtn.label="已 领 取",e.getBtn.enabled=!1,UserVo.ins.monthCardInfo.isReceive=!0},e),DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_30010,function(t){UserVo.ins.monthCardInfo=t.data.monthCardInfo,e.buyBtn.visible=!1,e.getBtn.label="领 取",e.getBtn.enabled=!0},e),e.rc.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){ViewManager.ins().close(e)},e),e.newCloseBtn00.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){ViewManager.ins().close(e)},e),e}return __extends(e,t),e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e);var n=UserVo.ins.monthCardInfo;if(n){var r=n.isReceive;this.buyBtn.visible=!1,r?(this.getBtn.enabled=!1,this.getBtn.label="已 领 取"):(this.getBtn.label="领 取",this.getBtn.enabled=!0),this.left_text.text="剩余"+n.cardEndDay+"天"}else this.getBtn.label="未 达 成",this.buyBtn.visible=!0,this.left_text.text="剩余0天";this.getBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){HttpMgr.ins.sendMessage(ClientPacket.S_10044,{},ServerPacket.LOGIC_URL,!0)},this),this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){var e=ConfigMgr.gameConfig.paymentBase[6];0==ParamMgr.SPID?RechargeVo.ins().sendRechargeOrderRequest(e.mallId):MoneyUtils.recharge(e)},this)},e}(BaseEuiView);__reflect(MonthCard.prototype,"MonthCard"),ViewManager.ins().reg(MonthCard,LayerManager.UI_MainUI);var StageAward=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.activetyID=ActivetyMgr.STAGE_AWARD},e}(BaseActivityPanel);__reflect(StageAward.prototype,"StageAward");var clips;!function(t){var e=3,i=function(t){function e(){var e=t.call(this)||this;return e._jsonLoader=new egret.HttpRequest,e._jsonLoader.responseType=egret.HttpResponseType.TEXT,e._jsonLoader.addEventListener(egret.Event.COMPLETE,e.onJsonComplete,e),e._jsonLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,e.onError,e),e._pngLoader=new egret.ImageLoader,e._pngLoader.crossOrigin="anonymous",e._pngLoader.addEventListener(egret.Event.COMPLETE,e.onPngComplete,e),e._pngLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,e.onError,e),e}return __extends(e,t),Object.defineProperty(e.prototype,"jsonData",{get:function(){return this._json},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},enumerable:!0,configurable:!0}),e.prototype.onError=function(t){this._json=void 0,this._texture=void 0,this.dispatchEventWith(this._path)},e.prototype.onJsonComplete=function(t){this._json=JSON.parse(this._jsonLoader.response),this._pngLoader.load(this._path+".png?v"+this._ver)},e.prototype.onPngComplete=function(t){var e=this._pngLoader.data;this._texture=new egret.Texture,this._texture.bitmapData=e,this.dispatchEventWith(this._path)},e.prototype.loadClip=function(t,e){this._path=t,this._ver=e,this._jsonLoader.open(this._path+".json?v"+this._ver,egret.HttpMethod.GET),this._jsonLoader.send()},e}(egret.EventDispatcher);t.ClipLoader=i,__reflect(i.prototype,"clips.ClipLoader");var n=function(t){function e(){var e=t.call(this)||this;return e.startQueue=!1,e.dispatchQueues=new Array,e.queueUrls=new Array,e.loaderls=new Array,e.pooling=new Array,e.setLoaderCount(5),e}return __extends(e,t),e.prototype.setLoaderCount=function(t){var e,n;for(e=0;t>e;e++)n=new i,this.loaderls.push(n),this.pooling.push(n)},e.prototype.loadClip=function(t,e){this.loadByURLLoader(t,e)},e.prototype.loadByURLLoader=function(t,e){if(this.pooling.length<=0)return void this.queueUrls.push([t,e]);var i=this.pooling.shift();i.addEventListener(t,this.onChildComplete,this),i.loadClip(t,e)},e.prototype.onChildComplete=function(t){var i=t.currentTarget;if(!i)throw new Error("加载器出错！");if(i.removeEventListener(t.type,this.onChildComplete,this),e.delayLoop>0)this.dispatchQueues.push([t.type,new egret.MovieClipDataFactory(i.jsonData,i.texture)]),this.startQueue||(SystemInstance.addTimeHandle(this.delayDispatch,e.delayLoop,this),this.startQueue=!0);else{for(var n;this.dispatchQueues.length;)n=this.dispatchQueues.pop(),this.dispatchEventWith(String(n[0]),void 0,n[1]);this.dispatchEventWith(t.type,void 0,new egret.MovieClipDataFactory(i.jsonData,i.texture))}this.queueUrls.length?(i.addEventListener(String(this.queueUrls[0][0]),this.onChildComplete,this),i.loadClip(String(this.queueUrls[0][0]),String(this.queueUrls[0][1])),this.queueUrls.shift()):this.pooling.push(i)},e.prototype.delayDispatch=function(){if(this.dispatchQueues.length){e.delayLoop-=100;var t=this.dispatchQueues.shift();this.dispatchEventWith(String(t[0]),void 0,t[1])}else SystemInstance.removeTimeHandle(this.delayDispatch)},e.delayLoop=0,e}(egret.EventDispatcher);t.LoadInstance=n,__reflect(n.prototype,"clips.LoadInstance");var r=function(){function t(t,e){this._path=t,this._urls=new Array,this._movs=new Object,e?this._ver=e:this._ver="0"}return Object.defineProperty(t,"loadNum",{get:function(){return t._loadNum},set:function(e){t._loader||(t._loader=new n),RES.setMaxLoadingThread(e),t._loadNum=e},enumerable:!0,configurable:!0}),t.prototype.getBmpClip=function(i,n,r){if(r&&-1!=r.indexOf("undefined"))throw new Error("错误的动作或朝向 "+r);for(var a=i.toString();a.length<e;)a="0"+a;var o=this._path+a;void 0!=r&&(o+=r);var h;if(n){if(h=n,h instanceof s){if(h.url==o)return h;h.url=o}}else h=new s(null,o);if(ModelResMgr._url_moviedatas[o])return h.movieClipData=ModelResMgr._url_moviedatas[o],h.dispatchEventWith(o,ModelResMgr._url_moviedatas[o]),h;h.movieClipData&&(h.movieClipData=null),this._urls[o]||(this._urls[o]=new Array);var l=this._movs[String(h.hashCode)];if(void 0!=l&&l!=o){var p=this._urls[l],c=p.indexOf(h);p.splice(c,1)}return this._urls[o].push(h),t._loader.addEventListener(o,this.onClipComplete,this),t._loader.loadClip(o,this._ver),h},t.prototype.onClipComplete=function(t){var e=t.type,i=t.data;ModelResMgr._url_moviedatas[e]=i.generateMovieClipData();var n=this._urls[e];if(!n)throw new Error("错误的资源url");for(;n.length;)n[0].movieClipData=ModelResMgr._url_moviedatas[e],n[0].dispatchEventWith(e),n.shift()},t._loadNum=1,t}();t.ClipGroup=r,__reflect(r.prototype,"clips.ClipGroup");var s=function(t){function e(e,i){void 0===i&&(i="");var n=t.call(this,e)||this;return n._url="",n._playTimes=0,n._lessPlayTimes=-1,n._playAfterLoaded=!1,n._scaleX=1,n._frameTick=30,n._playLoopTime=0,n.endPlayloop=0,n.isActionEff=!1,n.url=i,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddedToStage,n),n.addEventListener(egret.Event.COMPLETE,n.onPlayComplete,n),n.addEventListener(egret.Event.LOOP_COMPLETE,n.onPlayComplete,n),n}return __extends(e,t),e.create=function(){return ObjectPool.pop("clips.BmpClip")},e.prototype.onDataComplete=function(t){this.removeEventListener(t.type,this.onDataComplete,this),this._playLoopTime>0&&this.isComplete&&(this.frameRate=1e3/(this._playLoopTime/this.totalFrames)),this._playAfterLoaded&&this.play(this._lessPlayTimes),this.scaleX=this._scaleX},e.prototype.setScaleX=function(t){this.scaleX=t,this._scaleX=t},Object.defineProperty(e.prototype,"lastPlayTimes",{get:function(){return this._lessPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playLoopTime",{get:function(){return this._playLoopTime},set:function(t){this._playLoopTime=t,this.isComplete&&(this.frameRate=1e3/(this._playLoopTime/this.totalFrames))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isComplete",{get:function(){return Boolean(this.movieClipData&&this.movieClipData.$isDataValid)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onPlaying",{get:function(){return this._playAfterLoaded||this.isPlaying},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._url},set:function(t){this._url!=t&&(this.removeEventListener(this._url,this.onDataComplete,this),this.movieClipData=null),this._url=t,this.addEventListener(this._url,this.onDataComplete,this),this.addEventListener(egret.Event.COMPLETE,this.onPlayComplete,this),this.addEventListener(egret.Event.LOOP_COMPLETE,this.onPlayComplete,this)},enumerable:!0,configurable:!0}),e.prototype.onAddedToStage=function(t){this._playAfterLoaded&&this.play(this._lessPlayTimes)},e.prototype.onPlayComplete=function(t){this._lessPlayTimes>0&&this._lessPlayTimes--,0==this._lessPlayTimes&&this.stop()},e.prototype.clearData=function(){this.url="",this.movieClipData=null},e.prototype.destruct=function(){this.x=this.y=0,this._playTimes=0,this._lessPlayTimes=-1,this._playAfterLoaded=!1,this._scaleX=1,this._frameTick=30,this._playLoopTime=0,this.endPlayloop=0,this.isActionEff=!1,this.frameRate=12,this.stop(),this.clearData(),this.removeEventListener(egret.Event.COMPLETE,this.onPlayComplete,this),this.removeEventListener(egret.Event.LOOP_COMPLETE,this.onPlayComplete,this),this.parent&&this.parent.contains(this)&&this.parent.removeChild(this),ObjectPool.push(this)},e.prototype.play=function(e){this._playTimes=e,this._lessPlayTimes=e,this._playAfterLoaded=!0,this.isPlaying||t.prototype.play.call(this,e)},e.prototype.stop=function(){this._lessPlayTimes=0,this._playTimes=0,this._playAfterLoaded=!1,t.prototype.stop.call(this)},e.prototype.gotoAndPlay=function(e,i){this._playTimes=i,this._lessPlayTimes=i,this._playAfterLoaded=!0,t.prototype.gotoAndPlay.call(this,e,i)},e.prototype.gotoAndStop=function(e){this._playAfterLoaded=!1,t.prototype.gotoAndStop.call(this,e)},e}(egret.MovieClip);t.BmpClip=s,__reflect(s.prototype,"clips.BmpClip")}(clips||(clips={}));var ClientPacket=function(){function t(){}return t.S_100="GmRequest_100",t.s_10000="HeartBeatRequest_10000",t.S_1002="UserLoginRequest_1002",t.S_1003="GetServerListRequest_1003",t.S_1004="GetServerUrlRequest_1004",t.S_1005="SDKUserLoginRequest_1005",t.S_10001="LoginRequest_10001",t.S_10002="CreatePlayerRequest_10002",t.S_10003="GetBagRequest_10003",t.S_10004="ClearanceRequest_10004",t.S_10005="PlayerDieRequest_10005",t.S_10006="UpgradeSkillRequest_10006",t.S_10007="ChangeColumnSkillRequest_10007",t.S_10008="WearEquipRequest_10008",t.S_10009="UpgradeEquipRequest_10009",t.S_10010="ReinforcedEquipRequest_10010",t.S_10012="DecomposeEquipmentRequest_10012",t.S_10031="TakeOffEquipRequest_10031",t.S_10013="BuyGoodsRequest_10013",t.S_10014="GemMountRequest_10014",t.S_10015="GemRemoveRequest_10015",t.S_10016="GemComposeInBagRequest_10016",t.S_10017="GemComposeInGrooveRequest_10017",t.S_10018="ActivationArtifactRequest_10018",t.S_10019="ReinforcedArtifactRequest_10019",t.S_10020="EnterArenaRequest_10020",t.S_10021="PurchaseChallengeNumRequest_10021",t.S_10022="LaunchChallengeRequest_10022",t.S_10023="FightSettlementRequest_10023",t.S_10024="GetRankingsRequest_10024",t.S_10025="GetRankingsPowerRequest_10025",t.S_10026="ReceiveArenaRewardRequest_10026",t.S_10027="ReceiveTaskRewardRequest_10027",t.S_10028="ChallengePartRequest_10028",t.S_10029="PartSettlementRequest_10029",t.S_10030="RefreshArenaRequest_10030",t.S_10034="GenerateRechargeOrderInfoRequest_10034",t.S_10035="OpenBoxRequest_10035",t.S_10036="SaveGuideRequest_10036",t.S_10032="ReceiveActivityRewardRequest_10032",t.S_10037="ReadEmailRequest_10037",t.S_10038="ReceiveEmailAwardRequest_10038",t.S_10039="AllReceiveEmailAwardRequest_10039",t.S_10040="DelEmailRequest_10040",t.S_10041="AllDelEmailRequest_10041",t.S_10011="RebirthRequest_10011",t.S_10043="ReceiveVipRewardRequest_10043",t.S_10042="DrawCardRequest_10042",t.S_10044="ReceiveMonthCardRequest_10044",t.S_10045="UseGiftCodeRequest_10045",t.S_10046="PurchaseInvestmentRequest_10046",t.S_30000="sendChat_30000",t.S_30001="GetRankingsLevelRequest_30001",t.S_30002="GetRankingsMoneyRequest_30002",t}();__reflect(ClientPacket.prototype,"ClientPacket");var ServerPacket=function(){function t(){}return t.C_10="ErrorMessage_10",t.LOGIN_URL="LoginServer/user.login",t.C_2002="UserLoginResponse_2002",t.C_2003="GetServerListResponse_2003",t.C_2004="GetServerUrlResponse_2004",t.C_2005="SDKUserLoginResponse_2005",t.C_20000="HeartBeatResponse_20000",t.C_20001="LoginResponse_20001",t.C_20002="CreatePlayerResponse_20002",t.C_20003="GetBagResponse_20003",t.C_20004="ClearanceResponse_20004",t.C_20005="PlayerDieResponse_20005",t.C_20006="UpgradeSkillResponse_20006",t.C_20007="ChangeColumnSkillResponse_20007",t.C_20008="WearEquipResponse_20008",t.C_20009="UpgradeEquipResponse_20009",t.C_20010="ReinforcedEquipResponse_20010",t.C_20011="RebirthResponse_20011",t.C_20012="DecomposeEquipmentResponse_20012",t.C_20013="BuyGoodsResponse_20013",t.C_20014="GemMountResponse_20014",t.C_20015="GemRemoveResponse_20015",t.C_20016="GemComposeInBagResponse_20016",t.C_20017="GemComposeInGrooveResponse_20017",t.C_20018="ActivationArtifactResponse_20018",t.C_20019="ReinforcedArtifactResponse_20019",t.C_20020="EnterArenaResponse_20020",t.C_20021="PurchaseChallengeNumResponse_20021",t.C_20022="LaunchChallengeResponse_20022",t.C_20023="FightSettlementResponse_20023",t.C_20024="GetRankingsResponse_20024",t.C_20025="GetRankingsPowerResponse_20025",t.C_20026="ReceiveArenaRewardResponse_20026",t.C_20027="ReceiveTaskRewardResponse_20027",t.C_20028="ChallengePartResponse_20028",t.C_20029="PartSettlementResponse_20029",t.C_20030="RefreshArenaResponse_20030",t.C_20031="TakeOffEquipResponse_20031",t.C_20032="ReceiveActivityRewardResponse_20032",t.C_20034="GenerateRechargeOrderInfoResponse_20034",t.C_20035="OpenBoxResponse_20035",t.C_20037="ReadEmailResponse_20037",t.C_20039="ReceiveEmailAwardChangeResponse_20039",t.C_20041="AllDelEmailResponse_20041",t.C_20042="DrawCardResponse_20042",t.C_20044="ReceiveMonthCardResponse_20044",t.C_20043="ReceiveVipRewardResponse_20043",t.C_20046="PurchaseInvestmentResponse_20046",t.C_30001="RankingRewardChangeResponse_30001",t.C_30002="ItemChangeResponse_30002",t.C_30003="PlayerTaskChangeResponse_30003",t.C_30004="PlayerFightPowerChangeResponse_30004",t.C_30005="PlayerCurrencyChangeResponse_30005",t.C_30006="PlayerActivityInfoChangeResponse_30006",t.C_30007="RefreshStorePurchaseInfoResponse_30007",t.C_30008="PlayerEmailChangeInfoResponse_30008",t.C_30009="PlayerVipLevelChangeResponse_30009",t.C_30010="MonthCardChangeResponse_30010",t.C_40000="chatMessageResponse_40000",t.C_40001="GetRankingsLevelResponse_40001",t.C_40002="GetRankingsMoneyResponse_40002",t}();__reflect(ServerPacket.prototype,"ServerPacket");var DataEventDispatcher=function(){function t(){}return t.dispatchEventWith=function(e,i){t.dispatcher.dispatchEventWith(e,!1,i)},t.dispatcher=new egret.EventDispatcher,t}();__reflect(DataEventDispatcher.prototype,"DataEventDispatcher");var GameEvent=function(){function t(){}return t.CHANGE_MINIMAP="CHANGE_MINIMAP",t.SKILL_UP_LVL="SKILL_UP_LVL",t.UP_PLAYER_PROPERTY="UP_PLAYER_PROPERTY",t.MONSTER_COUNT_CHANGE="MONSTER_COUNT_CHANGE",t.SELECT_SKILL="SELECT_SKILL",t.INIT_ROLE="INIT_ROLE",t.UPDATE_BAG_DATA="UPDATE_BAG_DATA",t.UPDATE_GEM_DATA="UPDATE_GEM_DATA",t.UPDATE_PLAYER_WIN="UPDATE_PLAYER_WIN",t.UPDATE_ARTIFACT_WIN="UPDATE_ARTIFACT_WIN",t.UP_STRENGTH="UP_STRENGTH",t.UP_ADVANCE="UP_ADVANCE",t.UP_SHOP_BUY="UP_SHOP_BUY",t.ADD_EMAIL="ADD_EMAIL",t.REMOVE_EMAIL="REMOVE_EMAIL",t.UP_EMAIL_STATUS="UP_EMAIL_STATUS",t.STUDY_SKILL="STUDY_SKILL",t.WEAR_EQUIPS="WEAR_EQUIPS",t.MONEY_TYPE_CHANGE="MONEY_TYPE_CHANGE",t.UP_CHAT="UP_CHAT",t.RED_MAIN_TASK="RED_MAIN_TASK",t.RED_DAY_TASK="RED_DAY_TASK",t.RED_ACHEIEVEMENT="RED_ACHEIEVEMENT",t.RED_SKILL="RED_SKILL",t.RED_ARTIFACE="RED_ARTIFACE",t.RED_STRENG="RED_STRENG",t.RED_EQUIP_LVL="RED_EQUIP_LVL",t.RED_GEM_LVL="RED_GEM_LVL",t.RED_EMAIL="RED_EMAIL",t.RED_BAG_RED="RED_BAG_RED",t.RED_ACTIVETY="RED_ACTIVETY",t}();__reflect(GameEvent.prototype,"GameEvent");var MessageMgr=function(){function t(){}return t.messageHandler=function(t,e){switch(t){case ServerPacket.C_20006:SkillMgr.ins.upSkillLvl(e),DataEventDispatcher.dispatchEventWith(GameEvent.SKILL_UP_LVL);break;case ServerPacket.C_30003:TaskMgr.ins().upTask(e.changeTaskInfos);break;case ServerPacket.C_20027:TaskMgr.ins().finishTask(e);break;case ServerPacket.C_30007:UserVo.ins.storeInfos=e.storeInfos;break;case ServerPacket.C_20009:ForgeVo.ins().strengthenBack(e);break;case ServerPacket.C_20010:ForgeVo.ins().advanceBack(e);break;case ServerPacket.C_30008:EmailMgr.ins().addEmail(e.playerEmailInfo);break;case ServerPacket.C_20041:EmailMgr.ins().removeEmail(e.delEmailIdList);break;case ServerPacket.C_20039:EmailMgr.ins().readEmail(e.receiveEmailIdList),EmailMgr.ins().getAward(e.receiveEmailIdList);break;case ServerPacket.C_20037:EmailMgr.ins().readEmail(e.emailId);break;case ServerPacket.C_30009:UserVo.ins.upUserVo({vipExp:e.vipExp,vipLevel:e.vipLevel}),UserVo.ins.upUserVo({isRecharge:e.vipExp>0||e.vipLevel>0});break;case ServerPacket.C_40000:ChatMgr.ins().addChatMessage(e);break;default:DataEventDispatcher.dispatchEventWith(t,e)}},t}();__reflect(MessageMgr.prototype,"MessageMgr");var GameLogic=function(){function t(){this.skillMonster=0,this._monsterls=[],this._monsterPooling=[],this._sceneEffects=[],this._pkRolePooling=[],DataEventDispatcher.dispatcher.addEventListener(BaseMap.LOAD_MAP_COMPLETE,this.initModel,this),DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20022,this.createPk,this),DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20004,function(t){t.data.isSuccess||UserTips.ins().showTipsBigToSmall("关卡挑战数据异常!!!"),UserVo.ins.upUserVo({points:t.data.nextId}),UserVo.ins.upUserVo(t.data),this.changeMap(UserVo.ins.points,!1,!1)},this),DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20005,function(t){UserVo.ins.upUserVo({points:t.data.lastId}),this.changeMap(UserVo.ins.points)},this),SystemInstance.addFrameHandle(this.update,this),BagVo.ins().initEvent(),document.addEventListener("keyup",this.GMFun),DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20011,function(e){UserVo._ins.dispose(),UserVo._ins=null,UserVo.ins.setData(e.data.playerInfo,null),this.role.setModelData(UserVo.ins),ViewManager.ins().close(ReborthWin),t.ins.changeMap(UserVo.ins.points),DataEventDispatcher.dispatcher.dispatchEventWith(GameEvent.MONEY_TYPE_CHANGE);for(var i in propertyType)DataEventDispatcher.dispatcher.dispatchEventWith(GameEvent.UP_PLAYER_PROPERTY+i)},this)}return Object.defineProperty(t,"ins",{get:function(){return null==t._ins&&(t._ins=new t),t._ins},enumerable:!0,configurable:!0}),t.prototype.GMFun=function(e){var i=e.keyCode;if(13==i){var n=GameScene.ins.input.text.split(" ");switch(n[0]){case"@s":GameMap.ins().shake(parseInt(n[1]),parseInt(n[2]),parseInt(n[3]));break;case"@as":UserVo.ins.playerAttrInfo.attackSpeed=parseInt(n[1]),Human.ins.upSpeed();break;case"@XY":return void Human.ins.setPosition(parseInt(n[1]),parseInt(n[2]));case"@points":return UserVo.ins.points=parseInt(n[1]),void t.ins.changeMap(UserVo.ins.points,!1,!1);case"@auto":return void(t.AUTO_FIGHT=!t.AUTO_FIGHT);case"@wudi":return void(Human.WU_DI=parseInt(n[1]));case"@die":return void Human.ins.addHp(-99999999999);case"@sw":return void ViewManager.ins().open(MonthCard);case"@fr":return void ViewManager.ins().open(FightResultWin,n[1]);case"@gi":return MoneyUtils.ShowGetWay(n[1]);case"@pro":var r={};return r[n[1]]=parseInt(n[2]),UserVo.ins.upUserVo(r);case"@guide":var s=parseInt(n[1]);if(0==s)for(var a=0;a<Guide.guideCfg.length;a++)GuideMgr._instance.save(Guide.guideCfg[a].id);else GuideMgr._instance.save(s);return}var o={command:n[0],parameter:n[1]};HttpMgr.ins.sendMessage(ClientPacket.S_100,o,ServerPacket.LOGIC_URL,!0)}else 192==i&&(GameScene.ins.input.visible=!GameScene.ins.input.visible,GameScene.ins.input.text=GameScene.ins.input.visible?"GM":"")},t.prototype.update=function(){this.gameRunTick=egret.getTimer(),this.role&&this.role.update(this.gameRunTick),this._pkRole&&this._pkRole.update(this.gameRunTick),GameMap.ins().update(this.gameRunTick);var e;for(e=0;e<this._monsterls.length;e++)this._monsterls[e].update(this.gameRunTick);var i;for(e=this._sceneEffects.length-1;e>=0;e--)if(i=this._sceneEffects[e],i.processMove(this.gameRunTick),i.finish){if(void 0!=i.user&&!i.user.isDie&&!i.user.sleep&&i.target&&i.target instanceof BaseActor&&!i.target.isDie&&!i.target.sleep&&i.target.handleId==i.targetHandle){new Array;i.skill.needTarge?i.skill.singleAttack?this.SkillHitActorEffect(i.skill,i.user,i.target):this.SkillHitActorEffect(i.skill,i.user,i.target.currentX,i.target.currentY,i.target):this.SkillHitActorEffect(i.skill,i.user,i.user.currentX,i.user.currentY)}i.destruct(),this._sceneEffects.splice(e,1)}1!=t.GAME_STATUS&&(this.role&&this.role.isDie&&!this.revivaling&&(this.role.endSkill(),this.revivaling=!0,GameMap.ins().inJJCMap?ViewManager.ins().open(FightResultWin,0,function(){PVPMgr.ins().pVPFightEnd(!1)}):GameMap.ins().inFBMap?ViewManager.ins().open(FightResultWin,2,function(){FBMgr.ins.eixtFb(!0)}):GameMap.ins().inBossMap?ViewManager.ins().open(FightResultWin,4,function(){HttpMgr.ins.sendMessage(ClientPacket.S_10005,{},ServerPacket.LOGIC_URL,!0)}):ViewManager.ins().open(FightResultWin,2,function(){t.ins.changeMap(UserVo.ins.points)})),this.role&&!this.role.isDie&&this._pkRole&&this._pkRole.isDie&&!this.revivaling&&(this.revivaling=!0,egret.setTimeout(function(){ViewManager.ins().open(FightResultWin,1,function(){PVPMgr.ins().pVPFightEnd(!0)})},this,2e3)))},t.prototype.receiveMonster=function(t){t.parent&&t.parent.removeChild(t),t.isDie||t.die();var e=this._monsterls.indexOf(t);-1!=e&&(this._monsterls.splice(e,1),this._monsterPooling.push(t))},t.prototype.changeMap=function(e,i,n){var r=this;if(void 0===e&&(e=0),void 0===i&&(i=!1),void 0===n&&(n=!0),t.GAME_STATUS=1,n){if(this.skillMonster=0,this.role&&(this.role.sleep=!0,this.role.visible=!1),this.clearScene(),!GameMap.ins().gotoScene(e,i))throw new Error("地图切换失败!");e==ConfigMgr.gameConfig.globalConfig.jjcID&&this.pkE&&(this.createPk(this.pkE,!0),this.pkE=null)}else if(Human.ins&&!Human.ins.isDie&&Human.ins.playActionType(ActionType.STAND),GameMap.ins().stopShake(),DataEventDispatcher.dispatchEventWith(GameEvent.MONSTER_COUNT_CHANGE,-2),this.md=[e,i],GameMap.ins().inFBMap||GameMap.ins().inJJCMap)this.changeMap(e,i,!0);else{var s=!this.mc||!this.mc.isComplete;this.mc||(this.mc=new clips.BmpClip,ModelResMgr.getOtherEffect(10041,this.mc),this.mc.addEventListener(egret.Event.COMPLETE,function(){r.mc.gotoAndStop(1),r.mc.parent&&r.mc.parent.removeChild(r.mc),r.changeMap(r.md[0],r.md[1],!0),r.md=null},this)),s?this.changeMap(e,i,!0):(Human.ins.addChildAt(this.mc,0),this.mc.play(1))}},t.prototype.initModel=function(e,i){var n=this;if(void 0===i&&(i=!1),egret.log("地图切换成功！"),i)if(this.createMonsters(),GuideMgr._instance.openFistGuide){var r=new WelcomWin,s=egret.Tween.get(r);s.to({y:0},800,egret.Ease.bounceOut),LayerManager.UI_MainUI.addChild(r)}else t.GAME_STATUS=0;else{DataEventDispatcher.dispatchEventWith(GameEvent.MONSTER_COUNT_CHANGE,GameMap.ins().onHookMap?0:-2),this.revivaling=!1,this.role||(this.role=new Human(ActorRace.HUMAN,AiType.HUMAN),Human.ins=this.role,this.role.setBodyId(ConfigMgr.gameConfig.globalConfig.body[UserVo.ins.jobId-1][UserVo.ins.sex-1]),this.role.setModelData(UserVo.ins),GameMap.ins().addActor(this.role),DataEventDispatcher.dispatchEventWith(GameEvent.INIT_ROLE),RemindMgr.ins());var a=MapVo.ins,o=Math.floor(Math.random()*a.bornPoint.length),h=a.bornPoint[o];this.role.start(),this.role.revival(),this.role.setPosition(h.x,h.y);var l=!this.mc1||!this.mc1.isComplete;this.mc1||(this.mc1=clips.BmpClip.create(),ModelResMgr.getOtherEffect(10040,this.mc1),this.mc1.addEventListener(egret.Event.COMPLETE,function(){n.mc1.gotoAndStop(1),n.mc1.parent&&n.mc1.parent.removeChild(n.mc1),n.role.alpha=1,n.initModel(null,!0)},this)),l?this.initModel(null,!0):(this.role.alpha=0,this.mc1.x=this.role.x,this.mc1.y=this.role.y-300,LayerManager.mapLayer.addChild(this.mc1),this.mc1.play(1))}},t.prototype.createPk=function(e,i){if(void 0===i&&(i=!1),!i)return this.pkE=e.data,ViewManager.ins().close(UIView),ViewManager.ins().close(PVPWin),void t.ins.changeMap(ConfigMgr.gameConfig.globalConfig.jjcID);this._pkRolePooling.length>0?this._pkRole=this._pkRolePooling.pop():this._pkRole=new PKHuman(ActorRace.PK_ROLE,AiType.PK_ROLE),this._pkRole.sleep=!0;var n=new UserVo;n.PK_ROLE_DATA(e);var r=ConfigMgr.gameConfig.globalConfig;this._pkRole.setBodyId(r.body[n.jobId-1][n.sex-1]),this._pkRole.setModelData(n),this._pkRole.revival(),GameMap.ins().addActor(this._pkRole);var s=MapVo.ins;this._pkRole.setPosition(s.refreshPoint[0].x,s.refreshPoint[0].y)},t.prototype.clearScene=function(){for(this.role&&this.role.stop();this._monsterls.length;)this._monsterls[0].destruct();this._pkRole&&this._pkRole.destruct()},t.prototype.createMonsters=function(){if(!GameMap.ins().inJJCMap&&1!=t.GAME_STATUS){var e=MapVo.ins,i=e.refreshPoint[e.refreshDx];if(i)for(var n,r,s=GameMap.ins().inBossMap?1:Math.floor(t.SKILL_MONSTER_COUNT/e.refreshPoint.length),a=0;s>a;a++){n=this._monsterPooling.length>0&&egret.getTimer()-this._monsterPooling[0].receiveTime>1e3?this._monsterPooling.shift():new Monster(ActorRace.MONSTER,AiType.MONSTER_1);var o;o=GameMap.ins().inFBMap?ConfigMgr.gameConfig.partMonster[""+ConfigMgr.gameConfig.partInfo[GameMap.ins().currMapID+""].difficultyFactor]:ConfigMgr.gameConfig.monsterAttr[""+ConfigMgr.gameConfig.pointInfo[UserVo.ins.points+""].difficultyFactor];var h=new MonsterVo(o);n.setBodyId(h.nid),r=MapVo.ins.mapUNMarkNode(i.x,i.y),n.setPosition(r.x,r.y),n.setModelData(h),n.sleep=!1,n.addActionQueue(ActionType.STAND),GameMap.ins().addActor(n),this._monsterls.push(n)
}}},t.prototype.getActorsByType=function(t){var e=new Array;return(t==ActorRace.MONSTER||t==ActorRace.ALL)&&(e=e.concat(this._monsterls)),(t==ActorRace.HUMAN||t==ActorRace.ALL)&&(e=e.concat(this.role)),t!=ActorRace.PK_ROLE&&t!=ActorRace.ALL||!this._pkRole||(e=e.concat(this._pkRole)),e},t.prototype.checkTargetCanStay=function(t){var e,i,n=this.getActorsByType(ActorRace.ALL);for(n=this.checkHitTargets(t.currentX,t.currentY,{w:0,h:0,type:1},n),e=0;e<n.length;e++)if(i=n[e],i!=t&&!i.isMoving)return!1;return!0},t.prototype.checkHitTargets=function(t,e,i,n,r,s){var a=new Array;if(i instanceof StdSkillRange&&-1==i.type)return a;var o,h,l=i.w,p=i.h,c=i.g;i.c;if(1==i.type){var u=new egret.Rectangle(t-l,e-p,2*l,2*p);for(o=n.length-1;o>=0;o--)h=n[o],!h.isDie&&u.contains(h.currentX,h.currentY)&&(n.splice(o,1),a.push(h))}else if(0==i.type){for(o=n.length-1;o>=0;o--)if(h=n[o],!h.isDie){for(var d=!1,g=DisplayMapObject.DIR_LS[r],f=0;c>=f;f++)if(h.currentX==t+g.x*f&&h.currentY==e+g.y*f){d=!0;break}d&&(n.splice(o,1),a.push(h))}}else for(o=n.length-1;o>=0;o--)h=n[o],h.isDie||s.distance(h)<=c&&(n.splice(o,1),a.push(h));return a},t.prototype.skillHitTarget=function(t,e,i){var n,r,s;t.needTarge?(r=i.currentX,s=i.currentY):(r=e.currentX,s=e.currentY);var a;if(t.sceneEffect.length>0){var o=!1;for(n=0;n<t.sceneEffect.length;n++){a=t.sceneEffect[n];var h=DisplayMapEffect.create();if(GameMap.ins().addActor(h),t.sceneEffect[n].type==SkillVo.SKILL_EFF_TYPE_1){if(!i)throw new Error("配置错误!");o=!0,h.setEndHandle(t,e,i),h.setPosition(e.currentX,e.currentY),h.playEffect(t.sceneEffect[n].effect,a.times,a.keepTime,a.flag),h.moveTo(r,s,a.speed),this._sceneEffects.push(h)}else h.setPosition(r,s),h.playEffect(t.sceneEffect[n].effect,a.times,a.keepTime,a.flag),h.moveTo(r,s,0),this._sceneEffects.push(h)}o||(i instanceof BaseActor&&t.singleAttack?this.SkillHitActorEffect(t,e,i):this.SkillHitActorEffect(t,e,r,s,i))}else i instanceof BaseActor&&t.singleAttack?this.SkillHitActorEffect(t,e,i):this.SkillHitActorEffect(t,e,r,s,i)},t.prototype.SkillHitActorEffect=function(e,i){for(var n=this,r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];var a,o,h,l=new Array;1!=r.length?(a=Number(r[0]),o=Number(r[1]),h=r[2]):(l.push(r[0]),h=r[0]),0==l.length&&(l=this.checkHitTargets(a,o,e.skillRange,i.getEnemy(),i.direction,i));var p,c,u=e.unMissileEffects;for(p=0;p<u.length;p++)switch(c=u[p],c.type){case SkillVo.SKILL_EFF_TYPE_0:0==u[p].targeType?-1!=c.keepTime?i.playEffect(c.effect,c.times,this.gameRunTick+c.keepTime,1==c.flag?e.dir:-1):i.playEffect(c.effect,c.times,-1,1==c.flag?e.dir:-1):-1!=c.keepTime?this.addEffectToTargets(l,c.effect,c.times,this.gameRunTick+c.keepTime,1==c.flag?e.dir:-1,h):this.addEffectToTargets(l,c.effect,c.times,-1,1==c.flag?e.dir:-1,h)}var d=l.length,g=1;for(p=0;p<l.length;p++)g=1,e.HitNum&&e.HitNum.length>1&&e.HitNum[p+1]&&(g=parseInt(e.HitNum[p+1])/100),this.hurtActor(e,i,l[p],g);for(var f=e.multipleAttack-d;f>0&&l.length>0;)for(p=l.length-1;p>=0&&!(0>=f);p--)l[p].isDie?l.splice(p,1):(d++,g=1,e.HitNum&&e.HitNum.length>1&&e.HitNum[d]&&(g=parseInt(e.HitNum[d])/100),this.hurtActor(e,i,l[p],g,!1),f--);if(GameMap.ins().onHookMap){if(this.skillMonster>=t.SKILL_MONSTER_COUNT&&1!=t.GAME_STATUS){if(ConfigMgr.gameConfig.pointInfo[UserVo.ins.points+1+""]&&ConfigMgr.gameConfig.pointInfo[UserVo.ins.points+1+""].maptype==MapType.TYPE_1)return void DataEventDispatcher.dispatchEventWith(GameEvent.MONSTER_COUNT_CHANGE,-1);t.GAME_STATUS=1,this.clearScene(),HttpMgr.ins.sendMessage(ClientPacket.S_10004,{},ServerPacket.LOGIC_URL)}}else if(GameMap.ins().inBossMap&&this.skillMonster>=1&&1!=t.GAME_STATUS){t.GAME_STATUS=1;var m=ConfigMgr.gameConfig.pointInfo[GameMap.ins().currMapID],v=MoneyUtils.getMoneyData(m);ViewManager.ins().open(FightResultWin,3,function(){n.clearScene(),HttpMgr.ins.sendMessage(ClientPacket.S_10004,{},ServerPacket.LOGIC_URL)},m.item,v)}if(e.stdSkill.skill_id!=SkillMgr.COMMON_SKILL_ID){var y,_=e.skillHit;if(_){var E;for(p=0;p<_.length;p++)if(y=_[p].split(":"),parseInt(y[1])!=ComAttribute.critRatePCT&&parseInt(y[1])!=ComAttribute.sprint&&"0"!=e.stdSkill.duration){if("0"!=y[0])throw new Error("持续buff作用敌人!");E=BuffVo.create(parseInt(y[1]),parseInt(y[2])),E.endTime=this.gameRunTick+1e3*e.stdSkill.duration+1,i.addBuff(E)}}}},t.prototype.hurtActor=function(t,e,i,n,r){void 0===r&&(r=!0);var s=e.actorVo.playerAttrInfo,a=i.actorVo.playerAttrInfo,o=0==s.critRate?!1:100*Math.random()<s.critRate,h=0,l=1;l=i.nRace==ActorRace.MONSTER?i.actorVo.difficultyFactor:e.nRace==ActorRace.MONSTER?e.actorVo.difficultyFactor:2e3;var p,c,u;if(t.stdSkill.skill_id!=SkillMgr.COMMON_SKILL_ID){var d,g,f=t.skillHit;if(f)for(c=0;c<f.length;c++)switch(d=f[c].split(":"),parseInt(d[1])){case ComAttribute.hurt:if("1"!=d[0])throw new Error("ComAttribute.hurt");h+=parseInt(d[2]);break;case ComAttribute.giddyPCT:if("1"!=d[0])throw new Error("ComAttribute.hurt");p=BuffVo.create(ComAttribute.giddyPCT,0),p.endTime=1e3*parseInt(d[2])+this.gameRunTick,i.addBuff(p);break;case ComAttribute.critRatePCT:if("0"!=d[0])throw new Error("ComAttribute.critRatePCT");o=0==s.critRate?!1:100*Math.random()<s.critRate*(1+parseInt(d[2])/100);break;case ComAttribute.frost:if("1"!=d[0])throw new Error("ComAttribute.hurt");p=BuffVo.create(ComAttribute.frost,0),p.endTime=1e3*parseInt(d[2])+this.gameRunTick,i.addBuff(p);break;case ComAttribute.sprint:if("0"!=d[0])throw new Error("ComAttribute.sprint");g=e.countTargetDirection(i,e.direction),e.sprint(g,t.skillRange.g,i,parseInt(d[2]));break;case ComAttribute.hurtPCT:if("1"!=d[0])throw new Error("ComAttribute.hurtPCT");h+=a.blood*parseInt(d[2])/100}var m;if(""!=t.stdSkill.percentAttack&&"0"!=t.stdSkill.percentAttack){m=t.stdSkill.percentAttack.split(":");var v="1"==m[0]?s.attackInit:s.magicAttack;switch(m[1]){case"1":h+=s.attackInit*(1+s.attackDamage)*parseInt(m[2])/100*(1+s.akillDamage)*(1-a.damageReduction)*(1-a.magicArmorInit/(5*l+a.magicArmorInit));break;case"2":h+=s.magicAttack*parseInt(m[2])/100*(1+s.attackDamage)*(1-a.magicArmorInit/(5*l+a.magicArmorInit));break;default:h+=v*parseInt(m[2])/100*(1+s.akillDamage)*(1+PbPlayerAttrInfo.getSpecialAttr(s,parseInt(m[1])))*(1-a.damageReduction)*(1-a.magicArmorInit/(5*l+a.magicArmorInit))*(1-PbPlayerAttrInfo.getSpecialAttr(a,parseInt(m[1]),!0))*s.propertyPCT}}h=Math.floor(h),h*=o?s.critDamage/100:1}else h+=s.attackInit*(1+s.attackDamage)*(1-Math.ceil(a.armorInit)/(5*l+Math.ceil(a.armorInit)))*(1-a.damageReduction)*(o?s.critDamage/100:1),h+=s.bonusDamage,h=Math.floor(h);if(h=Math.floor(h*n),t.stdSkill.sustainHP&&""!=t.stdSkill.sustainHP&&"0"!=t.stdSkill.sustainHP){var y,_;for(f=t.stdSkill.sustainHP.split("#"),c=0;c<f.length;c++)switch(d=f[c].split(":"),d[0]){case"0":throw new Error("持续加血功能、需要检测！");case"1":if(p=BuffVo.create(BuffType.SUSTAIN_HP,h*parseInt(d[1])),y=d[3].split(","),_=this.gameRunTick,y.length!=parseInt(d[2]))throw new Error("持续BUFF的间隔时间数量跟触发次数不搭!");for(u=0;u<y.length;u++)_+=parseInt(y[u]),p.interval.push(_);p.endTime=_+1,i.addBuff(p)}}(2==Human.WU_DI||3==Human.WU_DI)&&(h=9999999999),i.getBuffByType(ComAttribute.invincible)?egret.log("对方无敌...."):(i.addHp(-h),CutHpEffect.playHp(-Math.floor(h),i,o?1:0,0,r?0:-120)),i.getBuffByType(ComAttribute.thornsPCT)&&(egret.log("对方有反伤BUFF..."),e.addHp[-h*p.value/100]),e.getBuffByType(ComAttribute.leechPCT)&&(egret.log("自带吸血BUFF...."),e.addHp(Math.pow(s.blood,p.value)/100)),i.isDie&&(this.skillMonster++,DataEventDispatcher.dispatchEventWith(GameEvent.MONSTER_COUNT_CHANGE,this.skillMonster))},t.prototype.addEffectToTargets=function(t,e,i,n,r,s){var a,o;for(a=0;a<t.length;a++)o=t[a],o.playEffect(e,i,n,r)},t.prototype.receivePkHuman=function(){this._pkRole&&(this._pkRolePooling.push(this._pkRole),this._pkRole=null)},t.AUTO_FIGHT=!0,t.GAME_STATUS=0,t.SKILL_MONSTER_COUNT=20,t}();__reflect(GameLogic.prototype,"GameLogic");var ActionType=function(){function t(){}return t.getAct=function(t){if(void 0==t||"undefined"==t)return"0";var e=Number(Actions[t]);return isNaN(e)&&(e=0),e>=10?e+"":""+e},t.STAND="stand",t.WALK="walk",t.RUN="run",t.READY="ready",t.FIGHT="fight",t.MAGIC="magic",t.DIE="die",t.ATTACK7="ATTACK7",t.ATTACK8="ATTACK8",t.ATTACK9="ATTACK9",t.ATTACK10="ATTACK10",t.ATTACK11="ATTACK11",t.ATTACK12="ATTACK12",t.ATTACK13="ATTACK13",t.ATTACK88="ATTACK88",t}();__reflect(ActionType.prototype,"ActionType");var Actions;!function(t){t[t.stand=0]="stand",t[t.walk=1]="walk",t[t.run=2]="run",t[t.ready=3]="ready",t[t.fight=4]="fight",t[t.magic=5]="magic",t[t.die=6]="die",t[t.ATTACK7=7]="ATTACK7",t[t.ATTACK8=8]="ATTACK8",t[t.ATTACK9=9]="ATTACK9",t[t.ATTACK10=10]="ATTACK10",t[t.ATTACK11=11]="ATTACK11",t[t.ATTACK12=12]="ATTACK12",t[t.ATTACK13=13]="ATTACK13",t[t.ATTACK88=14]="ATTACK88"}(Actions||(Actions={}));var ActorRace=function(){function t(){}return t.ALL=0,t.HUMAN=1,t.MONSTER=2,t.PK_ROLE=3,t}();__reflect(ActorRace.prototype,"ActorRace");var AiType=function(){function t(){}return t.HUMAN=0,t.MONSTER_1=1,t.PK_ROLE=2,t}();__reflect(AiType.prototype,"AiType");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function r(t){e.call(n,t)}function s(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),i.call(n))}"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(n,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var ArtifactAttrTypePanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="ArtifactAttrTypeSkin",e.dg.itemRenderer=PropertyRender,e}return __extends(e,t),e.prototype.setTile=function(t,e){this.labTile.text=t,0==e?this.dg.left=20:this.dg.right=30},e.prototype.updateType=function(t,e){void 0===e&&(e=0);var i=["power","intellect","alacrity","physique","critRate","critDamage","blood","akillDamage","attackDamage","damageReduction","skillInterval","fireDamage","waterDamage","thunderDamage","windDamage","fireDefenses","waterDefense","thunderDefense","windDefense"],n=ConfigMgr.gameConfig.artifact[t],r=[];if(n)for(var s=0,a=0;a<i.length;a++)n[i[a]]&&n[i[a]]>0&&(r.push([ConfigMgr.gameConfig.attributeName[i[a]].value,n[i[a]]]),s++);this.dg.dataProvider=new eui.ArrayCollection(r)},e}(BaseView);__reflect(ArtifactAttrTypePanel.prototype,"ArtifactAttrTypePanel");var Monster=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n.nextMovePoin=new ASPathNode(0,0,0),n.delayRemove=0,n.nNameLabel=new egret.TextField,n.nNameLabel.touchEnabled=!1,n.nNameLabel.fontFamily="黑体",n.nNameLabel.stroke=1,n.nNameLabel.strokeColor=3081220,n.nNameLabel.textColor=16711680,n.nNameLabel.textAlign=egret.HorizontalAlign.CENTER,n.nNameLabel.size=18,n.addChild(n.nNameLabel),n.nHPBar.y=-180,n.nHPBar._truck.source="hp2",n}return __extends(e,t),e.prototype.setModelData=function(e){this.visible=!0,this.actorVo=e;var i=ConfigMgr.gameConfig.globalConfig;this.nMoveSpeed=e.playerAttrInfo.movingSpeed,this.nAttackSpeed=e.playerAttrInfo.attackSpeed,this.nActionSpeed=i.monsterActionSpeed,this.nReadySpeed=this.nAttackSpeed-this.nActionSpeed,this.nBodyclip.playLoopTime=this.nActionSpeed,this.nHPBar.setPosition(this.actorVo.nHp,this.actorVo.nMaxHp),t.prototype.initBaseActor.call(this)},e.prototype.getBodyModel=function(t,e){ModelResMgr.getMonsterModel(t,this.nBodyclip,e)},e.prototype.AI=function(){if(!this.isDie&&!this.sleep&&0==this.mabiArr.length&&!(this.nActionTypeQueue.length>0||1==GameLogic.GAME_STATUS||0!=this.readytime)){if(!(this.path&&this.path.length>0)){if(null!=this.nTargeter&&void 0!=this.nTargeter){if(this.nTargeter.isDie||this.nTargeter.sleep)return this.lockAttackTarget(void 0),void SystemInstance.nextFrameHandle(this.AI,this);if(this.nSelectdSkill){if(this.distance(this.nTargeter)>this.nSelectdSkill.dis&&!this.onMoveing)return this.path=GameMap.ins().getPath(this.distX,this.distY,this.nTargeter.distX,this.nTargeter.distY,this.moveSpeed/(this.moveSpeed+this.nTargeter.moveSpeed),this.nSelectdSkill.dis),void SystemInstance.nextFrameHandle(this.AI,this);if(!this.nCurrentSkill&&!this.isMoving){if(!GameLogic.ins.checkTargetCanStay(this)){var t=MapVo.ins.mapUNMarkNode(this.nTargeter.distX,this.nTargeter.distY,-2);if(t){if(this.distance(null,t.x,t.y)>2)return this.path=GameMap.ins().getPath(this.distX,this.distY,t.x,t.y,1),void SystemInstance.nextFrameHandle(this.AI,this);if(this.moveTo(t.x,t.y,this.nMoveSpeed))return this.nTargetPoint.x=-1,this.nTargetPoint.y=-1,void this.playActionType(ActionType.RUN)}else egret.log("找不到坑站!")}return void this.playSkill(this.nSelectdSkill)}return}if(this.actorVo.skillArr)for(var e=0;e<this.actorVo.skillArr.length;e++)if(this.actorVo.skillArr[e].canUse)return this.nSelectdSkill=this.actorVo.skillArr[e],void SystemInstance.nextFrameHandle(this.AI,this);if(!SkillMgr.COMMON_SKILL[this.actorVo.jobId].canUse)return;if(this.nActionTypeQueue.length>0)return;return this.nSelectdSkill=SkillMgr.COMMON_SKILL[this.actorVo.jobId],void SystemInstance.nextFrameHandle(this.AI,this)}return Human.ins.sleep||Human.ins.isDie?this.playActionType(ActionType.STAND):this.lockAttackTarget(Human.ins),void SystemInstance.nextFrameHandle(this.AI,this)}if(!this.onMoveing){if(this.nTargeter.isDie||this.nTargeter.sleep)return this.path=null,void this.playActionType(ActionType.STAND);if(this.nextMovePoin=this.path.pop(),this.direction=this.nextMovePoin.nDir,this.moveTo(this.nextMovePoin.nX,this.nextMovePoin.nY,this.nMoveSpeed))return this.nTargetPoint.x=-1,this.nTargetPoint.y=-1,void this.playActionType(ActionType.RUN)}}},e.prototype.playNextAction=function(e){return this.sleep?void((this.nPlayingType==ActionType.DIE||this.isDie)&&this.sendDie()):void t.prototype.playNextAction.call(this,e)},e.prototype.sendDie=function(){0==this.delayRemove&&(this.nBodyclip.gotoAndStop(this.nBodyclip.totalFrames),this.receive())},e.prototype.endMove=function(e){void 0===e&&(e=!0),t.prototype.endMove.call(this,e),this.AI()},e.prototype.getEnemy=function(){var t=GameLogic.ins.getActorsByType(ActorRace.HUMAN);return t},e.prototype.receive=function(){this.readytime=0,MapVo.ins.unMarkNode(this.currentX,this.currentY,MapNode.MONSTER),this.delayRemove>0&&(clearTimeout(this.delayRemove),this.delayRemove=0),this.sleep=!0,this.endSkill(),t.prototype.receive.call(this),GameLogic.ins.receiveMonster(this),this.path=null,this.m_JumpPoints=null},e.prototype.update=function(e){t.prototype.update.call(this,e)},e.prototype.addHp=function(e){t.prototype.addHp.call(this,e),this.actorVo.nHp+=e,this.actorVo.nHp>this.actorVo.nMaxHp&&(this.actorVo.nHp=this.actorVo.nMaxHp),this.actorVo.nHp<=0&&(this.actorVo.nHp=0,this.die(),this.sleep=!0),this.nHPBar.setPosition(this.actorVo.nHp,this.actorVo.nMaxHp)},e.prototype.setPosition=function(e,i){MapVo.ins.unMarkNode(this.currentX,this.currentY,MapNode.MONSTER),t.prototype.setPosition.call(this,e,i),MapVo.ins.markNode(e,i,MapNode.MONSTER)},e}(BaseActor);__reflect(Monster.prototype,"Monster");var Parabola=function(){function t(){}return t.MakeParabolaPoints=function(e,i,n,r,s,a,o){void 0===o&&(o=0),0==o&&(o=t.g);for(var h=new Array(a),l=(n-e)/s,p=(i-r+o*(s*s)/2)/s,c=0,u=s/a,d=0;a>d;++d)c+=u,h[d]=new egret.Point(e+l*c,i-(p*c-o*(c*c)/2));return h},t.g=9.8,t}();__reflect(Parabola.prototype,"Parabola");var PKHuman=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n.nHPBar._truck.source="hp2",n}return __extends(e,t),e.prototype.getEnemy=function(){var t=GameLogic.ins.getActorsByType(ActorRace.MONSTER);return t=t.concat(GameLogic.ins.getActorsByType(ActorRace.HUMAN))},e.prototype.destruct=function(e){void 0===e&&(e=!1),this.path=null,this.nDie=!1,this.sleep=!1,this.visible=!0,this.nTargetPoint.x=this.nTargetPoint.y=-1,this.nTargeter=void 0,this.addHp(this.actorVo.nMaxHp,!1),this.nHPBar.setPosition(this.actorVo.nHp,this.actorVo.nMaxHp);for(var i=this.nBuffs.length;i>=0;i--)this.removeBuff(i);this.sleep=!1,this.nDie=!1,t.prototype.destruct.call(this,e),this.setDie(),this.actorVo=null,GameLogic.ins.receivePkHuman()},e.prototype.setDie=function(){this.sleep=!0,this.nDie=!0},e}(Human);__reflect(PKHuman.prototype,"PKHuman");var ActorHPBar=function(t){function e(){var i=t.call(this)||this;return i._value=1,i._max=1,i._truck=new eui.Image("hp1"),i._frame=new eui.Image("hp0"),i.addChild(i._frame),i.addChild(i._truck),i.setSize(e.INIT_WIDTH,e.INIT_HEIGHT),i}return __extends(e,t),e.prototype.setSize=function(t,i){this._truck.scaleX=t/e.INIT_WIDTH,this._truck.scaleY=i/e.INIT_HEIGHT,this._frame.x=this._truck.x=-t/2,this.setPosition(this._value,this._max)},e.prototype.setPosition=function(t,e){this._value=t,this._max=e,this._value>this._max&&(this._value=this._max),this._truck.scaleX=this._value/this._max},e.INIT_WIDTH=138,e.INIT_HEIGHT=20,e}(egret.DisplayObjectContainer);__reflect(ActorHPBar.prototype,"ActorHPBar");var CutHpEffect=function(t){function e(e){var i=t.call(this)||this;return i.t=e,e==ActorRace.HUMAN?i.font=RES.getRes("fightFontII_fnt"):i.font=RES.getRes("sysFont_fnt"),i.verticalAlign=egret.VerticalAlign.JUSTIFY,i}return __extends(e,t),e.playHp=function(t,i,n,r,s){void 0===n&&(n=1),void 0===r&&(r=0),void 0===s&&(s=-100);var a;a=e.pooling[i.nRace].length?e.pooling[i.nRace].shift():new e(i.nRace),a.isCrit=!1,t==Number.MIN_VALUE?a.text="未命中":0==t?a.text="闪避":n>=1?(a.text="暴击 "+Math.floor(t).toString(),a.isCrit=!0):0>t?a.text=t.toString():a.text="+"+Math.floor(t),i.addChild(a),a.x=-a.textWidth/2+r,a.y=-100+s,a.scaleX=a.scaleY=0,a.tw=egret.Tween.get(a),a.isCrit?a.tw.to({y:-165+s,x:-100,scaleX:.45,scaleY:.45},100).call(a.twEnd,null,[a,0,r,s]):a.tw.to({y:-165+s,scaleX:1.5,scaleY:1.5},300).call(a.twEnd,null,[a,0,r,s])},e.prototype.twEnd=function(t,e,i,n){t.isCrit?0==e?(t.tw=egret.Tween.get(t,null,!0),t.tw.to({y:-180+n,x:-150+i,scaleX:1.65,scaleY:1.65},500,egret.Ease.elasticOut).call(t.twEnd,null,[t,1,i,n])):1==e&&(t.tw=egret.Tween.get(t,null,!0),t.tw.to({x:0+i,alpha:0,scaleX:0,scaleY:0},300).call(t.endEffect,t)):0==e?this.delay=setTimeout(t.twEnd,400,t,1,i,n):(t.tw=egret.Tween.get(t,null,!0),t.tw.to({x:150+i,alpha:0,scaleX:0,scaleY:0},300).call(t.endEffect,t))},e.prototype.endEffect=function(){clearTimeout(this.delay),this.parent&&this.parent.removeChild(this),this.scaleX=this.scaleY=1,this.alpha=1,egret.Tween.removeTweens(this),e.pooling[this.t].push(this)},e.pooling=[[],[],[]],e}(eui.BitmapLabel);__reflect(CutHpEffect.prototype,"CutHpEffect");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var r=RES.getRes(t);r?n(r):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var DisplayMapEffect=function(t){function e(e,i){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var s=t.call(this)||this;return s._isMissile=!1,s._startTime=-1,s._offsetX=s._offsetY=0,s}return __extends(e,t),e.prototype.init=function(){this.skill=void 0,this.user=void 0,this.target=void 0,this._isMissile=!1,this._startTime=-1,this.targetHandle=0,this.visible=!0},e.create=function(){return e.poollings.length>0?(e.poollings[0].init(),e.poollings.shift()):new e},e.prototype.moveTo=function(e,i,n){if(this._startTime=egret.getTimer()+5e3,this.rotation=0,n>0){if(this._isMissile=!0,t.prototype.moveTo.call(this,e,i,n))return this.rotation=180*Math.atan2(this.nSteppingY,this.nSteppingX)/Math.PI+90,!0;this.nStartMoveTick=this.getTimer(),this.nEndMoveTick=this.nStartMoveTick+n,this.nTargetX=e,this.nTargetY=i}else this._isMissile=!1;return!1},Object.defineProperty(e.prototype,"finish",{get:function(){var t=egret.getTimer();if(this._isMissile){if(!this.onMoveing||!this.isMoving)return!0}else if(this._clip&&this._clip.isComplete&&(this._clip.currentFrame==this._clip.totalFrames-1&&this._clip.lastPlayTimes<=0||0!=this._clip.endPlayloop&&this._clip.endPlayloop<t))return!0;return this._startTime<t?!0:!1},enumerable:!0,configurable:!0}),e.prototype.playEffect=function(t,e,i,n,r){void 0===e&&(e=-1),void 0===i&&(i=-1),void 0===n&&(n=0),void 0===r&&(r=0),0>t||(this._clip?ModelResMgr.getSkillEffect(t,this._clip):this._clip=ModelResMgr.getSkillEffect(t),this._offsetX=n,this._offsetY=r,this._clip.isComplete||-1==i?(this._clip.endPlayloop=0,this._clip.play(e)):(this._clip.endPlayloop=i,this._clip.play(e)),this.addChild(this._clip))},e.prototype.setEndHandle=function(t,e,i){this.skill=t,this.user=e,this.target=i,this.targetHandle=i.handleId},e.prototype.destruct=function(t){void 0===t&&(t=!1),this._clip.destruct(),this.parent&&this.parent.removeChild(this),e.poollings.push(this)},e.poollings=new Array,e}(DisplayMapObject);__reflect(DisplayMapEffect.prototype,"DisplayMapEffect");var BaseSpriteLayer=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e}return __extends(e,t),e}(egret.DisplayObjectContainer);__reflect(BaseSpriteLayer.prototype,"BaseSpriteLayer");var GameMap=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.ins=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return t.ins.call(this,e[0])},e.prototype.update=function(t){this.m_dwShakingOverTick&&this.runShakeEffect(t)},e.prototype.shake=function(t,e,i){this.m_nShakeRangeX=t,this.m_nShakeRangeY=e,this.m_dwShakingOverTick=egret.getTimer()+i},e.prototype.stopShake=function(){this.m_dwShakingOverTick&&(this.m_dwShakingOverTick=0)},e.prototype.runShakeEffect=function(t){if(t<this.m_dwShakingOverTick){var e=this.m_nLayersOffsetX,i=this.m_nLayersOffsetY;this.m_nLayersOffsetX=-this.m_nShakeRangeX/2+egret.getTimer()%this.m_nShakeRangeX,this.m_nLayersOffsetY=-this.m_nShakeRangeY/2+egret.getTimer()%this.m_nShakeRangeY,e==this.m_nLayersOffsetX&&0!=this.m_nShakeRangeX&&(this.m_nLayersOffsetX+=-6+1e3*Math.random()%11),i==this.m_nLayersOffsetY&&0!=this.m_nShakeRangeY&&(this.m_nLayersOffsetY+=-6+1e3*Math.random()%11)}else this.m_nLayersOffsetX=this.m_nLayersOffsetY=0,this.m_dwShakingOverTick=0},e}(BaseMap);__reflect(GameMap.prototype,"GameMap");var ASMapCell=function(){function t(){this.X=0,this.Y=0,this.CanNotMove=!1,this.MarkTag=0,this.LastX=-1,this.LastY=-1,this.HCost=0,this.GCost=0,this.FValue=0,this.State=0,this.btDir=0}return t.CSNONE=0,t.CSOPEN=1,t.CSCLOSE=2,t}();__reflect(ASMapCell.prototype,"ASMapCell");var ASPath=function(){function t(){this.m_nMarkTag=0}return t.prototype.initFromMap=function(){var t=MapVo.ins;this.m_nWidth=t.gridCols,this.m_nHeight=t.gridRows;var e=this.m_nWidth*this.m_nHeight;this.m_ASMapCells=[];for(var i=0;e>i;i++)this.m_ASMapCells[i]=new ASMapCell;var n,r,s,a;for(s=0,r=0;r<this.m_nHeight;r++)for(n=0;n<this.m_nWidth;n++)a=this.m_ASMapCells[s],a.X=n,a.Y=r,a.CanNotMove=!t.moveable(n,r),s++},t.prototype.getPatch=function(e,i,n,r){if(e==n&&i==r)return null;if(0>e||e>=this.m_nWidth||0>i||i>=this.m_nHeight)return null;if(0>n||n>=this.m_nWidth||0>r||r>=this.m_nHeight)return null;if(this.m_ASMapCells[r*this.m_nWidth+n].CanNotMove)return null;this.reset(e,i);var s=!1,a=e,o=i,h=this.m_ASMapCells[o*this.m_nWidth+a];h.GCost=0,h.LastX=-1,h.LastY=-1,h.X=a,h.Y=o,h.MarkTag=this.m_nMarkTag,h.HCost=Math.abs(n-e)+10*Math.abs(r-i);for(var l,p,c,u;;){if(a==n&&o==r){s=!0;break}for(h.State!=ASMapCell.CSCLOSE&&this.closeCell(h),l=0;8>l;++l)p=a+t.NEIGHBORPOS_X_VALUES[l],c=o+t.NEIGHBORPOS_Y_VALUES[l],0>p||p>=this.m_nWidth||0>c||c>=this.m_nHeight||(u=this.m_ASMapCells[c*this.m_nWidth+p],u.CanNotMove||(u.MarkTag!=this.m_nMarkTag||u.State==ASMapCell.CSNONE?(u.MarkTag=this.m_nMarkTag,u.LastX=a,u.LastY=o,u.btDir=l,u.GCost=h.GCost+t.AS_MOVECOST[1&l],u.HCost=Math.abs(n-p)+10*Math.abs(r-c),this.openCell(u)):u.State==ASMapCell.CSOPEN&&u.GCost>h.GCost+t.AS_MOVECOST[1&l]&&(u.LastX=a,u.LastY=o,u.btDir=l,u.GCost=h.GCost+t.AS_MOVECOST[1&l],this.reopenCell(u))));if(h=this.m_LastOpenCell,null==h)break;a=h.X,o=h.Y}if(s){for(var d=[];;)if(d.push(new ASPathNode(h.X,h.Y,h.btDir)),h=this.m_ASMapCells[h.LastY*this.m_nWidth+h.LastX],h.LastX<0||h.MarkTag!=this.m_nMarkTag)break;return d}return null},t.prototype.reset=function(t,e){var i=this.m_ASMapCells[e*this.m_nWidth+t];i.LastX=-1,i.LastY=-1,i.HCost=0,i.GCost=0,i.FValue=0,i.State=0,i.Prev=null,i.Next=null,i.btDir=0,this.m_LastOpenCell=null,this.m_nMarkTag=this.m_nMarkTag+1},t.prototype.closeCell=function(t){t.State==ASMapCell.CSOPEN&&(t.Prev&&(t.Prev.Next=t.Next),t.Next&&(t.Next.Prev=t.Prev),t==this.m_LastOpenCell&&(this.m_LastOpenCell=t.Prev)),t.State=ASMapCell.CSCLOSE},t.prototype.openCell=function(t){t.State=ASMapCell.CSOPEN;var e=t.HCost+t.GCost;t.FValue=e;var i=this.m_LastOpenCell;if(i){for(;i.FValue<e;){if(null==i.Prev)return i.Prev=t,t.Prev=null,void(t.Next=i);i=i.Prev}t.Prev=i,i.Next?(t.Next=i.Next,i.Next.Prev=t,i.Next=t):(t.Next=null,i.Next=t,this.m_LastOpenCell=t)}else this.m_LastOpenCell=t,t.Prev=null,t.Next=null},t.prototype.reopenCell=function(t){var e=t.HCost+t.GCost;t.FValue=e;var i=t.Next;if(i&&i.FValue>e){do i=i.Next;while(i&&i.FValue>e);t.Prev&&(t.Prev.Next=t.Next),t.Next&&(t.Next.Prev=t.Prev),i?(t.Next=i,i.Prev?(t.Prev=i.Prev,i.Prev.Next=t):t.Prev=null,i.Prev=t):(t.Prev=this.m_LastOpenCell,t.Next=null,this.m_LastOpenCell.Next=t,this.m_LastOpenCell=t)}},t.RMOVECOST=14,t.DMOVECOST=10,t.AS_MOVECOST=[t.DMOVECOST,t.RMOVECOST],t.NEIGHBORPOS_X_VALUES=[0,1,1,1,0,-1,-1,-1],t.NEIGHBORPOS_Y_VALUES=[-1,-1,0,1,1,1,0,-1],t}();__reflect(ASPath.prototype,"ASPath");var ASPathNode=function(){function t(t,e,i){this.nX=t,this.nY=e,this.nDir=i}return t}();__reflect(ASPathNode.prototype,"ASPathNode");var ActivetyMgr=function(t){function e(){var e=t.call(this)||this;e.activeConfig={};for(var i=ConfigMgr.gameConfig.operationActivityDetail,n=0;n<i.length;n++)e.activeConfig[i[n].activityId]||(e.activeConfig[i[n].activityId]=[]),e.activeConfig[i[n].activityId].push(i[n]);return e}return __extends(e,t),e.ins=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return t.ins.call(this,e)},e.prototype.getActivityAwards=function(t){var e,i,n=[],r=[];if(""!=t.awardGoods&&"0"!=t.awardGoods){r=t.awardGoods.split("#");for(var s=0;s<r.length;s++)i=r[s].split(":"),e=new ItemInfo,e.itemId=parseInt(i[0]),e.itemNum=parseInt(i[1]),n.push(e)}if(""!=t.awardCurrency&&"0"!=t.awardCurrency){r=t.awardCurrency.split("#");for(var s=0;s<r.length;s++)i=r[s].split(":"),e=new ItemInfo,e.moneyType=i[0],e.itemNum=parseInt(i[1]),n.push(e)}return n},e.prototype.checkAtivityEnd=function(t,e){for(var i=UserVo.ins.activityInfos,n=0;n<i.length;n++)if(i[n].activityId==t)for(var r=i[n].completedActivityInfos,s=0;s<r.length;s++)if(r[s].activityIndex==e)return r[s].isReward;return-1},e.FIRST_CHARGE=1e3,e.CONTINUE_LOGIN=1001,e.STAGE_AWARD=1002,e.MONTH_CARD=1003,e.INVEST_PLAN=1004,e.CONSUME_GIFT=1005,e.LIMIT_CARD=1006,e.MAX_ACTIVE=10007,e}(BaseClass);__reflect(ActivetyMgr.prototype,"ActivetyMgr");var ChatMgr=function(t){function e(){var e=t.call(this)||this;return e.chatArr=[],e}return __extends(e,t),e.ins=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return t.ins.call(this,e)},e.prototype.addChatMessage=function(t){var e=ObjectPool.pop("ChatVo");e.type=t.type,e.des=t.content,e.id=t.id,e.playName=t.playName,e.vipLvl=t.vipLevel,e.sex=t.sex,this.chatArr.push(e),DataEventDispatcher.dispatchEventWith(GameEvent.UP_CHAT)},e}(BaseClass);__reflect(ChatMgr.prototype,"ChatMgr");var ChatVo=function(){function t(){}return t}();__reflect(ChatVo.prototype,"ChatVo");var ConfigMgr=function(){function t(){}return Object.defineProperty(t,"ins",{get:function(){return null==t._ins&&(t._ins=new t),t._ins},enumerable:!0,configurable:!0}),t.prototype.loadConfig=function(){this.configLoad=new egret.URLLoader,this.configLoad.dataFormat=egret.URLLoaderDataFormat.BINARY,this.configLoad.addEventListener(egret.Event.COMPLETE,this.loadZipCom,this),this.configLoad.addEventListener(egret.IOErrorEvent.IO_ERROR,this.loadZipErr,this);var t=ParamMgr.ressite+ParamMgr.gameSynRes+"/config/config.ce?v="+ParamMgr.ver,e=new egret.URLRequest(t);this.configLoad.load(e)},t.prototype.loadZipCom=function(e){var i=new JSZip(e.target.data);t.gameConfig={};for(var n in i.files){var r=new egret.ByteArray(i.file(n).asArrayBuffer()),s=r.readUTFBytes(r.readAvailable);t.gameConfig[n.replace(".json","")]=JSON.parse(s)}for(var a=t.gameConfig.globalConfig.guideCondition,o=0;o<Guide.guideCfg.length;o++)for(var h=0;h<a.length;h++)if(Guide.guideCfg[o].id==a[h].guideId){Guide.guideCfg[o].tiggers=a[h].tiggers,Guide.guideCfg[o].des=a[h].des;break}egret.log("配置加载完毕！"),this.debugVer(),DataEventDispatcher.dispatchEventWith(t.LOAD_CONFIG_END)},t.prototype.loadZipErr=function(t){egret.log("配置加载错误！")},t.prototype.debugVer=function(){},t.LOAD_CONFIG_END="LOAD_CONFIG_END",t}();__reflect(ConfigMgr.prototype,"ConfigMgr");var EmailMgr=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return t.ins.call(this,e)},e.prototype.addEmail=function(t){UserVo.ins.emailInfos||(UserVo.ins.emailInfos=[]),UserVo.ins.emailInfos.unshift(t),DataEventDispatcher.dispatchEventWith(GameEvent.ADD_EMAIL)},e.prototype.readEmail=function(t){for(var e=UserVo.ins.emailInfos,i=0;i<e.length;i++)if(e[i].emailId==t){e[i].readState=1;break}DataEventDispatcher.dispatchEventWith(GameEvent.UP_EMAIL_STATUS,[t])},e.prototype.removeEmail=function(t){for(var e=UserVo.ins.emailInfos,i=0;i<t.length;i++)for(var n=0;n<e.length;n++)if(e[n].emailId==t[i]){e.splice(n,1);break}DataEventDispatcher.dispatchEventWith(GameEvent.REMOVE_EMAIL,t)},e.prototype.getAward=function(t){for(var e=UserVo.ins.emailInfos,i=0;i<t.length;i++)for(var n=0;n<e.length;n++)if(e[n].emailId==t[i]){e[n].itemState=1;break}DataEventDispatcher.dispatchEventWith(GameEvent.UP_EMAIL_STATUS,t)},e}(BaseClass);__reflect(EmailMgr.prototype,"EmailMgr");var ErrorMgr=function(t){function e(){var e=t.call(this)||this;return e.ErrorCode=[],e.ErrorCode[0]="系统错误!",e.ErrorCode[1]="角色不存在",e.ErrorCode[2]="角色名称长度应为1-8",e.ErrorCode[3]="角色名称含有特殊字符",e.ErrorCode[4]="角色名称包含屏蔽字",e.ErrorCode[5]="已经有角色了不可以再创建了",e.ErrorCode[7]="登陆游戏token异常",e.ErrorCode[8]="登陆游戏token超时了",e.ErrorCode[10]="名字已存在",e.ErrorCode[11]="重生次数不足",e.ErrorCode[12]="竞技场次数不足",e.ErrorCode[13]="自己正在战斗中",e.ErrorCode[14]="对方正在战斗中",e.ErrorCode[15]="对方不存在",e.ErrorCode[16]="奖励不存在",e.ErrorCode[17]="任务没达成，不能领取奖励",e.ErrorCode[18]="已领取过奖励",e.ErrorCode[19]="无法领取",e.ErrorCode[20]="已领取过月卡奖励",e.ErrorCode[21]="没有月卡信息",e.ErrorCode[22]="激活码无效",e.ErrorCode[23]="激活码有效时间已过",e.ErrorCode[24]="同组激活码只能使用一次",e.ErrorCode[25]="激活码已使用过",e.ErrorCode[26]="投资计划已购买过，无法购买",e}return __extends(e,t),e.ins=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return t.ins.call(this,e)},e.prototype.showError=function(t,e){void 0===t&&(t=-1),void 0===e&&(e=""),-1!=t&&(e=this.ErrorCode[t]),UserTips.ins().showTipsBigToSmall(e)},e}(BaseClass);__reflect(ErrorMgr.prototype,"ErrorMgr");var FBMgr=function(){function t(){this.delay=!1,this.fbConfig=ConfigMgr.gameConfig.partInfo,this.fbData=[];var t;for(var e in this.fbConfig)t=this.fbConfig[e],this.fbData[t.partType-1]||(this.fbData[t.partType-1]=[]),this.fbData[t.partType-1][t.partRank-1]||(this.fbData[t.partType-1][t.partRank-1]=t);DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20028,this.gotoScene,this),DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20029,this.exitFbBack,this)}return Object.defineProperty(t,"ins",{get:function(){return null==t._ins&&(t._ins=new t),t._ins},enumerable:!0,configurable:!0}),t.prototype.gotoScene=function(t){t.data.isSuccess&&(ViewManager.ins().close(UIView),ViewManager.ins().close(PVEWinII),GameLogic.ins.changeMap(t.data.partId,!0),UserVo.ins.upFbCount(t.data))},t.prototype.exitFbBack=function(t){if(t.data.isSuccess){UserVo.ins.upUserVo(t.data);ConfigMgr.gameConfig.partInfo[t.data.partId+""]}},t.prototype.eixtFb=function(t){void 0===t&&(t=!1),HttpMgr.ins.sendMessage(ClientPacket.S_10029,{partId:GameMap.ins().currMapID,isVictory:t},ServerPacket.LOGIC_URL,!0),t&&GameLogic.ins.changeMap(UserVo.ins.points)},t.prototype.checkChangeMap=function(){var e=this,i=GameMap.ins().currMapID,n=ConfigMgr.gameConfig.partInfo[i+""];
if(0==n.nextPartID){if(!this.delay){this.delay=!0;var r=ConfigMgr.gameConfig.partInfo[GameMap.ins().currMapID+""],s=MoneyUtils.getMoneyData(r);ViewManager.ins().open(FightResultWin,3,function(){t.ins.eixtFb(!0),e.delay=!1},r.item,s)}}else this.eixtFb(),GameLogic.ins.changeMap(n.nextPartID,!0)},t.prototype.getCountByType=function(t){for(var e=ConfigMgr.gameConfig.partInfo[t],i=UserVo.ins.partChallengNumInfos,n=0;n<i.length;n++)if(i[n].partType==e.partType)return i[n].partChallengNum},t}();__reflect(FBMgr.prototype,"FBMgr");var GameSocket=function(t){function e(){var e=t.call(this,ParamMgr.serverUrl)||this;return e.type=egret.WebSocket.TYPE_BINARY,e.initEvnet(),e}return __extends(e,t),Object.defineProperty(e,"ins",{get:function(){return null==e._ins&&(e._ins=new e),e._ins},enumerable:!0,configurable:!0}),e.prototype.initEvnet=function(){this.addEventListener(egret.Event.CONNECT,this.onSockConnect,this),this.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onSocketDate,this),this.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this)},e.prototype.onSocketDate=function(t){var e=new egret.ByteArray;this.readBytes(e),HttpMgr.serverMessage(e)},e.prototype.onSocketError=function(t){GameLogic.GAME_STATUS=1,ViewManager.ins().open(TipsWin,"确定","网络已断开,请重新连接","提示","",function(){location.replace(document.referrer)},null,this)},e.prototype.onSocketClose=function(t){SystemInstance.removeTimeHandle(this.sendHeart),GameLogic.GAME_STATUS=1,ViewManager.ins().open(TipsWin,"确定","网络已断开,请重新连接","提示","",function(){location.replace(document.referrer)},null,this)},e.prototype.onSockConnect=function(t){SystemInstance.addTimeHandle(this.sendHeart,3e4,this)},e.prototype.sendHeart=function(){HttpMgr.ins.sendMessage(ClientPacket.s_10000,{},ServerPacket.LOGIC_URL)},e.prototype.sendSocket=function(t,e){void 0===e&&(e=!1),this.connected&&(t.bytes,this.writeBytes(t))},e}(egret.WebSocket);__reflect(GameSocket.prototype,"GameSocket");var tigger;!function(t){t[t.rebirthNum=0]="rebirthNum",t[t.points=1]="points",t[t.level=2]="level",t[t.guideEndId=3]="guideEndId",t[t.sceneType=4]="sceneType",t[t.closeUid=5]="closeUid",t[t.openUid=6]="openUid"}(tigger||(tigger={}));var uid;!function(t){t[t.fubenType=0]="fubenType",t[t.skill0=1]="skill0",t[t.skill1=2]="skill1",t[t.bag=3]="bag",t[t.equipBtn=4]="equipBtn",t[t.bagItem=5]="bagItem",t[t.itemcd=6]="itemcd",t[t.itemParent=7]="itemParent",t[t.mainUiBtn=8]="mainUiBtn",t[t.roleBtn=9]="roleBtn",t[t.forgeBtn0=10]="forgeBtn0",t[t.forgeBtn1=11]="forgeBtn1",t[t.forgeEquip=12]="forgeEquip",t[t.forgeBtn2=13]="forgeBtn2",t[t.forgeBtn3=14]="forgeBtn3",t[t.forgeBtn4=15]="forgeBtn4",t[t.forgeBtn5=16]="forgeBtn5",t[t.bossBtn=17]="bossBtn",t[t.af0=18]="af0",t[t.af1=19]="af1",t[t.af2=20]="af2",t[t.af3=21]="af3",t[t.afParent=22]="afParent",t[t.fb0=23]="fb0",t[t.fb1=24]="fb1",t[t.fb2=25]="fb2",t[t.fb11=26]="fb11",t[t.fb111=27]="fb111",t[t.rw0=28]="rw0",t[t.rw1=29]="rw1",t[t.rwParent=30]="rwParent",t[t.jn0=31]="jn0",t[t.jn1=32]="jn1",t[t.jn2=33]="jn2",t[t.jn3=34]="jn3",t[t.jn4=35]="jn4",t[t.jnP0=36]="jnP0",t[t.jnP1=37]="jnP1",t[t.jnP2=38]="jnP2",t[t.bs0=39]="bs0",t[t.bs1=40]="bs1",t[t.bs2=41]="bs2",t[t.bs3=42]="bs3",t[t.bs4=43]="bs4",t[t.bsParent=44]="bsParent",t[t.p0=45]="p0",t[t.p1=46]="p1",t[t.rl0=47]="rl0",t[t.rl1=48]="rl1",t[t.cj0=49]="cj0",t[t.cj1=50]="cj1",t[t.cjParent=51]="cjParent",t[t.back0=52]="back0",t[t.back1=53]="back1",t[t.back2=54]="back2",t[t.beginGame=55]="beginGame",t[t.beginGameP=56]="beginGameP",t[t.cs0=57]="cs0",t[t.cs1=58]="cs1"}(uid||(uid={}));var guideStep;!function(t){t[t.init=0]="init",t[t.onTigger=1]="onTigger",t[t.onReady=2]="onReady",t[t.onAction=3]="onAction",t[t.End=4]="End"}(guideStep||(guideStep={}));var TiggerStruct=function(){function t(t){this.id=t.id,this.min=t.min,this.max=t.max,this.value=t.value}return t.prototype.check=function(t){return void 0==t?!0:void 0!=this.min&&void 0!=this.max?Boolean(t>=this.min&&t<=this.max):void 0!=this.min?Boolean(t>=this.min):void 0!=this.max?Boolean(t<=this.max):void 0!=this.value?Boolean(t==this.value):!0},Object.defineProperty(t.prototype,"data",{get:function(){return this.value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this.id},enumerable:!0,configurable:!0}),t}();__reflect(TiggerStruct.prototype,"TiggerStruct");var Guide=function(){function t(e,i){if(this._id=0,this._status=0,this.tiggerNum=0,this.tiggerVal=new Object,this.hideVal=new Object,this.endActions=new Object,this.actions=new Array,this.currUid=0,t.pointer||(t.pointer=new Pointer),!e)throw new Error("无效的指引配置！"+i);this._id=e.id;var n=e.tiggers;this.tiggerNum=n.length,n.sort(function(t,e){return t.id>e.id?1:0});for(var r=0;r<n.length;r++)this.tiggerVal[String(n[r].id)]=new TiggerStruct(n[r]),GuideMgr.addTiggerEventListener(n[r].id,this.tiggerFunc,this);var s=e.hideTiggers;if(s)for(r=0;r<s.length;r++)this.hideVal[String(s[r].id)]=new TiggerStruct(s[r]);var a=e.breakOff;if(a)for(r=0;r<a.length;r++)this.endActions[String(a[r].id)]=new TiggerStruct(a[r]),GuideMgr.addTiggerEventListener(a[r].id,this.breakOff,this);var o=e.actions;for(r=0;r<o.length;r++)this.actions.push(o[r]);this._status=guideStep.onTigger}return Object.defineProperty(t.prototype,"status",{get:function(){return this._status},set:function(t){this._status=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),t.prototype.tiggerFunc=function(t){if(this._status==guideStep.onTigger){var e=this.tiggerVal[t.type];if(!e||e.check(t.data)){if(GuideMgr.removeTiggerEventListener(t.type,this.tiggerFunc,this),Number(t.type)==tigger.guideEndId){this.tiggerNum=0;for(var i in this.tiggerVal)e=this.tiggerVal[i],e&&Number(i)!=tigger.guideEndId&&(this.tiggerNum++,GuideMgr.addTiggerEventListener(Number(i),this.tiggerFunc,this));if(0!=this.tiggerNum)return}this.tiggerNum--,this.tiggerNum<=0&&(this._status=guideStep.onReady,GuideMgr.addGuide(this))}}},t.prototype.breakOff=function(t){if(this._status==guideStep.onAction){var e=this.endActions[t.type];if(!e||e.check(t.data)){for(var i in this.breakOff)GuideMgr.removeTiggerEventListener(i.toString(),this.breakOff,this);this.end()}}},t.prototype.start=function(){this._status=guideStep.onAction;var t,e;for(t=this.actions.length-1;t>=0;t--)e=this.actions[t],GuideMgr.addUidEventListener(Number(e.uid),this.actFunc,this)},t.prototype.update=function(){if(this._status!=guideStep.End){var e,i,n,r=!1;for(0==this.actions.length&&this.end(),e=this.actions.length-1;e>=0;e--)if(i=this.actions[e],!(this.currUid<e)){if(i.uid==uid.mainUiBtn){var s=ViewManager.ins().getView(MainUIWin);s.g0.visible&&(this.currUid++,i=this.actions[e+1])}if(n=UIDmgr.getUIByUID(Number(i.uid)),n&&SystemInstance.checkDisplayVisibled(n)){t.pointer.pointerTo(n,i.parent,i),r=!0;break}}t.pointer.visible=this.checkHide()&&r?!0:!1}},t.prototype.checkHide=function(){var t,e;for(t in this.hideVal)switch(e=this.hideVal[t],e.type){case tigger.openUid:var i=UIDmgr.getUIByUID(e.data);if(i&&SystemInstance.checkDisplayVisibled(i))return!0;break;case tigger.closeUid:var i=UIDmgr.getUIByUID(e.data);if(!i||!SystemInstance.checkDisplayVisibled(i))return!0;break;case tigger.sceneType:return!0}return!1},t.prototype.actFunc=function(t){if(t.data){var e=Number(t.data),i=this.actions[this.actions.length-1];Number(i.uid)==e&&this.end();for(var n=0;n<this.actions.length;n++)if(this.actions[n].uid==e){this.currUid=n+1;break}}},t.prototype.end=function(){for(var e=0;e<this.actions.length;e++)GuideMgr.removeUidEventListener(String(this.actions[e].uid),this.actFunc,this);this._status=guideStep.End,t.pointer&&t.pointer.hide(),GuideMgr.dispatchTiggerEvent(tigger.guideEndId,this._id)},t.guideCfg=[{id:1,tiggers:[],actions:[{uid:uid.beginGame,des:"点击开始游戏",dir:0}],hideTiggers:[{id:tigger.sceneType,value:MapType.TYPE_0}],des:[]},{id:4,tiggers:[],actions:[{uid:uid.mainUiBtn,des:"点击主页",dir:3},{uid:uid.jn0,des:"打开技能界面",dir:2},{uid:uid.jn1,des:"选择第一个技能",dir:2},{uid:uid.jn3,des:"直接装配技能",dir:2},{uid:uid.back0,des:"返回主页",dir:1},{uid:uid.back1,des:"返回战斗界面",dir:2},{uid:uid.skill0,des:"释放技能",dir:2}],hideTiggers:[{id:tigger.sceneType,value:MapType.TYPE_0}],des:[]},{id:3,tiggers:[],actions:[{uid:uid.mainUiBtn,des:"点击主页",dir:3},{uid:uid.bag,des:"进入背包",dir:2},{uid:uid.equipBtn,des:"打开装备背包",dir:2},{uid:uid.bagItem,parent:uid.itemParent,des:"点击装备物品",dir:0},{uid:uid.itemcd,des:"点击穿戴装备",dir:0},{uid:uid.back0,des:"关闭界面返回",dir:1},{uid:uid.back1,des:"回到关卡",dir:2}],hideTiggers:[{id:tigger.sceneType,value:MapType.TYPE_0}],des:[]},{id:2,tiggers:[],actions:[{uid:uid.bossBtn,des:"进入关卡BOSS",dir:2}],hideTiggers:[{id:tigger.sceneType,value:MapType.TYPE_0}],des:[]},{id:5,tiggers:[],actions:[{uid:uid.cs0,des:"点击重生",dir:1},{uid:uid.cs1,des:"点击重生",dir:2}],hideTiggers:[{id:tigger.sceneType,value:MapType.TYPE_0}],des:[]}],t}();__reflect(Guide.prototype,"Guide");var GuideMgr=function(){function t(){this.guides=new Array,this.tiggerDispatcher=new egret.EventDispatcher,this.uidDispatcher=new egret.EventDispatcher,this.openFistGuide=!1,this.guideQueues=new Array,SystemInstance.addTimeHandle(this.update,100,this)}return t.isGuidIng=function(e){return t.currentGuide&&t.currentGuide.id==e},t.createAndInit=function(e){t._instance=new t;var i,n,r,s=0,a=new Array,o=new Array;for(i=0;i<Guide.guideCfg.length;i++){if(void 0!=o[Guide.guideCfg[i].id])throw new Error("指引编号定义重复！"+Guide.guideCfg[i].id);o[Guide.guideCfg[i].id]=Guide.guideCfg[i]}for(t._instance.records=new Array,i=0;i<e.length;i++)for(r=e[i],t._instance.records.push(r),n=0;32>n;n++)o[s]&&(0!=(r&1<<n)||UserVo.NO_GUIDE?a.push(s):(t._instance.guides.push(new Guide(o[s],s)),1==s&&(t._instance.openFistGuide=!0))),s++;for(i=0;i<a.length;i++)t.dispatchTiggerEvent(tigger.guideEndId,a[i])},t.checkGuideHasDone=function(e){var i=Math.floor(e/32),n=t._instance.records[i];return void 0!=n?Boolean(n&Math.pow(2,e%32)):!1},t.prototype.setRecords=function(t){this.records=t},t.prototype.haveGuide=function(t){var e=Math.floor(t/32),i=this.records[e];void 0==i&&(i=0);var n=t%32,r=i&1<<n;return r>0},t.prototype.save=function(t){var e=Math.floor(t/32),i=this.records[e];void 0==i&&(i=0);var n=t%32;i|=1<<n,this.records[e]=i,HttpMgr.ins.sendMessage(ClientPacket.S_10036,{guideStep:i},ServerPacket.LOGIC_URL,!0)},t.prototype.update=function(){if(!(this.guideQueues.length<=0)){var e=this.guideQueues[0];e.status==guideStep.onReady?(e.start(),t.currentGuide=e):e.status==guideStep.End?(this.save(e.id),this.guideQueues.shift(),t.currentGuide=null):e.update()}},t.addGuide=function(e){t._instance.guideQueues.push(e)},t.dispatchTiggerEvent=function(e,i){t._instance.tiggerDispatcher.dispatchEventWith(e.toString(),void 0,i)},t.dispatchUidEvent=function(e){t._instance&&t._instance.uidDispatcher&&t._instance.uidDispatcher.dispatchEventWith(e.toString(),void 0,e)},t.addTiggerEventListener=function(e,i,n){t._instance.tiggerDispatcher.addEventListener(e.toString(),i,n)},t.removeTiggerEventListener=function(e,i,n){t._instance.tiggerDispatcher.removeEventListener(e,i,n)},t.addUidEventListener=function(e,i,n){t._instance.uidDispatcher.addEventListener(e.toString(),i,n)},t.removeUidEventListener=function(e,i,n){t._instance.uidDispatcher.removeEventListener(e,i,n)},t.recordSize=1,t}();__reflect(GuideMgr.prototype,"GuideMgr");var UIDmgr=function(){function t(){}return t.getUIByUID=function(e){return t.uilst[e]},t.hasBinding=function(e,i){var n=t.uilst[i];return n?!0:!1},t.releaseUID=function(e){var i=t.idlst[e.hashCode.toString()];void 0!=i&&(e.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),e.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedUIDToStage,this),t.uilst[Number(i)]=void 0,delete t.idlst[e.hashCode.toString()])},t.bindingUID=function(e,i){var n=t.uilst[i];n&&(n.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),n.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedUIDToStage,this),t.uilst[Number(i)]=void 0,delete t.idlst[n.hashCode.toString()]),t.uilst[i]=e,t.idlst[e.hashCode.toString()]=i,e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedUIDToStage,this)},t.changeUID=function(e,i){var n=t.uilst[i];n&&(delete t.idlst[n.hashCode.toString()],n.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),n.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedUIDToStage,this)),t.uilst[i]=e,t.idlst[e.hashCode.toString()]=i,e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedUIDToStage,this)},t.onTouch=function(e){var i=e.currentTarget;if(i){var n=Number(t.idlst[i.hashCode.toString()]);if(void 0==n||0/0===n)throw new Error("指引uid触发错误!");GuideMgr.dispatchUidEvent(n)}},t.forceTouch=function(e){var i=e;if(i){var n=Number(t.idlst[i.hashCode.toString()]);if(void 0==n||0/0===n)throw new Error("指引uid触发错误!");GuideMgr.dispatchUidEvent(n)}},t.onRemovedUIDToStage=function(e){e.currentTarget.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),e.currentTarget.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedUIDToStage,this);var i=e.currentTarget;i&&t.releaseUID(i)},t.uilst=new Array,t.idlst=new Object,t}();__reflect(UIDmgr.prototype,"UIDmgr");var Pointer=function(t){function e(){var e=t.call(this)||this;e.obj={};var i=ConfigMgr.gameConfig.globalConfig;return e.pointerURL=ParamMgr.gameSynRes+"/assets/model/other/10019.json?v="+i.otherVer,RES.getResByUrl(e.pointerURL,e.onJson,e,RES.ResourceItem.TYPE_JSON),e}return __extends(e,t),e.prototype.onJson=function(t,e){e==this.pointerURL&&(this.pointerJson=t,RES.getResByUrl(this.pointerURL.replace("json","png"),this.onPng,this,RES.ResourceItem.TYPE_IMAGE))},e.prototype.onPng=function(t,e){var i;i=new egret.MovieClipDataFactory(this.pointerJson,t),this.pointer=new egret.MovieClip(i.generateMovieClipData()),this.addChild(this.pointer),this.pointer.frameRate=6,this.pointer.play(-1),this.pointer&&this.obj.call&&this.pointerTo(this.obj.target,this.obj.parent,this.act)},e.prototype.pointerTo=function(t,e,i){if(this.act=i,!t.stage||!this.pointer)return this.obj.target=t,void(this.obj.parent=e);var n,r,s;if(e)n=UIDmgr.getUIByUID(e),r=t.x,s=t.y;else{n=t.stage;var a=t.parent.localToGlobal(t.x,t.y);r=a.x,s=a.y}n.addChild(this),this.bounds=t.getTransformedBounds(n,this.bounds),this.bounds.width*=t.scaleX,this.bounds.height*=t.scaleY,0==this.act.dir?(this.pointer.rotation=0,this.pointer.y=s+this.bounds.height,this.pointer.x=r+this.bounds.width/2):1==this.act.dir?(this.pointer.rotation=90,this.pointer.x=r,this.pointer.y=s+this.bounds.height/2):2==this.act.dir?(this.pointer.rotation=180,this.pointer.y=s,this.pointer.x=r+this.bounds.width/2):(this.pointer.rotation=270,this.pointer.y=s+this.bounds.height/2,this.pointer.x=r+this.bounds.width),this.pointer.isPlaying||this.pointer.play(-1)},e.prototype.hide=function(){this.pointer.stop(),this.parent&&this.parent.removeChild(this)},e}(egret.Sprite);__reflect(Pointer.prototype,"Pointer");var HttpMgr=function(){function t(){}return Object.defineProperty(t,"ins",{get:function(){return null==t._ins&&(t._ins=new t),t._ins},enumerable:!0,configurable:!0}),t.prototype.sendMessage=function(t,e,i,n){void 0===n&&(n=!1);var r=ProtoBufMgr.ins.getMessageClass(t),s={cmd:ProtoBufMgr.ins.getMessageId(t),body:r.encode(r.create(e)).finish()},a=ProtoBufMgr.ins.getMessageClass("BaseMessage"),o=a.encode(a.create(s)).finish();if(i==ServerPacket.LOGIC_URL)return void GameSocket.ins.sendSocket(new egret.ByteArray(o));var h;h=new egret.HttpRequest,h.responseType=egret.HttpResponseType.ARRAY_BUFFER,h.open((i==ServerPacket.LOGIN_URL?ParamMgr.serverUrl:ParamMgr.gameUrl)+i,egret.HttpMethod.POST),h.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),h.send(o),h.once(egret.Event.COMPLETE,this.onPostComplete,this),h.once(egret.IOErrorEvent.IO_ERROR,this.onPostIOError,this),h.once(egret.ProgressEvent.PROGRESS,this.onPostProgress,this)},t.prototype.onPostComplete=function(e){var i=e.currentTarget;t.serverMessage(new egret.ByteArray(i.response))},t.serverMessage=function(e){var i=new Uint8Array(t.getUint8Array(e)),n=ProtoBufMgr.ins.getMessageClass("BaseMessage");if(0==i.length)return void egret.log("收到空数据!");var r=n.decode(i),s=ProtoBufMgr.ins.getMessageName(r.cmd);if(!s)return void egret.log(r.cmd+"协议暂未注册!");var a=ProtoBufMgr.ins.getMessageClass(s),o=a.decode(r.body),h="C_"+r.cmd;if(10!=r.cmd)MessageMgr.messageHandler(ServerPacket[h],o);else{ErrorMgr.ins().showError(o.errorCode)}},t.prototype.onPostIOError=function(t){console.log("post error : "+t)},t.prototype.onPostProgress=function(t){console.log("post progress : "+Math.floor(100*t.bytesLoaded/t.bytesTotal)+"%")},t.getUint8Array=function(t){for(var e=[],i=0;i<t.dataView.byteLength;i++)e.push(t.dataView.getUint8(i));return e},t}();__reflect(HttpMgr.prototype,"HttpMgr");var ItemGetWayView=function(t){function e(){var e=t.call(this)||this;return e.skinName="ItemGetWaySkin",e.b0.name="0",e.b1.name="1",e.item.labName.visible=!1,e.item.labCount.visible=!1,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.param=[];var i,n=t[0],r=t[1],s=t[2];this.item.setIcon(r),this.item.isClick=!1,this.iname.text=s,this.g0.visible=this.g1.visible=!1;for(var a=0;2>a&&n[a];a++)i=n[a].split(","),this.param[a]=i,this["g"+a].visible=!0,this.addTouchEvent(this["b"+a],this.onTap),this["i"+a].source="gainItem"+i[0];this.addTouchEvent(this.rc,this.onTap)},e.prototype.onTap=function(t){if(t.target==this.rc);else{var e=this.param[parseInt(t.target.name)];ViewManager.ins().getView(UIView);switch(parseInt(e[0])){case ViewID.points:break;case ViewID.pveII:0==e.length?ViewManager.ins().open(PVEWin):ViewManager.ins().open(PVEWinII,FBMgr.ins.fbData[parseInt(e[1])]);break;default:0==e.length?ViewManager.ins().open(UIView,ViewManager.getView(parseInt(e[0]))):egret.log("未实现!")}}ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ItemGetWayView.prototype,"ItemGetWayView"),ViewManager.ins().reg(ItemGetWayView,LayerManager.UI_Tips);var ModelResMgr=function(){function t(){t._url_moviedatas=[];var e=ParamMgr.gameSynRes+"/assets/model/",i=ConfigMgr.gameConfig.globalConfig;this.humanModelGroup=new clips.ClipGroup(e+"human/",i.humanVer),this.monsterModelGroup=new clips.ClipGroup(e+"monster/",i.monsterVer),this.weaponModelGroup=new clips.ClipGroup(e+"weapon/",i.weaponVer),this.helmetModelGroup=new clips.ClipGroup(e+"helmet/",i.helmetVer),this.skillEffectGroup=new clips.ClipGroup(e+"skill/effect/",i.skillVer),this.otherEffectGroup=new clips.ClipGroup(e+"other/",i.otherVer),this.wingModelGroup=new clips.ClipGroup(e+"wing/",i.wing),t.ins=this}return t.getHelmetEffect=function(e,i,n){return t.ins.helmetModelGroup.getBmpClip(e,i,n)},t.getHumanModel=function(e,i,n){var r=t.ins.humanModelGroup.getBmpClip(e,i,n);return r.isComplete||(r.movieClipData=BaseActor.getDefaultBody()),r},t.getWeaponModel=function(e,i,n){var r=t.ins.weaponModelGroup.getBmpClip(e,i,n);return r.isComplete||(r.movieClipData=BaseActor.getDefaultBody()),r},t.getMonsterModel=function(e,i,n){var r=t.ins.monsterModelGroup.getBmpClip(e,i,n);return r.isComplete||(r.movieClipData=BaseActor.getDefaultBody()),r},t.getWingModel=function(e,i,n){var r=t.ins.wingModelGroup.getBmpClip(e,i,n);return r.isComplete||(r.movieClipData=BaseActor.getDefaultBody()),r},t.getSkillEffect=function(e,i,n){return t.ins.skillEffectGroup.getBmpClip(e,i,n)},t.getOtherEffect=function(e,i,n){return t.ins.otherEffectGroup.getBmpClip(e,i,n)},t}();__reflect(ModelResMgr.prototype,"ModelResMgr");var ObjectPool=function(){function t(){this._objs=new Array}return t.prototype.pushObj=function(t){this._objs.push(t)},t.prototype.popObj=function(){return this._objs.length>0?this._objs.pop():null},t.prototype.clear=function(){for(;this._objs.length>0;)this._objs.pop()},t.pop=function(e){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];t._content[e]||(t._content[e]=[]);var r=t._content[e];if(r.length){var s=r.pop();return s}var a=egret.getDefinitionByName(e),o=i.length,h=void 0;return 0==o?h=new a:1==o?h=new a(i[0]):2==o?h=new a(i[0],i[1]):3==o?h=new a(i[0],i[1],i[2]):4==o?h=new a(i[0],i[1],i[2],i[3]):5==o&&(h=new a(i[0],i[1],i[2],i[3],i[4])),h.ObjectPoolKey=e,h},t.popWithExtraKey=function(e,i){t._content[e]||(t._content[e]=[]);var n,r=t._content[e];if(r.length)for(var s=0;s<r.length;s++)if(r[s].extraKey==i){n=r[s],r.splice(s,1);break}if(!n){var a=egret.getDefinitionByName(e);n=new a(i),n.extraKey=i,n.ObjectPoolKey=e}return n},t.push=function(e){if(null==e)return!1;var i=e.ObjectPoolKey;return!t._content[i]||t._content[i].indexOf(e)>-1?!1:(t._content[i].push(e),!0)},t.clear=function(){t._content={}},t.clearClass=function(e,i){void 0===i&&(i=null);var n=t._content[e];if(null!=n){for(;n&&n.length;){var r=n.pop();i&&r[i](),r=null}t._content[e]=null,delete t._content[e]}},t.dealFunc=function(e,i){var n=t._content[e];if(null!=n){var r=0,s=n.length;for(r;s>r;r++)n[r][i]()}},t._content={},t}();__reflect(ObjectPool.prototype,"ObjectPool");var ParamMgr=function(){function t(){}return Object.defineProperty(t,"gameSynRes",{get:function(){return"resource"},enumerable:!0,configurable:!0}),t.initParam=function(){var t=window.gameParam;if(t)for(var e in t)this[e]=t[e]},t.synRes="resource",t.ressite="",t.serverUrl="http://106.12.117.205:8080/",t.gameUrl="",t.SPID=0,t.rechargeURL="",t}();__reflect(ParamMgr.prototype,"ParamMgr");var ProtoBufMgr=function(){function t(){this.messageIdDic={},this.messageNameDic={};var t;for(var e in ClientPacket)t=parseInt(e.toString().split("_")[1]),this.messageIdDic[t]=ClientPacket[e],this.messageNameDic[ClientPacket[e]]=t;for(var e in ServerPacket)t=parseInt(e.toString().split("_")[1]),this.messageIdDic[t]=ServerPacket[e],this.messageNameDic[ServerPacket[e]]=t}return Object.defineProperty(t,"ins",{get:function(){return null==t._ins&&(t._ins=new t),t._ins},enumerable:!0,configurable:!0}),t.prototype.getMessageName=function(t){return this.messageIdDic[t]},t.prototype.getMessageId=function(t){return this.messageNameDic[t]},t.prototype.loadProtoBuf=function(){var e=t.filenames,i=t.total=e.length;this.messageArr=[];for(var n=0;i>n;n++)protobuf.load(ParamMgr.ressite+ParamMgr.gameSynRes+"/pb/"+e[n]+".proto?v="+ConfigMgr.gameConfig.globalConfig.protoVer,this.loadComplete)},t.prototype.loadComplete=function(e,i){var n=t.ins.getMessageMb(i);t.ins.messageArr.push(n),t.ins.messageArr.length==t.total&&(egret.log("proto加载完毕！"),DataEventDispatcher.dispatchEventWith(t.LOAD_PROTO_END))},t.prototype.getMessageMb=function(t){var e=t.nested;for(var i in e)return"Namespace"!=egret.getQualifiedClassName(e[i])&&"i"!=egret.getQualifiedClassName(e[i])?e:this.getMessageMb(e[i])},t.prototype.getMessageClass=function(t){for(var e=0;e<this.messageArr.length;e++){var i=this.messageArr[e][""+t];if(void 0!=i)return i}return null},t.LOAD_PROTO_END="LOAD_PROTO_END",t.filenames=["basePack","pb_user","pb_player"],t}();__reflect(ProtoBufMgr.prototype,"ProtoBufMgr");var PVPMgr=function(t){function e(){var e=t.call(this)||this;DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20023,e.fightBack,e),DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20021,e.buyBack,e);var i=ConfigMgr.gameConfig.commonTimes;e.data=[];for(var n in i)e.data[i[n].type]||(e.data[i[n].type]=[]),e.data[i[n].type].push(i[n]);return e}return __extends(e,t),e.ins=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return t.ins.call(this,e)},e.prototype.fightBack=function(t){UserVo.ins.upUserVo({challengeNum:UserVo.ins.challengeNum-1}),GameLogic.ins.changeMap(UserVo.ins.points)},e.prototype.buyBack=function(t){t.data.isSuccess?(UserTips.ins().showTipsBigToSmall("次数购买成功!",!1),UserVo.ins.upUserVo({challengeNum:1,challengeCount:UserVo.ins.challengeCount+1})):UserTips.ins().showTipsBigToSmall("次数购买失败!")},e.prototype.pVPFightEnd=function(t){HttpMgr.ins.sendMessage(ClientPacket.S_10023,{isVictory:t},ServerPacket.LOGIC_URL,!0)},Object.defineProperty(e.prototype,"canRefresh",{get:function(){var t;return t=UserVo.ins.refreshPurchaseCount>=this.data[2].length-2?parseInt(this.data[2][this.data[2].length-1].consume):parseInt(this.data[2][UserVo.ins.refreshPurchaseCount+1].consume),[t+MoneyUtils.getMoneyName(MoneyUtils.M_3),MoneyUtils.getMoneyNum(MoneyUtils.M_3)>=t]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buyCount",{get:function(){var t;return t=UserVo.ins.challengeCount>=this.data[2].length-2?parseInt(this.data[2][this.data[2].length-1].consume):parseInt(this.data[2][UserVo.ins.challengeCount+1].consume),[t+MoneyUtils.getMoneyName(MoneyUtils.M_3),MoneyUtils.getMoneyNum(MoneyUtils.M_3)>=t]},enumerable:!0,configurable:!0}),e}(BaseClass);__reflect(PVPMgr.prototype,"PVPMgr");var RemindMgr=function(t){function e(){for(var e,i=t.call(this)||this,n=[TaskWin,AchievementWin,SkillWin,ArtifactWin,ForgeWin,ForgeWin,GemWin,EmailView,BagWin,ActivityWin,FirstCharge,MonthCard,LimitCard],r=[i.upTask,i.upAchievement,i.upSkillLvl,i.checkArtifact,i.checkEquipStreng,i.checkEquipLvl,i.checkGem,i.checkEmail,i.checkBag,i.upActivety,i.upActivety,i.upActivety,i.upActivety],s=0;s<n.length;s++)SystemOpenMgr.checkOpen(n[s])||(e=SystemOpenMgr.getOpenCondition(n[s]),e.playerLvl>0&&DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.rebirthNum,r[s],i),e.vipLvl>0&&DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.vipLevel,r[s],i),e["层数"]>0&&DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.points,r[s],i)),2==s?(DataEventDispatcher.dispatcher.addEventListener(GameEvent.SKILL_UP_LVL,r[s],i),DataEventDispatcher.dispatcher.addEventListener(GameEvent.STUDY_SKILL,r[s],i),DataEventDispatcher.dispatcher.addEventListener(GameEvent.MONEY_TYPE_CHANGE,r[s],i),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.level,r[s],i),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.rebirthNum,r[s],i)):3==s?(DataEventDispatcher.dispatcher.addEventListener(GameEvent.UPDATE_BAG_DATA,r[s],i),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UPDATE_ARTIFACT_WIN,r[s],i),DataEventDispatcher.dispatcher.addEventListener(GameEvent.MONEY_TYPE_CHANGE,r[s],i)):4==s?(DataEventDispatcher.dispatcher.addEventListener(GameEvent.MONEY_TYPE_CHANGE,r[s],i),DataEventDispatcher.dispatcher.addEventListener(GameEvent.WEAR_EQUIPS,r[s],i),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UPDATE_PLAYER_WIN,r[s],i),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_STRENGTH,r[s],i)):5==s?(DataEventDispatcher.dispatcher.addEventListener(GameEvent.MONEY_TYPE_CHANGE,r[s],i),DataEventDispatcher.dispatcher.addEventListener(GameEvent.WEAR_EQUIPS,r[s],i),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UPDATE_PLAYER_WIN,r[s],i),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_ADVANCE,r[s],i)):6==s?(DataEventDispatcher.dispatcher.addEventListener(GameEvent.UPDATE_PLAYER_WIN,i.checkGem,i),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UPDATE_GEM_DATA,i.checkGem,i),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UPDATE_BAG_DATA,i.checkGem,i)):7==s?(DataEventDispatcher.dispatcher.addEventListener(GameEvent.ADD_EMAIL,i.checkEmail,i),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_EMAIL_STATUS,i.checkEmail,i),DataEventDispatcher.dispatcher.addEventListener(GameEvent.REMOVE_EMAIL,i.checkEmail,i)):8==s?DataEventDispatcher.dispatcher.addEventListener(GameEvent.UPDATE_BAG_DATA,r[s],i):13>s&&(DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20032,i.upActivety,i),DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_30006,i.upActivety,i)),r[s].apply(i);return DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.rebirthNum,i.checkArtifact,i),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.vipLevel,i.checkArtifact,i),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.points,i.checkArtifact,i),i}return __extends(e,t),e.prototype.upActivety=function(t){if(void 0===t&&(t=null),t)if(t.type==ServerPacket.C_20032){if(t.data.isSuccess){var i=e.activetyAwards[t.data.activityId],n=i.indexOf(t.data.activityIndex);-1!=n?i.splice(n,1):egret.log("活动错误!")}}else e.activetyAwards[t.data.activityId].push(t.data.activityIndex);else{ActivetyMgr.ins();for(var r=1e3;r<ActivetyMgr.MAX_ACTIVE;r++)e.activetyAwards[r+""]=[];var s=UserVo.ins.activityInfos;for(r=0;r<s.length;r++)for(var a=s[r].completedActivityInfos,o=0;o<a.length;o++)a[o].isReward||e.activetyAwards[s[r].activityId+""].push(a[o].activityIndex)}e.activetyRED=!1;for(var h in e.activetyAwards)if(h!=ActivetyMgr.FIRST_CHARGE+""&&h!=ActivetyMgr.MONTH_CARD+""&&h!=ActivetyMgr.LIMIT_CARD+""&&e.activetyAwards[h].length>0){e.activetyRED=!0;break}DataEventDispatcher.dispatchEventWith(GameEvent.RED_ACTIVETY)},e.prototype.checkBag=function(){var t=BagVo.ins().getTypeItemList(BagVo.ITEM_TYPE_OTHER),i=0!=t.length;i!=e.hasOtherItem&&DataEventDispatcher.dispatchEventWith(GameEvent.RED_BAG_RED)},e.prototype.checkEmail=function(){var t=SystemOpenMgr.checkOpen(EmailView);if(t){for(var i=(e.HAVE_READ_EMAIL,!1),n=UserVo.ins.emailInfos,r=0;r<n.length;r++)if(0==n[r].readState||0==n[r].itemState&&n[r].itemList&&n[r].itemList.length>0){i=!0;break}e.HAVE_READ_EMAIL!=i&&(e.HAVE_READ_EMAIL=i,DataEventDispatcher.dispatchEventWith(GameEvent.RED_EMAIL))}},e.prototype.checkGem=function(){var t=SystemOpenMgr.checkOpen(GemWin);if(t){var i,n=BagVo.ins().getBagGemList();e.GEM_CAN_UP.length=0,e.GEM=!1;for(var r=0;4>r;r++){e.GEM_CAN_UP[r]=[],i=UserVo.ins.Columns[r].gemGrooves.gemGrooves;for(var s=0;s<i.length;s++)if(i[s].isOpen&&i[s].gemId>0){var a=GemVo.ins().getGemAttr(i[s].gemId);if(0==a.nextId)continue;var o=a.AttrType;for(var h in n){var l=n[h],p=GemVo.ins().getGemAttr(l.itemId).AttrType;if(o==p&&l.itemNum>=a.compose-1){e.GEM_CAN_UP[r][a.loc]=a,e.GEM=!0;break}}}}DataEventDispatcher.dispatchEventWith(GameEvent.RED_GEM_LVL)}},e.prototype.checkEquipLvl=function(){if(UserVo.ins.Columns){var t=SystemOpenMgr.checkOpen(ForgeWin);if(t){e.upEquipsLvl=[];for(var i,n=UserVo.ins.reinforcedEquipmentStone,r=0;r<UserVo.ins.Columns.length;r++){var s=UserVo.ins.Columns[r].itemInfo;s&&(i=ForgeVo.ins().getEquipID(s.itemId),n>=i.reinforcedEquipmentStone&&0!=i.reinforcedEquipmentStone&&(e.upEquipsLvl[r]=s))}DataEventDispatcher.dispatchEventWith(GameEvent.RED_EQUIP_LVL)}}},e.prototype.checkEquipStreng=function(){if(UserVo.ins.Columns){var t=SystemOpenMgr.checkOpen(ForgeWin);if(t){e.StrengEquips=[];for(var i=MoneyUtils.getMoneyNum(MoneyUtils.M_2),n=0;n<UserVo.ins.Columns.length;n++){var r=UserVo.ins.Columns[n].itemInfo;r&&i>=ForgeVo.ins().getUpEquipGold(r.level)&&(e.StrengEquips[n]=r)}DataEventDispatcher.dispatchEventWith(GameEvent.RED_STRENG)}}},e.prototype.checkArtifact=function(){var t=SystemOpenMgr.checkOpen(ArtifactWin);if(t){if(!this.artifaceLists){this.artifaceLists=[];for(var i=1;100>i;i++){var n=40001+100*i,r=ConfigMgr.gameConfig.artifact[n];if(!r)break;this.artifaceLists.push(r),e.artifactTips[i-1]=0}}for(var s,a=!0,o=UserVo.ins.artifactInfos,h=!1,l=MoneyUtils.getMoneyNum(MoneyUtils.M_6),p=0;p<this.artifaceLists.length;p++){h=!1;for(var c=0;c<o.length;c++)s=ConfigMgr.gameConfig.artifact[o[c]],this.artifaceLists[p].artifactType==s.artifactType&&(h=!0,l>=s.strengthenArtifactStone&&0!=s.strengthenArtifactStone?e.artifactTips[p]=2:e.artifactTips[p]=0);if(!h){a=!1;var u=!1;switch(this.artifaceLists[p].access){case 1:u=UserVo.ins.MAX_POINTS>=this.artifaceLists[p].btainConditions;break;case 2:u=UserVo.ins.rebirthNum>=this.artifaceLists[p].btainConditions;break;case 3:u=UserVo.ins.vipLevel>=this.artifaceLists[p].btainConditions;break;case 4:u=BagVo.ins().getIdItem(this.artifaceLists[p].itemId)?!0:!1;
break;case 5:u=BagVo.ins().getIdItem(this.artifaceLists[p].itemId)?!0:!1}e.artifactTips[p]=u?1:0}}a&&(DataEventDispatcher.dispatcher.removeEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.rebirthNum,this.checkArtifact,this),DataEventDispatcher.dispatcher.removeEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.vipLevel,this.checkArtifact,this),DataEventDispatcher.dispatcher.removeEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.points,this.checkArtifact,this)),DataEventDispatcher.dispatchEventWith(GameEvent.RED_ARTIFACE)}},e.prototype.upSkillLvl=function(){var t,i,n=SkillMgr.ins.skillGroup[UserVo.ins.jobId],r=0,s=MoneyUtils.getMoneyNum(MoneyUtils.M_5);e.CAN_UP_SKILL=[];for(var a in n){t=n[a];for(var r=0;r<t.length;r++)i=SkillMgr.ins.getRoleSkill(t[r].secondarySkill_id),i&&i.level>0&&s>=i.stdSkill.upgrade_money&&UserVo.ins.levelLimit(i.stdSkill.need_role_lzs,i.stdSkill.need_role_lvl)&&e.CAN_UP_SKILL.push(i)}DataEventDispatcher.dispatchEventWith(GameEvent.RED_SKILL)},e.ins=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return t.ins.call(this,e)},e.prototype.upTask=function(){this.checkTask(0)},e.prototype.upAchievement=function(){this.checkTask(3)},e.prototype.clearCall=function(t){DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.rebirthNum,t,this),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.vipLevel,t,this),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.rebirthNum,t,this)},e.prototype.checkTask=function(t){void 0===t&&(t=0);var e=SystemOpenMgr.checkOpen(TaskWin),i=SystemOpenMgr.checkOpen(AchievementWin);if(t&&1!=t||!e||(this.clearCall(this.upTask),this.taskChange(1),DataEventDispatcher.dispatchEventWith(GameEvent.RED_MAIN_TASK)),t&&2!=t||!e||(this.taskChange(2),DataEventDispatcher.dispatchEventWith(GameEvent.RED_ACHEIEVEMENT)),!t||3==t){if(!i)return;this.clearCall(this.upAchievement),this.taskChange(3),DataEventDispatcher.dispatchEventWith(GameEvent.RED_ACHEIEVEMENT)}},e.prototype.taskChange=function(t){for(var i=[],n=TaskMgr.ins().typeTask[t],r=UserVo.ins.getTaskInfo(t),s=0;s<n.length;s++){n[s].completeNum=0,n[s].isReceive=1;for(var a=0;a<r.length;a++)if(n[s].taskId==r[a].taskId){n[s].completeNum=r[a].completeNum,n[s].isReceive=r[a].isReceive?0:r[a].completeNum>=n[s].taskTime&&(0==n[s].lastTaskId||AchievementWin.isReceive(n[s].lastTaskId,t))?2:1;break}i[n[s].taskWin]?n[s].isReceive>i[n[s].taskWin].isReceive&&(i[n[s].taskWin]=n[s]):i[n[s].taskWin]=n[s]}for(a=i.length-1;a>=0;a--)i[a]||i.splice(a,1);i.sort(this.sortTask),e.taskArr[t]=i,e.taskGetSatus[t]=2==e.taskArr[t][0].isReceive},e.prototype.sortTask=function(t,e){return t.isReceive<e.isReceive?1:-1},e.activetyAwards={},e.activetyRED=!1,e.hasOtherItem=!1,e.HAVE_READ_EMAIL=!1,e.GEM_CAN_UP=[],e.GEM=!1,e.upEquipsLvl=[],e.StrengEquips=[],e.artifactTips=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e.CAN_UP_SKILL=[],e.taskArr=[[],[],[],[]],e.taskGetSatus=[!1,!1,!1,!1],e}(BaseClass);__reflect(RemindMgr.prototype,"RemindMgr");var ResMgr=function(){function t(){}return t.getGameOtherPng=function(t){var e=ParamMgr.ressite+ParamMgr.gameSynRes;return e+"/assets/otherPng/"+t+".png?v="+ParamMgr.ver},t.getGameOtherJpg=function(t){var e=ParamMgr.ressite+ParamMgr.gameSynRes;return e+"/assets/otherPng/"+t+".jpg?v="+ParamMgr.ver},t.getGameItemPng=function(t){var e=ParamMgr.ressite+ParamMgr.gameSynRes;return e+"/assets/item/"+t+".png?v="+ParamMgr.ver},t.getMapImage=function(t){var e=ParamMgr.ressite+ParamMgr.gameSynRes;return e+"/assets/newMap/"+t+"?v="+ConfigMgr.gameConfig.globalConfig.mapVer},t.skillIcon=function(t){var e=ParamMgr.ressite+ParamMgr.gameSynRes;return e+"/assets/model/skill/"+t+".png?v="+ParamMgr.ver},t.gameSound=function(t){var e=ParamMgr.ressite+ParamMgr.gameSynRes;return e+"/assets/sound/"+t+".mp3?v="+ParamMgr.ver},t}();__reflect(ResMgr.prototype,"ResMgr");var SkillMgr=function(){function t(){this.skillConfig=ConfigMgr.gameConfig.skill,this.jobSkill=[];var e;this.skillGroup=[],t.COMMON_SKILL=[];for(var i in this.skillConfig)e=this.skillConfig[i],e.skill_id!=t.COMMON_SKILL_ID?(this.jobSkill[e.careerType]||(this.jobSkill[e.careerType]=[]),1==e.level&&this.jobSkill[e.careerType].push(e),this.skillGroup[e.careerType]||(this.skillGroup[e.careerType]={}),this.skillGroup[e.careerType][""+e.skill_id]||(this.skillGroup[e.careerType][""+e.skill_id]=[]),1==e.level&&this.skillGroup[e.careerType][""+e.skill_id].push(e)):t.COMMON_SKILL[e.careerType]=new SkillVo(e.secondarySkill_id,1);this.groupSkillId=[];var n=this.skillGroup[UserVo.ins.jobId];for(var i in n)this.groupSkillId.push(n[i][0].secondarySkill_id);DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.level,this.checkSkill,this)}return Object.defineProperty(t,"ins",{get:function(){return null==t._ins&&(t._ins=new t),t._ins},enumerable:!0,configurable:!0}),t.prototype.check12=function(t){if(!t)return!1;var e=this.skillGroup[UserVo.ins.jobId];for(var i in e)if(t.stdSkill.secondarySkill_id==e[i][1].secondarySkill_id)return!0;return!1},t.prototype.skillChange=function(t,e){var i=Human.ins.useingSkill[t];if(Human.ins.useingSkill[t]=e,i&&i.buffHandle.length>0)for(;i&&i.buffHandle.length;)Human.ins.removeBuff(0,i.buffHandle.pop());this.addBuff(e,Human.ins)},t.skillConfigByID=function(e,i){if(void 0===i&&(i=1),0>=i)return null;var n=ConfigMgr.gameConfig.skill[t.autoFillTab(e,i)];if(!n)throw new Error("找不到指定的技能等级数据:"+e+"-"+i);return n},t.prototype.createSkill=function(e,i,n,r){var s=[];if(i)for(h=0;h<i.length;h++)s[this.skillConfig[i[h]].secondarySkill_id]=this.skillConfig[i[h]].level;var a,o,h;for(h=0;h<this.jobSkill[e].length;h++)o=this.jobSkill[e][h].secondarySkill_id,a=new SkillVo(o,s[o]?s[o]:0),a.level>0&&-1!=n.indexOf(t.autoFillTab(o,a.level))&&(this.addBuff(a,r),r&&(r.useingSkill[h]=a)),r&&r.skills.push(a);this.checkSkill(null,r.skills,!1,r,n)},t.prototype.addBuff=function(t,e){var i;if(t.initiativeSkill&&e){var n;if(t.skillHit)for(var r=0;r<t.skillHit.length;r++)i=t.skillHit[r].split(":"),n=BuffVo.create(parseInt(i[1]),parseInt(i[2])),n.hurtType="0"==i[3]?0:parseInt(i[3]),e.addBuff(n),t.buffHandle.push(n.handle);if(t.unMissileEffects.length>0&&n){n.effs=[];for(var s=0;s<t.unMissileEffects.length;s++)n.effs.push(e.playEffect(t.unMissileEffects[s].effect,-1))}}},t.prototype.checkSkill=function(e,i,n,r,s){void 0===e&&(e=null),void 0===i&&(i=null),void 0===n&&(n=!0),void 0===r&&(r=null),void 0===s&&(s=null),i=i?i:Human.ins.skills;for(var a=r?r:Human.ins,o=0;o<i.length;o++)if(0==i[o].level&&UserVo.ins.levelLimit(i[o].stdSkill.need_role_lzs,i[o].stdSkill.need_role_lvl)){if(i[o].level=1,s&&-1!=s.indexOf(i[o].stdSkill.tab)){var h=s.indexOf(i[o].stdSkill.tab);this.addBuff(i[o],a),a.useingSkill[h]=i[o]}a==Human.ins&&(n&&t.NEW_STUDY.push(i[o]),DataEventDispatcher.dispatchEventWith(GameEvent.STUDY_SKILL))}},t.prototype.getRoleSkill=function(t){for(var e=Human.ins.skills,i=e.length,n=0;i>n;n++)if(e[n].stdSkill.secondarySkill_id==t)return e[n]},t.prototype.getRoleSkillByGroup=function(t){for(var e=[],i=Human.ins.skills,n=i.length,r=0;n>r;r++)i[r].stdSkill.skill_id==t&&e.push(i[r]);return e},t.autoFillTab=function(t,e){return t+(e>9?e+"":"0"+e)},t.prototype.upSkillLvl=function(t){if(t.isSuccess){var e=this.getRoleSkill(this.skillConfig[t.nextSkillTab].secondarySkill_id);e?e.level+=1:egret.log("技能升级错误!")}},t.prototype.isMaxSkill=function(t){var e=this.jobSkill[UserVo.ins.jobId];return t.stdSkill.skill_id==e[e.length-1].skill_id},t.COMMON_SKILL_ID=112233,t.NEW_STUDY=[],t}();__reflect(SkillMgr.prototype,"SkillMgr");var SystemOpenMgr=function(){function t(){}return t.checkOpen=function(e,i,n){void 0===i&&(i=!1);var r;if(r=e?t.VIEW_Arr.indexOf(e):n,-1==r)return!0;var s=ConfigMgr.gameConfig.unlockFunction[r+""];return s&&(s.playerLvl>UserVo.ins.rebirthNum||s.vipLvl>UserVo.ins.vipLevel||s["层数"]>UserVo.ins.MAX_POINTS)?(i&&UserTips.ins().showTipsBigToSmall(s.lockDesc),!1):!0},t.getOpenCondition=function(e){var i=t.VIEW_Arr.indexOf(e);return ConfigMgr.gameConfig.unlockFunction[i+""]},t.VIEW_Arr=[null,PVEWin,PVEWin,PVEWin,EmailView,TaskWin,null,ShopWin,PVPWin,ReborthWin,AchievementWin,ArtifactWin,GemWin],t}();__reflect(SystemOpenMgr.prototype,"SystemOpenMgr");var TaskMgr=function(t){function e(){var e=t.call(this)||this;e.typeTask=[];var i=ConfigMgr.gameConfig.task;for(var n in i)e.typeTask[i[n].taskType]||(e.typeTask[i[n].taskType]=[]),e.typeTask[i[n].taskType].push(i[n]);return e}return __extends(e,t),e.ins=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return t.ins.call(this,e)},e.prototype.upTask=function(t){for(var e,i,n=ConfigMgr.gameConfig.task,r=!1,s=0;s<t.length;s++){var a=n[t[s].taskId].taskType;e=UserVo.ins.getTaskInfo(a);for(var o=0;o<e.length;o++)e[o].taskId==t[s].taskId&&(r=!0,e[o].completeNum=t[s].completeNum);r||(i={},i.taskId=t[s].taskId,i.isReceive=!1,i.completeNum=t[s].completeNum,e.push(i))}RemindMgr.ins().checkTask(0)},e.prototype.finishTask=function(t){if(0==t.code){for(var e=ConfigMgr.gameConfig.task,i=e[t.taskId].taskType,n=UserVo.ins.getTaskInfo(i),r=0;r<n.length;r++)if(n[r].taskId==t.taskId){n[r].isReceive=!0;break}RemindMgr.ins().checkTask(0)}},e}(BaseClass);__reflect(TaskMgr.prototype,"TaskMgr");var TimerManager=function(t){function e(){var e=t.call(this)||this;return e._haveremove=!1,e._handlers=new Array,e._currTime=egret.getTimer(),e._currFrame=0,e._timeScale=1,egret.startTick(e.onEnterFrame,e),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getFrameId=function(){return this._currFrame},e.prototype.setTimeScale=function(t){this._timeScale=t},e.prototype.onEnterFrame=function(t){this._currFrame++,this._currTime=egret.getTimer();for(var e=0,i=this._handlers;e<i.length;e++){var n=i[e];if(n.remove)this._haveremove=!0;else{var r=n.userFrame?this._currFrame:this._currTime;r>=n.exeTime&&(n.method.call(n.methodObj,(this._currTime-n.dealTime)*this._timeScale),n.dealTime=this._currTime,n.exeTime+=n.delay,n.repeat||(n.repeatCount>1?n.repeatCount--:(n.complateMethod&&n.complateMethod.apply(n.complateMethodObj),n.remove=!0,this._haveremove=!0)))}}if(this._haveremove)for(var s=this._handlers.length-1;s>=0;--s){var n=this._handlers[s];n.remove&&(n.clear(),this._handlers.splice(s,1),ObjectPool.push(n))}return this._haveremove=!1,!1},e.prototype.create=function(t,e,i,n,r,s,a){if(!(0>e||0>i||null==n)){this.remove(n,r);var o=ObjectPool.pop("TimerHandler");o.userFrame=t,o.repeat=0==i,o.repeatCount=i,o.delay=e,o.method=n,o.methodObj=r,o.complateMethod=s,o.complateMethodObj=a,o.exeTime=e+(t?this._currFrame:this._currTime),o.dealTime=this._currTime,o.remove=!1,this._handlers.push(o)}},e.prototype.doTimer=function(t,e,i,n,r,s){void 0===r&&(r=null),void 0===s&&(s=null),this.create(!1,t,e,i,n,r,s)},e.prototype.doFrame=function(t,e,i,n,r,s){void 0===r&&(r=null),void 0===s&&(s=null),this.create(!0,t,e,i,n,r,s)},e.prototype.doNext=function(t,e){this.create(!0,1,1,t,e,null,null)},e.prototype.remove=function(t,e){for(var i=0,n=this._handlers;i<n.length;i++){var r=n[i];r.remove||r.method!=t||r.methodObj!=e||(r.remove=!0,this._haveremove=!0)}},e.prototype.removeAll=function(t){for(var e=0,i=this._handlers;e<i.length;e++){var n=i[e];n.methodObj==t&&(n.remove=!0,this._haveremove=!0)}},e.prototype.isExists=function(t,e){for(var i=0,n=this._handlers;i<n.length;i++){var r=n[i];if(!r.remove&&r.method==t&&r.methodObj==e)return!0}return!1},e}(BaseClass);__reflect(TimerManager.prototype,"TimerManager");var TimerHandler=function(){function t(){this.delay=0,this.repeatCount=0,this.exeTime=0,this.dealTime=0,this.remove=!1}return t.prototype.clear=function(){this.method=null,this.methodObj=null,this.complateMethod=null,this.complateMethodObj=null,this.remove=!1},t}();__reflect(TimerHandler.prototype,"TimerHandler");var TMXMgr=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return t.ins.call(this,e)},e.prototype.loadTmx=function(){this.myload=new egret.URLLoader,this.myload.dataFormat=egret.URLLoaderDataFormat.BINARY,this.myload.addEventListener(egret.Event.COMPLETE,this.loadZipCom,this),this.myload.addEventListener(egret.ProgressEvent.PROGRESS,LoadingUI.ins.onProgress,this),this.myload.addEventListener(egret.IOErrorEvent.IO_ERROR,this.loadZipErr,this);var t=ResMgr.getMapImage("xy/xy"),e=new egret.URLRequest(t);this.myload.load(e)},e.prototype.loadZipCom=function(t){var i=new JSZip(t.target.data);this.mapDic={};for(var n in i.files)this.mapDic[n]=new egret.ByteArray(i.file(n).asArrayBuffer());DataEventDispatcher.dispatchEventWith(e.LOAD_TMX_END)},e.prototype.loadZipErr=function(t){egret.log("地图加载错误！")},e.LOAD_TMX_END="LOAD_TMX_END",e}(BaseClass);__reflect(TMXMgr.prototype,"TMXMgr");var BaseItem=function(t){function e(){var e=t.call(this)||this;return e.isClick=!0,e.skinName="BaseItemSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.addTouchEvent(this,this.onTap)},e.prototype.dataChanged=function(){if(this.clears(),this.data){if(this.data.moneyType)return this.setIcon(this.data.moneyType),this.setName(MoneyUtils.getMoneyName(this.data.moneyType)),this.setCount(this.data.itemNum),void this.itemIcon.setQuality(-1);this.parent.parent.parent.parent;var t=this.data.itemId;this.itemConfing=BagVo.ins().getItem(t),this.setIcon(this.itemConfing.iconID),this.labName.text=this.itemConfing.name,this.labName.textColor=ColorUtlis.QUALITY_COLOR[this.itemConfing.rank],this.setCount(this.data.itemNum),this.validateNow(),this.setQuality(this.itemConfing.rank)}},e.prototype.setIcon=function(t){this.itemIcon.setIcon(""==t?null:ResMgr.getGameItemPng(t))},e.prototype.setName=function(t){this.labName.text=t},e.prototype.setCount=function(t){if(this.itemConfing&&this.itemConfing.itemType==BagVo.ITEM_TYPE_EQUIP){this.data.showEquipsCount?this.labCount.text=(t>0?t:"")+"":this.labCount.text=(this.data.level>0?"+"+this.data.level:"")+"";var e=ForgeVo.ins().getEquipID(this.data.itemId);this.jie.text=e.itemQuality+"阶"}else this.labCount.text=(t>0?t:"")+"",this.jie.text=""},e.prototype.setQuality=function(t){this.itemIcon.setQuality(t)},e.prototype.onTap=function(){this.isClick&&this.onRescript()},e.prototype.onRescript=function(){if(this.data&&this.itemConfing){if(2==this.itemConfing.itemType);else if(1==this.itemConfing.itemType&&ViewManager.ins().isShow(GemWin)){var t=GemVo.ins().isEquipGem(this.itemConfing.itemId);return-1!=t?UserTips.ins().showTipsBigToSmall("已镶嵌同类型了的宝石!"):void GemVo.ins().sendGemMountRequest(this.data.uuid)}ViewManager.ins().open(ItemTipView,this.data)}},e.prototype.clears=function(){this.labName.textColor=16777215,this.itemIcon.setIcon(""),this.labName.text="",this.labCount.text="",this.imgBg.source="",this.setQuality(-1),this.jie.text=""},e}(BaseItemRender);__reflect(BaseItem.prototype,"BaseItem");var SoundBg=function(t){function e(){var e=t.call(this)||this;return e._currBg="",e}return __extends(e,t),e.prototype.stop=function(){this._currSoundChannel&&this._currSoundChannel.stop(),this._currSoundChannel=null,this._currSound=null,this._currBg=""},e.prototype.play=function(t){if(this._currBg!=t){this.stop(),this._currBg=t;var e=this.getSound(t);e&&this.playSound(e)}},e.prototype.playSound=function(t){this._currSound=t,this._currSoundChannel=this._currSound.play(0,0),this._currSoundChannel.volume=this._volume},e.prototype.setVolume=function(t){this._volume=t,this._currSoundChannel&&(this._currSoundChannel.volume=this._volume)},e.prototype.loadedPlay=function(t){this._currBg==t&&this.playSound(RES.getRes(t))},e.prototype.checkCanClear=function(t){return this._currBg!=t},e}(BaseSound);__reflect(SoundBg.prototype,"SoundBg");var SoundEffects=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.play=function(t){var e=this.getSound(t);e&&this.playSound(e)},e.prototype.playSound=function(t){var e=t.play(0,1);e.volume=this._volume},e.prototype.setVolume=function(t){this._volume=t},e.prototype.loadedPlay=function(t){this.playSound(RES.getRes(t))},e}(BaseSound);__reflect(SoundEffects.prototype,"SoundEffects");var SoundManager=function(t){function e(){var e=t.call(this)||this;return e.bgOn=!0,e.effectOn=!0,e.bgVolume=.5,e.effectVolume=.5,e.bg=new SoundBg,e.bg.setVolume(e.bgVolume),e.effect=new SoundEffects,e.effect.setVolume(e.effectVolume),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.playEffect=function(t){this.effectOn&&this.effect.play(t)},e.prototype.playBg=function(t){this.currBg=t,this.bgOn&&this.bg.play(t)},e.prototype.stopBg=function(){this.bg.stop()},e.prototype.setEffectOn=function(t){this.effectOn=t},e.prototype.setBgOn=function(t){this.bgOn=t,this.bgOn?this.currBg&&this.playBg(this.currBg):this.stopBg()},e.prototype.setBgVolume=function(t){t=Math.min(t,1),t=Math.max(t,0),this.bgVolume=t,this.bg.setVolume(this.bgVolume)},e.prototype.getBgVolume=function(){return this.bgVolume},e.prototype.setEffectVolume=function(t){t=Math.min(t,1),t=Math.max(t,0),this.effectVolume=t,this.effect.setVolume(this.effectVolume)},e.prototype.getEffectVolume=function(){return this.effectVolume},e.CLEAR_TIME=18e4,e}(BaseClass);__reflect(SoundManager.prototype,"SoundManager");var AttributeUtlis=function(){function t(){}return t.attributeMgr=function(e,i,n,r){void 0===i&&(i=!0),n=n?n:UserVo.ins.playerAttrInfo,r=r?r:UserVo.ins.jobId;var s,a;for(var o in e)if(a=-1,void 0!=n[o]){if(s=t.BaseAttribute.indexOf(o),-1==s&&(s=t.BaseAttributeII.indexOf(o),a=s),i?n[o]+=e[o]:n[o]-=e[o],-1!=s)for(var h=ConfigMgr.gameConfig.propertyConversion,l=0;l<t.DeriveAttribute.length;l++)i?n[t.DeriveAttribute[l]]+=e[o]*h[4*(r-1)+s][t.DeriveAttribute[l]]:n[t.DeriveAttribute[l]]-=e[o]*h[4*(r-1)+s][t.DeriveAttribute[l]];a>=0&&(i?n[t.BaseAttribute[a]]+=e[o]:n[t.BaseAttribute[a]]-=e[o])}n==UserVo.ins.playerAttrInfo&&Human.ins&&Human.ins.upSpeed()},t.BuffAttributeByTarge=function(e,i,n){if(i){var r=i.playerAttrInfo;if(r){var s=ConfigMgr.gameConfig.attributeName,a=s[e.type+""];switch(e.type){case ComAttribute.intellectHurt:n?r.bonusDamage+=r.intellect*e.value/100:r.bonusDamage-=r.intellect*e.value/100;break;case ComAttribute.thornsPCT:case ComAttribute.leechPCT:case ComAttribute.invincible:case ComAttribute.hurtPCT:return;default:if(-1==e.hurtType)return;if(0==e.hurtType){var o={};o[a.value]=e.value,t.attributeMgr(o,n,r,i.jobId)}else{var o={};n?o[a.value]=e.value/100*r[a.value]:o[a.value]=r[a.value]*e.value/(100+e.value),t.attributeMgr(o,n,r,i.jobId)}}}}},t.BaseAttribute=["power","intellect","alacrity","physique"],t.BaseAttributeII=["powerQuality","intellectQuality","alacrityQuality","physiqueQuality"],t.DeriveAttribute=["attackInit","armorInit","magicAttack","magicArmorInit","blood"],t}();__reflect(AttributeUtlis.prototype,"AttributeUtlis");var ColorUtlis=function(){function t(){}return t.COLOR_STR=function(t,e){return e?(new egret.HtmlTextParser).parser("<font color = '#32CD32'>"+t+"</font>"):(new egret.HtmlTextParser).parser("<font color = '#FF3030'>"+t+"</font>")},t.colorMatrix=new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0]),t.QUALITY_COLOR=[16777215,5764702,5485050,16738006,16768318,15590579],t.COLOR_GREEN=3329330,t.COLOR_RED=16724016,t}();__reflect(ColorUtlis.prototype,"ColorUtlis");var CommonUtils=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.overLength=function(t){var e=null;return 1e5>t?e=Math.floor(t)+"":t>1e8?(t/=1e8,t=Math.floor(10*t)/10,e=t+"亿"):(t/=1e4,t=Math.floor(10*t)/10,e=t+"万"),e},e.labelIsOverLenght=function(t,e){t.text=this.overLength(e)},e}(BaseClass);__reflect(CommonUtils.prototype,"CommonUtils");var DateTimeUtils=function(){function t(){}return t.toTimeString=function(t){var e=Math.floor(t/3600),i=Math.floor(e/24);e%=24;var n=Math.floor((t-3600*(24*i+e))/60),r=Math.floor(t%60);return(i?i+"天":"")+(e?e+"时":"")+(n?n+"分":"")+(r?r+"秒":"")},t.date=new Date,t}();__reflect(DateTimeUtils.prototype,"DateTimeUtils");var MoneyUtils=function(){function t(){}return t.ShowGetWay=function(e){var i=ConfigMgr.gameConfig.gainRoad[e];if(i){var n=i.road.split(";");ViewManager.ins().open(ItemGetWayView,n,e,t.getMoneyName(e))}},t.getMoneyNum=function(t){var e=ConfigMgr.gameConfig.attributeName;return UserVo.ins[e[t].way]},t.getPropertyByType=function(t){var e=ConfigMgr.gameConfig.attributeName;return e[t].way},t.getMoneyName=function(t){var e=ConfigMgr.gameConfig.attributeName;return e[t].value},t.isMoneyType=function(e){if(!t.ALL_MONEY_PROPERTYS){t.ALL_MONEY_PROPERTYS=[];for(var i=0;i<t.ALL_MONEY.length;i++)t.ALL_MONEY_PROPERTYS.push(t.getPropertyByType(t.ALL_MONEY[i]))}return t.ALL_MONEY_PROPERTYS.indexOf(e)},t.recharge=function(t){},t.getMoneyData=function(e){var i=[];for(var n in e){var r=t.isMoneyType(n);-1!=r&&e[n]>0&&i.push({key:t.ALL_MONEY[r],val:e[n]})}return i},t.MD5=function(t){function e(t,e){return t<<e|t>>>32-e}function i(t,e){var i,n,r,s,a;return r=2147483648&t,s=2147483648&e,i=1073741824&t,n=1073741824&e,a=(1073741823&t)+(1073741823&e),i&n?2147483648^a^r^s:i|n?1073741824&a?3221225472^a^r^s:1073741824^a^r^s:a^r^s}function n(t,e,i){return t&e|~t&i}function r(t,e,i){return t&i|e&~i}function s(t,e,i){return t^e^i}function a(t,e,i){return e^(t|~i)}function o(t,r,s,a,o,h,l){return t=i(t,i(i(n(r,s,a),o),l)),i(e(t,h),r)}function h(t,n,s,a,o,h,l){return t=i(t,i(i(r(n,s,a),o),l)),i(e(t,h),n)}function l(t,n,r,a,o,h,l){return t=i(t,i(i(s(n,r,a),o),l)),i(e(t,h),n)}function p(t,n,r,s,o,h,l){return t=i(t,i(i(a(n,r,s),o),l)),i(e(t,h),n)}function c(t){for(var e,i=t.length,n=i+8,r=(n-n%64)/64,s=16*(r+1),a=Array(s-1),o=0,h=0;i>h;)e=(h-h%4)/4,o=h%4*8,a[e]=a[e]|t.charCodeAt(h)<<o,h++;return e=(h-h%4)/4,o=h%4*8,a[e]=a[e]|128<<o,a[s-2]=i<<3,a[s-1]=i>>>29,a}function u(t){var e,i,n="",r="";for(i=0;3>=i;i++)e=t>>>8*i&255,r="0"+e.toString(16),n+=r.substr(r.length-2,2);return n}function d(t){t=t.replace(/\r\n/g,"\n");for(var e="",i=0;i<t.length;i++){var n=t.charCodeAt(i);128>n?e+=String.fromCharCode(n):n>127&&2048>n?(e+=String.fromCharCode(n>>6|192),e+=String.fromCharCode(63&n|128)):(e+=String.fromCharCode(n>>12|224),e+=String.fromCharCode(n>>6&63|128),e+=String.fromCharCode(63&n|128))}return e}var g,f,m,v,y,_,E,T,C,M=Array(),I=7,S=12,b=17,A=22,k=5,D=9,L=14,P=20,R=4,w=11,U=16,V=23,B=6,O=10,G=15,x=21;for(t=d(t),M=c(t),_=1732584193,E=4023233417,T=2562383102,C=271733878,g=0;g<M.length;g+=16)f=_,m=E,v=T,y=C,_=o(_,E,T,C,M[g+0],I,3614090360),C=o(C,_,E,T,M[g+1],S,3905402710),T=o(T,C,_,E,M[g+2],b,606105819),E=o(E,T,C,_,M[g+3],A,3250441966),_=o(_,E,T,C,M[g+4],I,4118548399),C=o(C,_,E,T,M[g+5],S,1200080426),T=o(T,C,_,E,M[g+6],b,2821735955),E=o(E,T,C,_,M[g+7],A,4249261313),_=o(_,E,T,C,M[g+8],I,1770035416),C=o(C,_,E,T,M[g+9],S,2336552879),T=o(T,C,_,E,M[g+10],b,4294925233),E=o(E,T,C,_,M[g+11],A,2304563134),_=o(_,E,T,C,M[g+12],I,1804603682),C=o(C,_,E,T,M[g+13],S,4254626195),T=o(T,C,_,E,M[g+14],b,2792965006),E=o(E,T,C,_,M[g+15],A,1236535329),_=h(_,E,T,C,M[g+1],k,4129170786),C=h(C,_,E,T,M[g+6],D,3225465664),T=h(T,C,_,E,M[g+11],L,643717713),E=h(E,T,C,_,M[g+0],P,3921069994),_=h(_,E,T,C,M[g+5],k,3593408605),C=h(C,_,E,T,M[g+10],D,38016083),T=h(T,C,_,E,M[g+15],L,3634488961),E=h(E,T,C,_,M[g+4],P,3889429448),_=h(_,E,T,C,M[g+9],k,568446438),C=h(C,_,E,T,M[g+14],D,3275163606),T=h(T,C,_,E,M[g+3],L,4107603335),E=h(E,T,C,_,M[g+8],P,1163531501),_=h(_,E,T,C,M[g+13],k,2850285829),C=h(C,_,E,T,M[g+2],D,4243563512),T=h(T,C,_,E,M[g+7],L,1735328473),E=h(E,T,C,_,M[g+12],P,2368359562),_=l(_,E,T,C,M[g+5],R,4294588738),C=l(C,_,E,T,M[g+8],w,2272392833),T=l(T,C,_,E,M[g+11],U,1839030562),E=l(E,T,C,_,M[g+14],V,4259657740),_=l(_,E,T,C,M[g+1],R,2763975236),C=l(C,_,E,T,M[g+4],w,1272893353),T=l(T,C,_,E,M[g+7],U,4139469664),E=l(E,T,C,_,M[g+10],V,3200236656),_=l(_,E,T,C,M[g+13],R,681279174),C=l(C,_,E,T,M[g+0],w,3936430074),T=l(T,C,_,E,M[g+3],U,3572445317),E=l(E,T,C,_,M[g+6],V,76029189),_=l(_,E,T,C,M[g+9],R,3654602809),C=l(C,_,E,T,M[g+12],w,3873151461),T=l(T,C,_,E,M[g+15],U,530742520),E=l(E,T,C,_,M[g+2],V,3299628645),_=p(_,E,T,C,M[g+0],B,4096336452),C=p(C,_,E,T,M[g+7],O,1126891415),T=p(T,C,_,E,M[g+14],G,2878612391),E=p(E,T,C,_,M[g+5],x,4237533241),_=p(_,E,T,C,M[g+12],B,1700485571),C=p(C,_,E,T,M[g+3],O,2399980690),T=p(T,C,_,E,M[g+10],G,4293915773),E=p(E,T,C,_,M[g+1],x,2240044497),_=p(_,E,T,C,M[g+8],B,1873313359),C=p(C,_,E,T,M[g+15],O,4264355552),T=p(T,C,_,E,M[g+6],G,2734768916),E=p(E,T,C,_,M[g+13],x,1309151649),_=p(_,E,T,C,M[g+4],B,4149444226),C=p(C,_,E,T,M[g+11],O,3174756917),T=p(T,C,_,E,M[g+2],G,718787259),E=p(E,T,C,_,M[g+9],x,3951481745),_=i(_,f),E=i(E,m),T=i(T,v),C=i(C,y);return(u(_)+u(E)+u(T)+u(C)).toLowerCase()},t.M_1="money_1",t.M_2="money_2",t.M_3="money_3",t.M_4="money_4",t.M_5="money_5",t.M_6="money_6",t.M_7="money_7",t.ALL_MONEY=[t.M_1,t.M_2,t.M_3,t.M_4,t.M_5,t.M_6,t.M_7],t}();__reflect(MoneyUtils.prototype,"MoneyUtils");var StageUtils=function(t){function e(){var i=t.call(this)||this;return null==e._uiStage&&(e._uiStage=new eui.UILayer,e._uiStage.touchEnabled=!1,e._uiStage.percentHeight=100,e._uiStage.percentWidth=100,i.getStage().addChild(e._uiStage)),i}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getHeight=function(){return this.getStage().stageHeight},e.prototype.getWidth=function(){return this.getStage().stageWidth},e.prototype.getStage=function(){return egret.MainContext.instance.stage},e.prototype.setScaleMode=function(t){this.getStage().scaleMode=t},e}(BaseClass);__reflect(StageUtils.prototype,"StageUtils");var TextFlowMaker=function(){function t(){}return t.generateTextFlow=function(t){void 0===t&&(t="");for(var e=t.split("|"),i="",n=0,r=e.length;r>n;n++)i+=this.getSingleTextFlow(e[n]);return(new egret.HtmlTextParser).parser(i)},t.getSingleTextFlow=function(t){void 0===t&&(t="");var e=t.split("&T:",2);if(2==e.length){for(var i="<font",n=e[0].split("&"),r=void 0,s=!1,a=0,o=n.length;o>a;a++)switch(r=n[a].split(":"),r[0]){case this.STYLE_COLOR:i+=' color="'+parseInt(r[1])+'"';break;case this.STYLE_SIZE:i+=' size="'+parseInt(r[1])+'"';break;case this.UNDER_LINE:s=!0}return i+=s?"><u>"+e[1]+"</u></font>":">"+e[1]+"</font>"}return"<font>"+t+"</font>"},t.STYLE_COLOR="C",t.STYLE_SIZE="S",t.UNDER_LINE="U",t}();__reflect(TextFlowMaker.prototype,"TextFlowMaker");var AutoTimer=function(t){function e(e,i){var n=this,r=0;return i&&(r=i),n=t.call(this,e,i)||this,n.funcs=new Array,n.params=new Array,n}return __extends(e,t),e.prototype.hasFunc=function(t){return-1!=this.funcs.indexOf(t)},e.prototype.checkFuncs=function(){return this.funcs.length>0&&!this.hasEventListener(egret.TimerEvent.TIMER)},e.prototype.addFunc=function(t,e,i,n){void 0===n&&(n=!1);var r=this.funcs.indexOf(t);-1==r?(this.funcs.push(t),this.params.push({thisObj:e,params:i,once:n})):this.params[r]={thisObj:e,params:i,once:n},this.checkFuncs()&&(this.addEventListener(egret.TimerEvent.TIMER,this.onTime,this),this.start())},e.prototype.onTime=function(t){var e,i,n,r,s=this.funcs.length-1;for(e=s;e>=0;e--)i=this.funcs[e],n=this.params[e],r=i.apply(n.thisObj,n.params),(n.once||1==r)&&(this.funcs.splice(e,1),this.params.splice(e,1));this.funcs.length<=0&&(this.stop(),this.removeEventListener(egret.TimerEvent.TIMER,this.onTime,this))},e.prototype.removeFunc=function(t){var e=this.funcs.indexOf(t);-1!=e&&(this.funcs.splice(e,1),this.params.splice(e,1)),this.funcs.length<=0&&(this.stop(),this.removeEventListener(egret.TimerEvent.TIMER,this.onTime,this))},e.prototype.destruct=function(){this.stop(),this.removeEventListener(egret.TimerEvent.TIMER,this.onTime,this),this.funcs=null,this.params=null},e}(egret.Timer);__reflect(AutoTimer.prototype,"AutoTimer");var GameScene=function(){function t(e){t.ins=this,this.gameRoot=e,LayerManager.mapLayer.name="地图层",e.addChild(LayerManager.mapLayer),LayerManager.UI_MainUI.touchEnabled=LayerManager.UI_Main.touchEnabled=LayerManager.UI_Popup.touchEnabled=LayerManager.UI_Tips.touchEnabled=!1,e.addChild(LayerManager.UI_Main),e.addChild(LayerManager.UI_MainUI),e.addChild(LayerManager.UI_Popup),e.addChild(LayerManager.UI_Tips),LayerManager.guideLayer.name="引导层",LayerManager.guideLayer.touchEnabled=!1,e.addChild(LayerManager.guideLayer),GameMap.ins(LayerManager.mapLayer),GameMap.ins().setDisplaySize(this.gameRoot.stage.stageWidth,this.gameRoot.stage.stageHeight),this.input=new eui.TextInput,this.input.visible=!1,this.input.text="点击输入GM指令sssssssssssss",this.input.width=200,this.input.height=50,e.addChild(this.input),SkillMgr.ins,ViewManager.ins().open(MainUIWin),GameLogic.ins.changeMap(UserVo.ins.points),SoundManager.ins().playEffect("bgm_mp3")}return t}();__reflect(GameScene.prototype,"GameScene");var HashMap=function(){function t(){this._keyArr=new Array,this._valueArr=new Array,this._map=new Object}return t.prototype.clear=function(){this._keyArr.length=this._valueArr.length=0,this._map={}},t.prototype.has=function(t){return t instanceof egret.HashObject?void 0!=this._map[t.hashCode.toString()]:"string"==typeof t||"number"==typeof t?void 0!=this._map[t.toString()]:-1!=this._keyArr.indexOf(t)},t.prototype.add=function(t,e){this.has(t)&&this["delete"](t),t instanceof egret.HashObject?void 0==this._map[t.hashCode]&&(this._keyArr.push(t),this._map[t.hashCode]=e):"string"==typeof t||"number"==typeof t?void 0==this._map[t.toString()]&&(this._keyArr.push(t),this._map[t.toString()]=e):-1==this._keyArr.indexOf(t)&&(this._valueArr[this._keyArr.length]=e,this._keyArr.push(t))},t.prototype.get=function(t){if(t instanceof egret.HashObject)return this._map[t.hashCode];if("string"==typeof t||"number"==typeof t)return this._map[t.toString()];var e=this._keyArr.indexOf(t);return-1==e?null:this._valueArr[e]},t.prototype.startForMap=function(t){this._tmIndex=0,this._keyType=t,this._getByIndex||(this._getByIndex=this.getByIndex),t==egret.HashObject?(this.getByIndex=this.getByIndex1,this.deleteContext=this.deleteContext1):t==String||t==Number?(this.getByIndex=this.getByIndex2,this.deleteContext=this.deleteContext2):(this.getByIndex=this.getByIndex3,this.deleteContext=this.deleteContext3)},t.prototype.endForMap=function(){this._getByIndex&&(this.getByIndex=this._getByIndex)},t.prototype.getByIndex1=function(t){var e=this._keyArr[t];return this._tmIndex=t,this._tmKey=e,{key:e,value:this._map[e.hashCode]}},t.prototype.getByIndex2=function(t){var e=this._keyArr[t];return this._tmIndex=t,this._tmKey=e,{key:e,value:this._map[e.toString()]}},t.prototype.getByIndex3=function(t){return this._tmIndex=t,{key:this._keyArr[t],value:this._valueArr[t]}},t.prototype.getByIndex=function(t){if(-1==t)return null;var e=this._keyArr[t];return e?e instanceof egret.HashObject?{key:e,value:this._map[e.hashCode]}:"string"==typeof e||"number"==typeof e?{key:e,value:this._map[e.toString()]}:{key:e,value:this._valueArr[t]}:null},t.prototype.deleteContext1=function(){this._keyArr.splice(this._tmIndex,1),delete this._map[this._tmKey.hashCode]},t.prototype.deleteContext2=function(){this._keyArr.splice(this._tmIndex,1),delete this._map[this._tmKey.toString()]},t.prototype.deleteContext3=function(){this._keyArr.splice(this._tmIndex,1),this._valueArr.splice(this._tmIndex,1)},t.prototype.getKey=function(t){for(var e in this._map)if(this._map[e]==t)return e;for(var i=0;i<this._valueArr.length;i++)if(this._valueArr[i]==t)return this._keyArr[i];return null},t.prototype.shift=function(){var t,e=this._keyArr.shift();return e instanceof egret.HashObject?(t=this._map[e.hashCode],delete this._map[e.hashCode],{key:e,value:t}):"string"==typeof e||"number"==typeof e?(t=this._map[e.toString()],delete this._map[e.toString()],{key:e,value:t}):{key:e,value:this._valueArr.shift()}},t.prototype.pop=function(){var t,e=this._keyArr.pop();return e instanceof egret.HashObject?(t=this._map[e.hashCode],delete this._map[e.hashCode],{key:e,value:t}):"string"==typeof e||"number"==typeof e?(t=this._map[e.toString()],delete this._map[e.toString()],{key:e,value:t}):{key:e,value:this._valueArr.pop()}},t.prototype.indexOf=function(t){return this._keyArr.indexOf(t)},t.prototype["delete"]=function(t){var e=this._keyArr.indexOf(t);
-1!=e&&(this._keyArr.splice(e,1),t instanceof egret.HashObject?delete this._map[t.hashCode]:"string"==typeof t||"number"==typeof t?delete this._map[t.toString()]:this._valueArr.splice(e,1))},Object.defineProperty(t.prototype,"length",{get:function(){return this._keyArr.length},enumerable:!0,configurable:!0}),t.prototype.getKeyArr=function(){return this._keyArr},t}();__reflect(HashMap.prototype,"HashMap");var SystemInstance=function(){function t(){this._frameInstance=new egret.DisplayObject,this._framefuncls=new Array,this._framefuncparams=new Array,this._timerls=new Array,this._functimerls=new HashMap}return Object.defineProperty(t,"instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.nextFrameHandle=function(e,i){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];t.instance._addFrameHandle(e,i,n,!0)},t.addFrameHandle=function(e,i){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];t.instance._addFrameHandle(e,i,n)},t.removeFrameHandle=function(e,i){t.instance._removeFrameHandle(e,i)},t.prototype._hasFrameHandle=function(){return this._framefuncls.length>0&&!this._frameInstance.hasEventListener(egret.Event.ENTER_FRAME)},t.prototype._addFrameHandle=function(t,e,i,n){void 0===n&&(n=!1);var r=this._framefuncls.indexOf(t);-1==r?(this._framefuncls.push(t),this._framefuncparams.push({thisObj:e,params:i,once:n})):this._framefuncparams[r]={thisObj:e,params:i,once:n},this._hasFrameHandle()&&this._frameInstance.addEventListener(egret.Event.ENTER_FRAME,this.onFrame,this)},t.prototype.onFrame=function(t){var e,i,n,r=this._framefuncls.length-1;for(e=r;e>=0;e--)i=this._framefuncls[e],n=this._framefuncparams[e],i.apply(n.thisObj,n.params),n.once&&(this._framefuncls.splice(e,1),this._framefuncparams.splice(e,1));this._framefuncls.length<=0&&this._frameInstance.removeEventListener(egret.Event.ENTER_FRAME,this.onFrame,this)},t.prototype._removeFrameHandle=function(t,e){for(var i,n=this._framefuncparams.length,r=0;n>r;r++)if(i=this._framefuncparams[r],t==i.thisObj){this._framefuncls.splice(r,1),this._framefuncparams.splice(r,1);break}this._hasFrameHandle()&&this._frameInstance.removeEventListener(egret.Event.ENTER_FRAME,this.onFrame,this)},t.onceTickHandle=function(e,i,n){for(var r=[],s=3;s<arguments.length;s++)r[s-3]=arguments[s];t.instance._addTimeHandle(e,i,n,r,!0)},t.onceTickHandleNotCover=function(e,i,n){for(var r=[],s=3;s<arguments.length;s++)r[s-3]=arguments[s];t.instance._addTimeHandle(e,i,n,r,!0,!1)},t.addTimeHandle=function(e,i,n){for(var r=[],s=3;s<arguments.length;s++)r[s-3]=arguments[s];t.instance._addTimeHandle(e,i,n,r)},t.prototype._addTimeHandle=function(t,e,i,n,r,s){void 0===r&&(r=!1),void 0===s&&(s=!0);var a=this._functimerls.get(t);if(a&&s){if(a.delay==e)return void a.addFunc(t,i,n,r);a.removeFunc(t)}a=new AutoTimer(e),a.addFunc(t,i,n,r),this._functimerls.add(t,a)},t.removeTimeHandle=function(e){t.instance._removeTimeHandle(e)},t.prototype._removeTimeHandle=function(t){var e=this._functimerls.get(t);e&&(e.removeFunc(t),this._functimerls["delete"](t))},t.divisor=function(t,e){for(var i;0!=(i=t%e);)t=e,e=i;return e},t.multiple=function(e,i){var n;return n=t.divisor(e,i),e*i/n},t.checkDisplayVisibled=function(t){if(!t.stage||!t.visible)return!1;for(var e=t.parent;e&&e!=t.stage;){if(!e.visible)return!1;e=e.parent}return!0},t.formatFloat=function(t){return t},t}();__reflect(SystemInstance.prototype,"SystemInstance");var WelcomWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="welcomeSkin",e.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onclick,e),e.rc.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onclick,e),e.width=GlobalVo.GAME_W,e.height=GlobalVo.GAME_H,e.y=-GlobalVo.GAME_H,UIDmgr.bindingUID(e.btn,uid.beginGame),UIDmgr.bindingUID(e,uid.beginGameP),e}return __extends(e,t),e.prototype.onclick=function(t){this.btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick,this),this.rc.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick,this),this.parent&&this.parent.removeChild(this),GuideMgr._instance.save(1),GuideMgr._instance.guides.forEach(function(t){1==t.id&&(t.status=guideStep.End)}),GameLogic.GAME_STATUS=0,GuideMgr._instance.openFistGuide=!1},e}(eui.Component);__reflect(WelcomWin.prototype,"WelcomWin");var BaseScene=function(){function t(){this._layers=new Array}return t.prototype.onEnter=function(){},t.prototype.onExit=function(){},t.prototype.addLayer=function(t){t instanceof BaseSpriteLayer&&(StageUtils.ins().getStage().addChild(t),this._layers.push(t))},t}();__reflect(BaseScene.prototype,"BaseScene");var LoadingUI=function(t){function e(){var i=t.call(this)||this;i.data=[],i.loadImg=["newBg02.jpg","jdt.png","jdt1.png"],e.ins=i;var n=new egret.ImageLoader;return n.addEventListener(egret.Event.COMPLETE,function(t){i.data.push(n.data),i.loadImg.length>0?n.load("resource/res/other/"+i.loadImg.shift()):i.createView()},i),n.load("resource/res/other/"+i.loadImg.shift()),i}return __extends(e,t),e.prototype.createView=function(){var t=new egret.Texture;t._setBitmapData(this.data[0]),this.addChild(new egret.Bitmap(t)),t=new egret.Texture,t._setBitmapData(this.data[1]);var i=new egret.Bitmap(t);t=new egret.Texture,t._setBitmapData(this.data[2]);var n=new egret.Bitmap(t);this.p=n,this.r=new egret.Sprite,n.mask=this.r,this.addChild(i),this.addChild(this.r),this.addChild(n);var r=new egret.TextField;this.addChild(r),r.text="努力加载中...",r.textColor=15993107,r.width=750,r.height=100,r.bold=!0,r.size=30,r.fontFamily="KaiTi",r.textAlign="center",this.addChild(r),this.r.y=n.y=i.y=1167,this.r.x=n.x=i.x=64,r.y=1216,this.x=(GlobalVo.GAME_W-750)/2,this.y=(GlobalVo.GAME_H-1334)/2,this.dispatchEventWith(e.LOAD_UI_CREATE)},e.prototype.onProgress=function(t,e){egret.log(t,e),this.r.graphics.clear(),this.r.graphics.beginFill(0,1),this.r.graphics.drawRect(0,0,6+(this.p.width-6)*t/e,this.p.height),this.r.graphics.endFill()},e.LOAD_UI_CREATE="LOAD_UI_CREATE",e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var CreateRole=function(t){function e(){var e=t.call(this)||this;e.skinName="createRoleSkin",e.horizontalCenter=0;for(var i=1;7>=i;i++)e["b"+i].name=i+"",e["b"+i].addEventListener(egret.TouchEvent.TOUCH_TAP,e.onClick,e);var n=ConfigMgr.gameConfig.surnametype[0];return e.name1=n.surname.split("\n"),e.name2=n.name.split("\n"),e.randomJob(),e.randomName(),e}return __extends(e,t),e.prototype.randomJob=function(){this.b2.touchEnabled=this.b3.touchEnabled=!1,this.job=1,this.role.source=ResMgr.getGameOtherPng("h_"+this.job),this.sex=Math.floor(2*Math.random())+1},e.prototype.randomName=function(){var t;t=this.name1[Math.floor(Math.random()*this.name1.length)],t+=this.name2[Math.floor(Math.random()*this.name1.length)],this.t1.text=t},e.prototype.onClick=function(t){var e=parseInt(t.target.name);switch(e){case 1:case 2:case 3:this.job=e,this.role.source=ResMgr.getGameOtherPng("h_"+e);break;case 4:if(""==this.t1.text)return void UserTips.ins().showTipsBigToSmall("请输入名字!");var i={playerName:this.t1.text,jobId:this.job,sex:this.sex};HttpMgr.ins.sendMessage(ClientPacket.S_10002,i,ServerPacket.LOGIC_URL);break;case 5:this.randomName();break;case 6:this.sex=1;break;case 7:this.sex=2}},Object.defineProperty(e.prototype,"sex",{get:function(){return this._sex},set:function(t){this._sex=t,this.b6.selected=1==t,this.b7.selected=1!=t,this.role.source="h_"+t+"_png"},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.parent&&this.parent.removeChild(this);for(var t=1;5>=t;t++)this["b"+t].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},e}(eui.Component);__reflect(CreateRole.prototype,"CreateRole",["IDispose"]);var LoginView=function(t){function e(){var e=t.call(this)||this;e.horizontalCenter=0,e.skinName="loginViewSkin",e.b1.addEventListener(egret.TouchEvent.TOUCH_TAP,e.loginGame,e);var i=egret.localStorage.getItem("an");return i&&(e.t1.text=i+""),i=egret.localStorage.getItem("pw"),i&&(e.t2.text=i+""),e}return __extends(e,t),e.prototype.loginGame=function(){if(""==this.t1.text)return void UserTips.ins().showTipsBigToSmall("请输入正确的账号!");if(""==this.t2.text)return void UserTips.ins().showTipsBigToSmall("请输入正确的密码!");var t={accountName:this.t1.text,passWord:this.t2.text};this.b1.touchEnabled=!1,egret.localStorage.setItem("an",this.t1.text),egret.localStorage.setItem("pw",this.t2.text),HttpMgr.ins.sendMessage(ClientPacket.S_1002,t,ServerPacket.LOGIN_URL)},e.prototype.dispose=function(){this.parent&&this.parent.removeChild(this),this.b1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.loginGame,this)},e}(eui.Component);__reflect(LoginView.prototype,"LoginView",["IDispose"]);var SelectLogin=function(t){function e(e,i){var n=t.call(this)||this;if(n.horizontalCenter=0,n.skinName="selectLoginSkin",n.data=e,n.serverlist=i.reverse(),n.serverlist.length>0){var r=n.serverlist[0];r.v=!0,n.l0.textFlow=ColorUtlis.COLOR_STR(r.serverId+"区  "+r.serverName,1==r.serverState)}return n.da.itemRenderer=serverDataRender,n.da.dataProvider=new eui.ArrayCollection(i),n.l2.textFlow=n.l1.textFlow=ColorUtlis.COLOR_STR(e.serverId+"区  "+e.serverName,1==e.serverState),n.b1.addEventListener(egret.TouchEvent.TOUCH_TAP,n.getServer,n),n.da.addEventListener(egret.TouchEvent.TOUCH_TAP,n.getServer,n),n.bg.addEventListener(egret.TouchEvent.TOUCH_TAP,n.getServer,n),n.r.addEventListener(egret.TouchEvent.TOUCH_TAP,n.getServer,n),n}return __extends(e,t),e.prototype.getServer=function(t){if(t.currentTarget==this.bg)this.g0.visible=!0;else if(t.currentTarget==this.r)this.g0.visible=!1;else if(t.currentTarget==this.b1){if(1!=this.data.serverState)return void UserTips.ins().showTipsBigToSmall("当前区服属于关闭状态,请重新选择!");this.b1.touchEnabled=!1;var e={serverId:this.data.serverId,userId:UserVo.ins.userId};GlobalVo.serverId=this.data.serverId,HttpMgr.ins.sendMessage(ClientPacket.S_1004,e,ServerPacket.LOGIN_URL)}else if(t.target instanceof serverDataRender){this.g0.visible=!1;var i=this.serverlist[t.target.itemIndex];this.data=i,this.l1.textFlow=ColorUtlis.COLOR_STR(i.serverId+"区  "+i.serverName,1==i.serverState)}},e.prototype.dispose=function(){this.parent&&this.parent.removeChild(this),this.b1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.getServer,this)},e}(eui.Component);__reflect(SelectLogin.prototype,"SelectLogin",["IDispose"]);var serverDataRender=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.l0.textFlow=ColorUtlis.COLOR_STR(this.data.serverId+"区  "+this.data.serverName,1==this.data.serverState),this.l1.source=this.data.v?"火爆":"流畅"},e}(eui.ItemRenderer);__reflect(serverDataRender.prototype,"serverDataRender");var ArtifactItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="ArtifactItemSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.euiCompete=function(){this.dataChanged(),DataEventDispatcher.dispatcher.addEventListener(GameEvent.RED_ARTIFACE,this.upRed,this)},e.prototype.upRed=function(){ViewManager.redToTarge(this.itemIcon,0!=RemindMgr.artifactTips[this.itemIndex])},e.prototype.dataChanged=function(){if(this.data){var t=this.data.itemId;this.itemConfing=BagVo.ins().getItem(t),this.setIcon(this.itemConfing.iconID),this.setQuality(this.itemConfing.rank),this.validateNow(),0==this.itemIndex&&UIDmgr.bindingUID(this,uid.af1),this.upRed()}},e.prototype.setIcon=function(t){this.itemIcon.setIcon(ResMgr.getGameItemPng(t))},e.prototype.setQuality=function(t){this.itemIcon.setQuality(t)},e}(BaseItemRender);__reflect(ArtifactItemRender.prototype,"ArtifactItemRender");var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loadNum=0,e}return __extends(e,t),e.prototype.createChildren=function(){e.instance=this,t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){},egret.lifecycle.onResume=function(){};var i=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",i),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.left=this.right=this.top=this.bottom=0,eui.Label.default_fontFamily="Microsoft YaHei";try{var n=StageUtils.ins().getStage(),r=0,s=0;if(window.innerWidth?r=window.innerWidth:document.body&&document.body.clientWidth&&(r=document.body.clientWidth),window.innerHeight?s=window.innerHeight:document.body&&document.body.clientHeight&&(s=document.body.clientHeight),egret.Capabilities.isMobile){egret.log("屏幕适配 IsMobile");var a=navigator.userAgent;egret.log("IsMobile userAgent: "+a),StageUtils.ins().getStage().orientation=egret.OrientationMode.PORTRAIT,StageUtils.ins().getStage().scaleMode=egret.StageScaleMode.FIXED_NARROW}else r>=s?(StageUtils.ins().getStage().orientation=egret.OrientationMode.AUTO,StageUtils.ins().getStage().scaleMode=egret.StageScaleMode.SHOW_ALL):(StageUtils.ins().getStage().orientation=egret.OrientationMode.PORTRAIT,StageUtils.ins().getStage().scaleMode=egret.StageScaleMode.FIXED_NARROW);egret.log("屏幕适配模式 2   orientation:"+n.orientation+" scaleMode:"+n.scaleMode)}catch(o){egret.log("自适应屏幕出错:"+o)}egret.log(egret.Capabilities.os),ParamMgr.initParam(),this.runGame()["catch"](function(t){console.log(t)}),egret.log("当前游戏版本号:"+ParamMgr.ver),this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){t.target instanceof eui.Button&&SoundManager.ins().playEffect("butt0n_mp3")},this)},e.prototype.window_W_H=function(t,e){egret.Capabilities.isMobile||(t>=e?(this.stage.orientation=egret.OrientationMode.AUTO,this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL):(this.stage.orientation=egret.OrientationMode.PORTRAIT,this.stage.scaleMode=egret.StageScaleMode.FIXED_NARROW))},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.loadingView=new LoadingUI,this.loadingView.addEventListener(LoadingUI.LOAD_UI_CREATE,this.beginGameLoad,this),[2]})})},e.prototype.beginGameLoad=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.addChild(this.loadingView),showLoad(-1),[4,this.loadResource()];case 1:return t.sent(),this.loadData(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return e.sent(),LoadingUI.ins.onProgress(1,7),[4,this.loadTheme()];case 2:return e.sent(),LoadingUI.ins.onProgress(2,7),[4,RES.loadGroup("preload")];case 3:return e.sent(),LoadingUI.ins.onProgress(3,7),[3,5];case 4:return t=e.sent(),console.error(t),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var n=new eui.Theme("resource/default.thm.json",t.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.loadData=function(){switch(this.loadNum){case 0:LoadingUI.ins.onProgress(4,7),DataEventDispatcher.dispatcher.addEventListener(ConfigMgr.LOAD_CONFIG_END,this.loadComplete,this),ConfigMgr.ins.loadConfig();break;case 1:LoadingUI.ins.onProgress(5,7),DataEventDispatcher.dispatcher.removeEventListener(ConfigMgr.LOAD_CONFIG_END,this.loadComplete,this),DataEventDispatcher.dispatcher.addEventListener(ProtoBufMgr.LOAD_PROTO_END,this.loadComplete,this),ProtoBufMgr.ins.loadProtoBuf();break;case 2:LoadingUI.ins.onProgress(6,7),DataEventDispatcher.dispatcher.removeEventListener(ProtoBufMgr.LOAD_PROTO_END,this.loadComplete,this),DataEventDispatcher.dispatcher.addEventListener(TMXMgr.LOAD_TMX_END,this.loadComplete,this),TMXMgr.ins().loadTmx();break;default:DataEventDispatcher.dispatcher.removeEventListener(TMXMgr.LOAD_TMX_END,this.loadComplete,this),this.prepareGame()}},e.prototype.loadComplete=function(){this.loadNum++,this.loadData()},e.prototype.prepareGame=function(){if(this.removeChild(this.loadingView),DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_2002,this.loginBack,this),DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_2005,this.loginBack,this),0!=ParamMgr.SPID){var t={sdkType:ParamMgr.SPID,sdkUserId:ParamMgr.username,optional:"optional"};return void HttpMgr.ins.sendMessage(ClientPacket.S_1005,t,ServerPacket.LOGIN_URL)}this.loginV=new LoginView,this.loginV.x=(GlobalVo.GAME_W-this.loginV.width)/2,this.loginV.y=(GlobalVo.GAME_H-this.loginV.height)/2,this.addChild(this.loginV)},e.prototype.loginBack=function(t){return DataEventDispatcher.dispatcher.removeEventListener(ServerPacket.C_2002,this.loginBack,this),DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_2003,this.serverList,this),t.data.isSuccess?(UserVo.ins.userId=t.data.userId,this.recommend=t.data.serverInfo,void HttpMgr.ins.sendMessage(ClientPacket.S_1003,{},ServerPacket.LOGIN_URL,!0)):void UserTips.ins().showTipsBigToSmall("游戏登陆失败,请重新刷新游戏!")},e.prototype.serverList=function(t){this.loginV&&(this.loginV.dispose(),this.loginV=null),DataEventDispatcher.dispatcher.removeEventListener(ServerPacket.C_2003,this.serverList,this),DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_2004,this.serverUrlBack,this),this.sl=new SelectLogin(this.recommend,t.data.pbServerInfoList),this.sl.x=(GlobalVo.GAME_W-this.sl.width)/2,this.sl.y=(GlobalVo.GAME_H-this.sl.height)/2,this.addChild(this.sl)},e.prototype.serverUrlBack=function(t){DataEventDispatcher.dispatcher.removeEventListener(ServerPacket.C_2004,this.serverUrlBack,this),DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20001,this.goGameBack,this),GlobalVo.token=t.data.token,ParamMgr.gameUrl="http://"+t.data.serverIp+":"+t.data.serverPort+"/",ServerPacket.LOGIC_URL=t.data.serverAddress,GameSocket.ins.addEventListener(egret.Event.CONNECT,function(){var t={userId:UserVo.ins.userId,token:GlobalVo.token,serverId:GlobalVo.serverId};HttpMgr.ins.sendMessage(ClientPacket.S_10001,t,ServerPacket.LOGIC_URL,!0)},this),GameSocket.ins.connectByUrl("ws://"+t.data.serverIp+":"+t.data.serverPort+"/"+ServerPacket.LOGIC_URL)},e.prototype.goGameBack=function(t){return DataEventDispatcher.dispatcher.removeEventListener(ServerPacket.C_20001,this.goGameBack,this),DataEventDispatcher.dispatcher.removeEventListener(ServerPacket.C_20002,this.goGameBack,this),this.cr||(UserVo.ins.uuid=t.data.uuid),t.data.playerInfo?(UserVo.ins.setData(t.data.playerInfo),this.createGameScene(),this.sl&&(this.sl.dispose(),this.sl=null),void(this.cr&&(this.cr.dispose(),this.cr=null))):(DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20002,this.goGameBack,this),this.sl.dispose(),this.sl=null,this.cr=new CreateRole,this.cr.x=(GlobalVo.GAME_W-this.cr.width)/2,this.cr.y=(GlobalVo.GAME_H-this.cr.height)/2,void this.addChild(this.cr))},e.prototype.createGameScene=function(){HttpMgr.ins.sendMessage(ClientPacket.S_10003,null,ServerPacket.LOGIC_URL,!0),clips.ClipGroup.loadNum=10,new ModelResMgr,new GameScene(this)},e.prototype.base64_encode=function(t){for(var e,i,n,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,a=t.length,o="";a>s;){if(e=255&t.charCodeAt(s++),s==a){o+=r.charAt(e>>2),o+=r.charAt((3&e)<<4),o+="==";break}if(i=t.charCodeAt(s++),s==a){o+=r.charAt(e>>2),o+=r.charAt((3&e)<<4|(240&i)>>4),o+=r.charAt((15&i)<<2),o+="=";break}n=t.charCodeAt(s++),o+=r.charAt(e>>2),o+=r.charAt((3&e)<<4|(240&i)>>4),o+=r.charAt((15&i)<<2|(192&n)>>6),o+=r.charAt(63&n)}return o},e}(eui.UILayer);__reflect(Main.prototype,"Main");var BagWin=function(t){function e(){var e=t.call(this)||this;return e.typeAr=[],e.skinName="BagSkin",e.isTopLevel=!0,e.itemList.addEventListener(egret.Event.RENDER,function(){UIDmgr.bindingUID(e.itemList.getVirtualElementAt(0),uid.bagItem)},e),e}return __extends(e,t),e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this.typeAr=[BagVo.ITEM_TYPE_EQUIP,BagVo.ITEM_TYPE_OTHER,BagVo.ITEM_TYPE_GEM],this.btnIndex=0|e[0],this.currList=[],this.itemList.itemRenderer=BaseItem,this.group.visible=this.smeltBtn.visible=!0;ConfigMgr.gameConfig.item[2001];DataEventDispatcher.dispatcher.addEventListener(GameEvent.UPDATE_BAG_DATA,this.selectType,this),this.addTouchEvent(this.smeltBtn,this.onTap),this.addTouchEvent(this.btn0,this.onTypeTap),this.addTouchEvent(this.btn1,this.onTypeTap),this.addTouchEvent(this.btn2,this.onTypeTap),this.selectType(),UIDmgr.bindingUID(this.btn0,uid.equipBtn),UIDmgr.bindingUID(this.smeltBtn,uid.rl0),UIDmgr.bindingUID(this.group,uid.itemParent),this.addEvent(GameEvent.RED_BAG_RED,DataEventDispatcher.dispatcher,this.upRed),UIDmgr.bindingUID(this.itemList.getVirtualElementAt(0),uid.bagItem),ViewManager.redToTarge(this.btn1,RemindMgr.hasOtherItem)},e.prototype.upRed=function(){ViewManager.redToTarge(this.btn1,RemindMgr.hasOtherItem)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];DataEventDispatcher.dispatcher.removeEventListener(GameEvent.UPDATE_BAG_DATA,this.selectType,this),this.curTabBtn&&(this.curTabBtn.currentState="up")},e.prototype.update=function(){if(this.currList.length<36)for(var t=0;36>t;t++)this.currList[t]||(this.currList[t]=null);this.itemList.dataProvider=new eui.ArrayCollection(this.currList)},e.prototype.onTap=function(t){ViewManager.ins().open(SmeltWin)},e.prototype.onTypeTap=function(t){switch(t.currentTarget){case this.btn0:this.btnIndex=0;break;case this.btn1:this.btnIndex=1;break;case this.btn2:this.btnIndex=2}this.selectType()},e.prototype.selectType=function(){this.curTabBtn&&(this.curTabBtn.currentState="up"),this.curTabBtn=this["btn"+this.btnIndex],this.curTabBtn.currentState="down",this.smeltBtn.visible=0==this.btnIndex,this.currList=BagVo.ins().getTypeItemList(this.typeAr[this.btnIndex]),this.update()},e}(BaseEuiView);__reflect(BagWin.prototype,"BagWin"),ViewManager.ins().reg(BagWin,LayerManager.UI_MainUI);var ItemTipView=function(t){function e(){var e=t.call(this)||this;return e.skinName="ItemTipSkin",e.horizontalCenter=e.verticalCenter=0,e}return __extends(e,t),e.prototype.open=function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];t.prototype.open.call(this,i),this.itemVo=i[0],this.item.data=this.itemVo;var r=BagVo.ins().getItem(this.itemVo.itemId);if(this.l5.text="",this.tp=r.itemType,4==r.itemType)this.btn0.visible=this.btn1.visible=!0,this.btn1.label="使  用",this.l1.text="需要等级:"+r.requiredLevel,this.l4.text=r.description,this.l0.visible=this.l2.visible=this.l3.visible=this.btn2.visible=!1,this.addTouchEvent(this.btn0,this.onTap),this.addTouchEvent(this.btn1,this.onTap);else if(1==r.itemType){var s=ConfigMgr.gameConfig.gemAttr[r.itemId];this.l1.text="品质:"+GlobalVo.RANK[r.rank],this.l4.textFlow=(new egret.HtmlTextParser).parser(e.getItemAtt(r,r.itemType)),this.l3.visible=this.btn2.visible=!0,this.l0.visible=this.l2.visible=this.btn0.visible=this.btn1.visible=!1,this.addTouchEvent(this.btn2,this.onTap),this.l5.text=s.initialScore}else{var a=ConfigMgr.gameConfig.equip[r.itemId];this.l0.visible=this.l2.visible=this.l3.visible=this.btn0.visible=this.btn1.visible=!0,this.l0.text="部位:"+GlobalVo.EQUIPS[a.equipCoordinate],this.l1.text="需要等级:"+r.requiredLevel,this.l2.text="品质:"+GlobalVo.RANK[r.rank],this.l4.textFlow=(new egret.HtmlTextParser).parser(e.getItemAtt(r)),this.btn1.label="穿  戴",this.btn2.visible=!1,this.addTouchEvent(this.btn0,this.onTap),this.addTouchEvent(this.btn1,this.onTap),this.l5.text=a.initialScore+(this.itemVo.level?this.itemVo.level:1)*a.growScore,UIDmgr.bindingUID(this.btn1,uid.itemcd)}(this.itemVo instanceof Number||!this.itemVo.uuid)&&(this.btn0.visible=this.btn1.visible=!1,this.btn2.visible=!0,this.addTouchEvent(this.btn2,this.onTap)),this.btn0.y=this.btn1.y=this.btn2.y=this.l4.y+this.l4.textHeight+10,this.bg.height=this.l4.y+this.l4.textHeight+100+10},e.getItemAtt=function(t,e){void 0===e&&(e=2);var i;i=2==e?ConfigMgr.gameConfig.equip[t.itemId]:ConfigMgr.gameConfig.gemAttr[t.itemId];var n="";for(var r in i)void 0!=UserVo.ins.playerAttrInfo[r]&&0!=i[r]&&ConfigMgr.gameConfig.attributeName[r]&&(n+=ConfigMgr.gameConfig.attributeName[r].value+":"+i[r]+PbPlayerAttrInfo.isPercent(r),n+="\n");return n},e.prototype.onTap=function(t){switch(t.currentTarget){case this.btn1:2==this.tp?HttpMgr.ins.sendMessage(ClientPacket.S_10008,{uuid:this.itemVo.uuid},ServerPacket.LOGIC_URL,!0):4==this.tp&&HttpMgr.ins.sendMessage(ClientPacket.S_10035,{uuid:this.itemVo.uuid},ServerPacket.LOGIC_URL,!0)}ViewManager.ins().close(this)},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.close.call(this,e)},e}(BaseEuiView);__reflect(ItemTipView.prototype,"ItemTipView"),ViewManager.ins().reg(ItemTipView,LayerManager.UI_Popup);var ItemInfo=function(){function t(){this.showEquipsCount=!1}return t}();__reflect(ItemInfo.prototype,"ItemInfo");var BagVo=function(t){function e(){var e=t.call(this)||this;return e.bagList=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initEvent=function(){DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20003,this.setBaglist,this),DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20012,this.smeltResponse,this),DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_30002,this.itemChange,this)},e.prototype.setBaglist=function(t){e.ins().bagList=t.data.items},e.prototype.getItem=function(t){return ConfigMgr.gameConfig.item[t]},e.prototype.itemChange=function(t){this.bagList||(this.bagList=[]);var e,i,n=t.data.bagChangeInfo.bagChangeItems,r=!1,s=0;for(var a in n){s=0;var o=n[a],h=this.getItem(o.itemId);r=!1;for(var l=0;l<this.bagList.length;l++)if(e=this.bagList[l],o.uuid==e.uuid){r=!0,o.itemNum>0?this.bagList[l]=o:this.bagList.splice(l,1),s=o.itemNum-e.itemNum;break}r||(this.bagList.push(o),s=o.itemNum),i=s>0?"获得":"失去",s>0&&UserTips.ins().showitemTips(i+("|S:28&C:"+ColorUtlis.QUALITY_COLOR[h.rank]+"&T:"+h.name+"x"+s))}DataEventDispatcher.dispatchEventWith(GameEvent.UPDATE_BAG_DATA,-1)},e.prototype.smeltResponse=function(t){t.data.isSuccess&&UserTips.ins().showTipsBigToSmall("熔炼完成",!1)},e.prototype.removeBagItem=function(t){for(var e in t)for(var i=t[e],n=0;n<this.bagList.length;n++)if(i.uuid==this.bagList[n].uuid){this.bagList.splice(n,1);break}},e.prototype.getSmeltList=function(){var t=[];for(var e in this.bagList){var i=this.bagList[e],n=this.getItem(i.itemId);if(2==n.itemType)for(var r=ConfigMgr.gameConfig.equip[i.itemId],s=0;s<UserVo.ins.Columns.length;s++){var a=UserVo.ins.Columns[s].itemInfo;if(a){var o=ConfigMgr.gameConfig.equip[a.itemId];r.itemQuality<=o.itemQuality&&r.equipCoordinate==o.equipCoordinate&&t.push(i)}}}return t},e.prototype.getQualitySmeltList=function(t){var e=this.getSmeltList(),i=[];for(var n in e)for(var r=e[n],s=0;s<t.length;s++){if(0==t[s])return e;var a=ConfigMgr.gameConfig.equip[r.itemId];a&&a.rank==t[s]&&i.push(r)}return i},e.prototype.getTypeItemList=function(t){var e=[];for(var i in this.bagList){var n=this.bagList[i],r=this.getItem(n.itemId);r.itemType==t&&e.push(n)}return 2==t?e.sort(function(t,e){var i=ConfigMgr.gameConfig.equip[t.itemId],n=ConfigMgr.gameConfig.equip[e.itemId];return i.initialScore+i.growScore*t.level>n.initialScore+n.growScore*e.level?1:-1}):1==t&&e.sort(function(t,e){var i=ConfigMgr.gameConfig.gemAttr[t.itemId],n=ConfigMgr.gameConfig.gemAttr[e.itemId];return i.initialScore>n.initialScore?1:-1}),e},e.prototype.getIdItem=function(t){for(var e in this.bagList){var i=this.bagList[e];if(i.itemId==t)return i}return null},e.prototype.getBagGemList=function(){var t=[];for(var e in this.bagList){var i=this.bagList[e],n=this.getItem(i.itemId);1==n.itemType&&t.push(i)}return t.sort(this.gemListSort)},e.prototype.gemListSort=function(t,e){return t.itemId>e.itemId?-1:t.itemId<e.itemId?1:0},e.prototype.getPosEquipList=function(t){var e=[];for(var i in this.bagList){var n=this.bagList[i],r=this.getItem(n.itemId);if(2==r.itemType&&r.heroType==UserVo.ins.jobId){var s=ConfigMgr.gameConfig.equip[n.itemId];(s.equipCoordinate==t||4==s.equipCoordinate&&(4==t||5==t)||6==s.equipCoordinate&&(6==t||7==t))&&e.push(n)}}return e.sort(function(t,e){var i=ConfigMgr.gameConfig.equip[t.itemId],n=ConfigMgr.gameConfig.equip[e.itemId];return i.equipScore>n.equipScore?-1:1}),e},e.EQUIP_MAX=10,e.ITEM_TYPE_GEM=1,e.ITEM_TYPE_EQUIP=2,e.ITEM_TYPE_ARTIFACT=3,e.ITEM_TYPE_OTHER=4,e}(BaseClass);__reflect(BagVo.prototype,"BagVo");var ChatRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChatRenderSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;e.id&&""!=e.id?(this.vip.text=e.vipLvl+"",this.g0.visible=e.vipLvl>0,this.ln.text=e.playName+":"):(this.g0.visible=!1,this.ln.text="系统广播:"),this.ld.text=e.des,this.ld.height=89},e.prototype.dispose=function(){this.parent&&this.parent.removeChild(this),ObjectPool.push(this)},e}(eui.ItemRenderer);__reflect(ChatRender.prototype,"ChatRender");var ChatWin=function(t){function e(){var e=t.call(this)||this;return e.dy=0,e.skinName="ChatSkin",e.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return""==e.txt.text?UserTips.ins().showTipsBigToSmall("请输入要发送的内容!"):e.txt.text.length>24?UserTips.ins().showTipsBigToSmall("发送的内容长度不能超过24!"):(HttpMgr.ins.sendMessage(ClientPacket.S_30000,{type:0,content:e.txt.text},ServerPacket.LOGIC_URL,!0),void(e.txt.text=""))},e),e}return __extends(e,t),e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this.addEvent(GameEvent.UP_CHAT,DataEventDispatcher.dispatcher,this.addMessage),this.addMessage()},e.prototype.addMessage=function(){var t,e=this.g0.numChildren,i=ChatMgr.ins().chatArr.length;if(i!=e){for(;i!=e;)t=ObjectPool.pop("ChatRender"),t.data=ChatMgr.ins().chatArr[e],t.y=this.dy,this.dy+=t.height+5,this.g0.addChild(t),e++;this.checkDel()}},e.prototype.checkDel=function(){var t=ChatMgr.ins().chatArr.length;if(t>=100){for(var e;t>30;)ChatMgr.ins().chatArr.shift(),t--,e=this.g0.getChildAt(0),e.dispose();this.dy=0;for(var i=0;30>i;i++)e=this.g0.getChildAt(i),e.y=this.dy,this.dy+=e.height+5}},e}(BaseEuiView);__reflect(ChatWin.prototype,"ChatWin"),ViewManager.ins().reg(ChatWin,LayerManager.UI_MainUI);var EmailMessage=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){var i=this;t.prototype.createChildren.call(this),this.dg.itemRenderer=BaseItem,this.btn0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return 0!=i.data.itemState?UserTips.ins().showTipsBigToSmall("该邮件附件已领取!"):i.data.itemList&&0!=i.data.itemList.length?void HttpMgr.ins.sendMessage(ClientPacket.S_10038,{emailId:i.data.emailId},ServerPacket.LOGIC_URL,!0):UserTips.ins().showTipsBigToSmall("该邮件无附件可领取!")},this),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_EMAIL_STATUS,this.upStatus,this),e.ins=this,DataEventDispatcher.dispatcher.addEventListener(GameEvent.REMOVE_EMAIL,function(t){i.data&&-1!=t.data.indexOf(i.data.emailId)&&(i.l2.text="",i.data=null)},this)},e.prototype.setData=function(t){this.data!=t&&(0==t.readState&&HttpMgr.ins.sendMessage(ClientPacket.S_10037,{emailId:t.emailId},ServerPacket.LOGIC_URL,!0),this.btn0.visible=!0,this.data=t,this.l2.text=t.emailContent,this.upStatus(null))},e.prototype.upStatus=function(t){t&&-1==t.data.indexOf(this.data.emailId)||(this.btn0.visible=0==this.data.itemState&&this.data.itemList&&this.data.itemList.length>0,this.btn0.visible?this.dg.dataProvider=new eui.ArrayCollection(this.data.itemList):this.dg.dataProvider=new eui.ArrayCollection([]))},e}(eui.Component);__reflect(EmailMessage.prototype,"EmailMessage");var EmailRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="EmailRenderSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){EmailMessage.ins.setData(e.data)},e),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_EMAIL_STATUS,e.upStatus,e),e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.upStatus(null)
},e.prototype.upStatus=function(t){if(!t||-1!=t.data.indexOf(this.data.emailId)){var e="";e=0==this.data.readState?" <font color='#1CFF05'>未读":0==this.data.itemState&&this.data.itemList&&this.data.itemList.length>0?" <font color='#1CFF05'>可领取":" <font color='#F70707'>已读",""!=e&&(e+="</font>"),this.l1.text=this.data.emailTitle,this.l0.textFlow=(new egret.HtmlTextParser).parser(e)}},e}(eui.ItemRenderer);__reflect(EmailRender.prototype,"EmailRender");var BaseWin0=function(t){function e(){var e=t.call(this)||this;return e.left=e.right=e.top=e.bottom=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"titleS",{get:function(){return this._titleS},set:function(t){this._titleS=t,this.tt&&(this.tt.source=this._titleS)},enumerable:!0,configurable:!0}),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this._titleS&&(this.tt.source=this._titleS)},e}(eui.Component);__reflect(BaseWin0.prototype,"BaseWin0");var MessageView=function(t){function e(){var e=t.call(this)||this;return e.skinName="MessageSkin",e}return __extends(e,t),e.prototype.open=function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];t.prototype.open.call(this,i);for(var r,s,a,o=0;o<e.dataList.length;o++){switch(o){case 0:r=UserVo.ins.playerName;break;case 1:r=UserVo.ins.points+"",a=this.getLvl(1,UserVo.ins.points);break;case 2:r=UserVo.ins.rebirthNum+"",a=this.getLvl(2,UserVo.ins.rebirthNum);break;case 3:r=UserVo.ins.fightPower+"",a=this.getLvl(3,UserVo.ins.fightPower);break;case 4:s=this.getEquipsPower(),r=s+"",a=this.getLvl(4,s);break;case 5:s=this.getEquipsPower(1),r=s+"",a=this.getLvl(5,s);break;case 6:s=this.skillPower(),r=s+"",a=this.getLvl(6,s);break;case 7:s=this.AchievementProgress(),r=s+"%",a=this.getLvl(7,s)}this["l"+o].text=e.dataList[o]+r,0!=o&&(this["l"+(o+7)].text=a)}this.addTouchEvent(this.btn0,this.onTap),this.addTouchEvent(this.rc,this.onTap)},e.prototype.getLvl=function(t,e){for(var i=ConfigMgr.gameConfig.info[t],n=["D","C","B","A","S","SS","SSS"],r=0;r<n.length;r++){if(r==n.length-1)return n[r];if(e>=i["Class"+n[r]]&&e<i["Class"+n[r+1]])return n[r]}},e.prototype.onTap=function(t){ViewManager.ins().close(this)},e.prototype.getEquipsPower=function(t){void 0===t&&(t=0);for(var e=0,i=0;i<UserVo.ins.Columns.length;i++)if(0==t){var n=UserVo.ins.Columns[i].itemInfo;if(!n)continue;var r=ConfigMgr.gameConfig.equip[n.itemId];e+=r.initialScore+n.level*r.growScore}else{var s=UserVo.ins.Columns[i].gemGrooves.gemGrooves;for(var a in s){var o=s[a];if(o.gemId>0){var h=ConfigMgr.gameConfig.gemAttr[o.gemId];e+=h.initialScore}}}return e},e.prototype.skillPower=function(){for(var t=0,e=0;e<Human.ins.useingSkill.length;e++)t+=Human.ins.useingSkill[e].stdSkill.initialScore;return t},e.prototype.AchievementProgress=function(){for(var t=[[],[],[]],e=TaskMgr.ins().typeTask[3],i=UserVo.ins.getTaskInfo(3),n=0;n<e.length;n++){e[n].completeNum=0,e[n].isReceive=1;for(var r=0;r<i.length;r++)if(e[n].taskId==i[r].taskId){e[n].completeNum=i[r].completeNum,e[n].isReceive=i[r].isReceive?0:i[r].completeNum>=e[n].taskTime&&(0==e[n].lastTaskId||AchievementWin.isReceive(e[n].lastTaskId,3))?2:1;break}t[e[n].isReceive].push(e[n])}return Math.floor(100*(1-t[1].length/e.length))},e.dataList=[["玩家名:"],["最高关卡层数:"],["重生次数:"],["战力:"],["装备战力:"],["宝石战力:"],["技能战力:"],["成就完成度:"]],e}(BaseEuiView);__reflect(MessageView.prototype,"MessageView"),ViewManager.ins().reg(MessageView,LayerManager.UI_Popup);var NoticeView=function(t){function e(){var e=t.call(this)||this;return e.skinName="NoticeSkin",e.l0.textFlow=(new egret.HtmlTextParser).parse(ConfigMgr.gameConfig.bulletin[0].content),e.l1.textFlow=(new egret.HtmlTextParser).parse(ConfigMgr.gameConfig.bulletin[0].title),e}return __extends(e,t),e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this.addTouchEvent(this.btn0,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.btn0:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(NoticeView.prototype,"NoticeView"),ViewManager.ins().reg(NoticeView,LayerManager.UI_Popup);var ForgeWin=function(t){function e(){var e=t.call(this)||this;return e.isFive=!1,e.upNum=0,e.skinName="ForgeSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.glowFilter=new egret.GlowFilter(16776960,.8,35,35,2,3,!1,!1);var e=new clips.BmpClip;e.setScaleX(1.2),e.scaleY=1.2,ModelResMgr.getOtherEffect(10007,e),e.play(-1),this.g0.addChild(e);for(var i=0;10>i;i++)this["equip"+i].itemIcon.labName.visible=!1},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_STRENGTH,this.onUpEquip,this),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_ADVANCE,this.onAdvancedEquip,this),this.addChangeEvent(this.tabBar,this.selectPanel),this.addEvent(GameEvent.RED_STRENG,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_EQUIP_LVL,DataEventDispatcher.dispatcher,this.upRed),this.viewStack.selectedIndex=0,this.panel=this.viewStack.getElementAt(0),this.update();for(var n=0;10>n;n++)this.addTouchEvent(this["equip"+n],this.onSelectEquip);this.panel.open(this.curData);for(var r=0;10>r;r++)if(this["equip"+r].data){UIDmgr.bindingUID(this["equip"+r],uid.forgeBtn1);break}this.upRed()},e.prototype.upRed=function(){if(ViewManager.redToTarge(this.tabBar.getVirtualElementAt(0),RemindMgr.StrengEquips.length>0),ViewManager.redToTarge(this.tabBar.getVirtualElementAt(1),RemindMgr.upEquipsLvl.length>0),0==this.viewStack.selectedIndex)for(var t=0;10>t;t++)ViewManager.redToTarge(this["equip"+t].itemIcon,RemindMgr.StrengEquips[t]?!0:!1);else for(var t=0;10>t;t++)ViewManager.redToTarge(this["equip"+t].itemIcon,RemindMgr.upEquipsLvl[t]?!0:!1)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.selectPanel=function(){0==this.viewStack.selectedIndex?this.panel=this.viewStack.getElementAt(0):this.panel=this.viewStack.getElementAt(1),this.setSelectData(),this.panel.open(this.curData),this.upRed()},e.prototype.onUpEquip=function(t){t.data.isSuccess&&(this.update(),this.setSelectData())},e.prototype.onAdvancedEquip=function(t){t.data.isSuccess&&(this.curData.itemId++,this.update(),this.setSelectData())},e.prototype.update=function(){if(UserVo.ins.Columns)for(var t=0;t<UserVo.ins.Columns.length;t++){var e=UserVo.ins.Columns[t].itemInfo;this.removeTouchEvent(this["equip"+t],this.onSelectEquip),this.addTouchEvent(this["equip"+t],this.onSelectEquip),this["equip"+t].data=e}},e.prototype.onSelectEquip=function(t){this.currItem&&(this.currItem.itemIcon.filters=[]),this.currItem=t.currentTarget;var e=this.currItem.data;e&&(this.curData=e,this.setSelectData(),this.currItem.itemIcon.filters=[this.glowFilter],UIDmgr.bindingUID(this.tabBar.getVirtualElementAt(0),uid.forgeBtn2),UIDmgr.bindingUID(this.tabBar.getVirtualElementAt(1),uid.forgeBtn4))},e.prototype.setSelectData=function(){this.panel.setData(this.curData)},e}(BaseEuiView);__reflect(ForgeWin.prototype,"ForgeWin"),ViewManager.ins().reg(ForgeWin,LayerManager.UI_MainUI);var AdvancedPanel=function(t){function e(){var e=t.call(this)||this;return e.isFive=!1,e.upNum=0,e.skinName="AdvancedSkin",e.touchEnabled=!1,e.top=e.bottom=0,e.item.itemIcon.imgBg.visible=!1,e}return __extends(e,t),e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this);var i=new clips.BmpClip;this.Effmc=i,this.Effmc.visible=!1,ModelResMgr.getOtherEffect(10017,i),this.Effmc.stop(),this.Effmc.addEventListener(egret.Event.COMPLETE,function(){e.Effmc.gotoAndStop(1),e.Effmc.visible=!1},this),this.g0.addChild(i)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curData=t[0],this.curr.setData("当前强化",null,!0,2),this.curr0.setData("下一强化",null,!1,2),this.strengGroup.visible=!1,this.addTouchEvent(this.avdBtn,this.upEquip),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_ADVANCE,this.onUpEquip,this),this.curData&&this.setData(this.curData),UIDmgr.bindingUID(this.avdBtn,uid.forgeBtn5)},e.prototype.onUpEquip=function(t){t.data.isSuccess&&(this.Effmc.visible=!0,this.setData(this.curData),this.Effmc.play(1))},e.prototype.setData=function(t){if(this.item.data=this.curData=t,this.needItem.setIcon(ResMgr.getGameItemPng(MoneyUtils.M_6)),this.curData){this.strengGroup.visible=!0;var e=ForgeVo.ins().getEquipID(this.curData.itemId),i=UserVo.ins.reinforcedEquipmentStone;this.labName0.text=i+"/"+e.reinforcedEquipmentStone,this.labName0.textColor=i>=e.reinforcedEquipmentStone?ColorUtlis.COLOR_GREEN:ColorUtlis.COLOR_RED;BagVo.ins().getItem(this.curData.itemId);this.star.setLv(e.itemQuality),this.curr.setData("本阶属性",this.curData,!0,2),this.curr0.setData("下阶属性",this.curData,!1,2)}},e.prototype.upEquip=function(t){return this.labName0.textColor==ColorUtlis.COLOR_RED?void UserTips.ins().showTipsBigToSmall("升阶石不足"):(ForgeVo.ins().advanceItem=this.item.data,void HttpMgr.ins.sendMessage(ClientPacket.S_10010,{itemId:this.item.data.itemId},ServerPacket.LOGIC_URL,!0))},e}(BaseView);__reflect(AdvancedPanel.prototype,"AdvancedPanel");var StrengthenPanel=function(t){function e(){var e=t.call(this)||this;return e.isFive=!1,e.upNum=0,e.skinName="StrengSkin",e.name="强 化",e.top=e.bottom=0,e.item.itemIcon.imgBg.visible=!1,e}return __extends(e,t),e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),this.touchEnabled=!1;var i=new clips.BmpClip;this.Effmc=i,this.Effmc.visible=!1,ModelResMgr.getOtherEffect(10017,i),this.Effmc.addEventListener(egret.Event.COMPLETE,function(){e.Effmc.gotoAndStop(1),e.Effmc.visible=!1},this),this.g0.addChild(i)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curData=t[0],this.curr.setData("当前强化",null,!0,1),this.curr0.setData("下一强化",null,!1,1),this.strengGroup.visible=!1,this.curData&&this.setData(t[0]),this.addTouchEvent(this.equipBtn1,this.upEquip),this.addTouchEvent(this.equipBtn2,this.upEquip),UIDmgr.bindingUID(this.equipBtn2,uid.forgeBtn3),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_STRENGTH,this.onUpEquip,this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.equipBtn1,this.upEquip),this.removeTouchEvent(this.equipBtn2,this.upEquip)},e.prototype.onUpEquip=function(t){t.data.isSuccess&&(this.Effmc.visible=!0,this.Effmc.play(1),this.upNum++,this.isFive&&this.upNum<5?HttpMgr.ins.sendMessage(ClientPacket.S_10009,{itemId:this.curData.itemId},ServerPacket.LOGIC_URL,!0):(this.upNum=0,this.isFive=!1),0==this.upNum&&this.setData(this.curData))},e.prototype.setData=function(t){if(this.item.data=this.curData=t,this.curData){this.strengGroup.visible=!0;for(var e=(ForgeVo.ins().getEquipID(this.curData.itemId),0),i=0;5>i;i++)e+=ForgeVo.ins().getUpEquipGold(this.curData.level+i);var n=UserVo.ins.gold;this.labNeed1.text="消耗金币："+e,this.labNeed1.textColor=n>=e?ColorUtlis.COLOR_GREEN:ColorUtlis.COLOR_RED,this.labNeed2.text="消耗金币："+ForgeVo.ins().getUpEquipGold(this.curData.level),this.labNeed2.textColor=n>=ForgeVo.ins().getUpEquipGold(this.curData.level)?ColorUtlis.COLOR_GREEN:ColorUtlis.COLOR_RED,this.curr.setData("当前强化",this.curData,!0,1),this.curr0.setData("下一强化",this.curData,!1,1)}},e.prototype.upEquip=function(t){if(t.currentTarget==this.equipBtn1){if(this.isFive=!0,this.labNeed1.textColor==ColorUtlis.COLOR_RED)return void UserTips.ins().showTipsBigToSmall("金币不足")}else if(this.labNeed2.textColor==ColorUtlis.COLOR_RED)return void UserTips.ins().showTipsBigToSmall("金币不足");ForgeVo.ins().strengthenItem=this.item.data,HttpMgr.ins.sendMessage(ClientPacket.S_10009,{itemId:this.item.data.itemId},ServerPacket.LOGIC_URL,!0)},e}(BaseView);__reflect(StrengthenPanel.prototype,"StrengthenPanel");var ForgeItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="EquipSkin",e.itemIcon.isClick=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){this.itemIcon.clears(),this.data&&0!=this.data.itemId&&(this.itemIcon.data=this.data)},e}(BaseItemRender);__reflect(ForgeItem.prototype,"ForgeItem");var ForgeTypeView=function(t){function e(){var e=t.call(this)||this;return e.skinName="ForgeTypeSkin",e.dg0.itemRenderer=PropertyRender,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.setData=function(t,e,i,n){void 0===i&&(i=!0);var r=["powerQuality","intellectQuality","alacrityQuality","physiqueQuality"],s=["力量资质","智力资质","敏捷资质","体力资质"],a=[];null==e&&(this.l0.text="选择装备!",this.l0.visible=!0);var o=null;if(1==n&&e){this.l0.visible=!1,s=["力量","智力","敏捷","体力"];for(var h=0;h<r.length;h++)ConfigMgr.gameConfig.equip[e.itemId][r[h]]>0&&a.push([s[h],(i?e.level:1)*ConfigMgr.gameConfig.equip[e.itemId][r[h]]])}else if(2==n&&e)if(o=ConfigMgr.gameConfig.equip[i?e.itemId:e.itemId+1]){this.l0.visible=!1;for(var h=0;h<r.length;h++)o[r[h]]>0&&a.push([s[h],e.level*o[r[h]]])}else this.l0.text="已达极限!",this.l0.visible=!0;this.dg0.dataProvider=new eui.ArrayCollection(a)},e}(BaseView);__reflect(ForgeTypeView.prototype,"ForgeTypeView");var StarIcon=function(t){function e(){var e=t.call(this)||this;return e.lv=1,e.skinName="StarSkin",e}return __extends(e,t),e.prototype.euiCompete=function(){this.setLv(this.lv)},e.prototype.setLv=function(t){this.lv=t;for(var e=0;10>e;e++)this["star"+e].visible=!1,t>e&&(this["star"+e].visible=!0)},e}(BaseView);__reflect(StarIcon.prototype,"StarIcon");var ForgeVo=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initEvent=function(){DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20008,this.WearEquipRequest,this),DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20031,this.takeOffEquipResponse,this)},e.prototype.WearEquipRequest=function(t){UserTips.ins().showTipsBigToSmall("穿戴成功",!1),this.updateEquip(t.data.bagChangeInfo.bagChangeItems[0],t.data.loc),DataEventDispatcher.dispatchEventWith(GameEvent.WEAR_EQUIPS)},e.prototype.updateEquip=function(t,i){var n=e.ins().getEquipID(t.itemId);if(n){for(var r=0;r<this.equipAttr.length;r++)this.equipAttr[r]&&AttributeUtlis.attributeMgr(this.equipAttr[r],!1);UserVo.ins.Columns[i].itemInfo=t,this.setEquipAttr()}},e.prototype.takeOffEquipResponse=function(t){t.data.isSuccess&&(UserVo.ins.Columns[t.data.loc].itemInfo=null,this.equipAttr[t.data.loc]&&AttributeUtlis.attributeMgr(this.equipAttr[t.data.loc],!1),this.equipAttr[t.data.loc]=null,DataEventDispatcher.dispatchEventWith(GameEvent.UPDATE_PLAYER_WIN,-1))},e.prototype.getEquipID=function(t){return ConfigMgr.gameConfig.equip[t]},e.prototype.getUpEquipGold=function(t){var e=ConfigMgr.gameConfig.equipGrow[t];return e?e.gold:0},e.prototype.setEquipAttr=function(t){var i=t?t==UserVo.ins:!0;t=t?t:UserVo.ins;for(var n=[],r=0;r<t.Columns.length;r++){var s=t.Columns[r].itemInfo;if(s){var a=e.ins().getEquipID(s.itemId),o={};for(var h in a)void 0!=t.playerAttrInfo[h]&&(o[h]=a[h],-1!=AttributeUtlis.BaseAttributeII.indexOf(h)&&(o[h]*=s.level+1));AttributeUtlis.attributeMgr(o,!0,t.playerAttrInfo,t.jobId),n[r]=o}}i&&(this.equipAttr=n)},e.prototype.strengthenBack=function(t){if(t.isSuccess){this.strengthenItem.level++;for(var e=0;e<this.equipAttr.length;e++)this.equipAttr[e]&&AttributeUtlis.attributeMgr(this.equipAttr[e],!1);this.setEquipAttr(),DataEventDispatcher.dispatchEventWith(GameEvent.UP_STRENGTH,t)}},e.prototype.advanceBack=function(t){if(t.isSuccess){for(var e=0;e<this.equipAttr.length;e++)this.equipAttr[e]&&AttributeUtlis.attributeMgr(this.equipAttr[e],!1);this.setEquipAttr(),DataEventDispatcher.dispatchEventWith(GameEvent.UP_ADVANCE,t)}},e}(BaseClass);__reflect(ForgeVo.prototype,"ForgeVo");var GemItemBase=function(t){function e(){var e=t.call(this)||this;return e.skinName="GemItemSkin",e.itemIcon.labName.visible=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.mc=ModelResMgr.getOtherEffect(10027),this.g0.addChild(this.mc)},e.prototype.euiCompete=function(){this.btnGroup.visible=!1},e.prototype.dataChanged=function(){if(this.clearData(),this.data&&(this.data.isOpen?(this.mc.stop(),this.mc.visible=!1):(this.mc.play(-1),this.mc.visible=!0)),this.data&&0!=this.data.gemId){this.addTouchEvent(this.upBtn,this.onTap),this.addTouchEvent(this.downBtn,this.onTap);var t=this.data.gemId;this.itemIcon.data=BagVo.ins().getItem(t),this.labLv.text="LV."+GemVo.ins().getGemLv(t)}},e.prototype.onTap=function(t){this.upBtn==t.currentTarget?GemVo.ins().upGem(this.data):this.downBtn==t.currentTarget&&GemVo.ins().sendGemRemoveRequest(this.data.loc)},e.prototype.setBtnGrou=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=8),this.btnGroup.visible=t,t&&0==e&&(e=this.itemIcon.width+5),this.btnGroup.x=e,this.btnGroup.y=i},e.prototype.clearData=function(){this.itemIcon.setIcon(""),this.itemIcon.setQuality(-1),this.labLv.text="",this.removeTouchEvent(this.upBtn,this.onTap),this.removeTouchEvent(this.downBtn,this.onTap)},e}(BaseItemRender);__reflect(GemItemBase.prototype,"GemItemBase");var BaseWin1=function(t){function e(){var e=t.call(this)||this;return e.left=e.right=e.top=e.bottom=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"titleS",{get:function(){return this._titleS},set:function(t){this._titleS=t,this.title&&(this.title.text=this._titleS)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bgH",{get:function(){return this._bgH},set:function(t){this._bgH=t,this.g0&&(this.g0.height=t)},enumerable:!0,configurable:!0}),e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),this._titleS&&(this.title.text=this._titleS),this.g0&&(this.g0.height=this._bgH),this.rc.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){ViewManager.ins().close(e.parent)},this),this.newCloseBtn00&&this.newCloseBtn00.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){ViewManager.ins().close(e.parent)},this)},e}(eui.Component);__reflect(BaseWin1.prototype,"BaseWin1");var MainUIWin=function(t){function e(){var e=t.call(this)||this;return e.pp=!1,e.right=0,e.touchEnabled=!1,e.skinName="mainUISkin",DataEventDispatcher.dispatcher.addEventListener(GameEvent.MONSTER_COUNT_CHANGE,e.challengeStatus,e),DataEventDispatcher.dispatcher.addEventListener(BaseMap.LOAD_MAP_COMPLETE,function(){ConfigMgr.gameConfig.pointInfo[UserVo.ins.points+""];e.pro.visible=GameMap.ins().onHookMap,e.pp=UserVo.ins.points%3==2;UserVo.ins.points-(e.pp?1:0);e.exit.visible=!GameMap.ins().onHookMap},e),DataEventDispatcher.dispatcher.addEventListener(GameEvent.SELECT_SKILL,function(t){var i=t.data.b;SkillMgr.ins.skillChange(t.data.a,t.data.b),HttpMgr.ins.sendMessage(ClientPacket.S_10007,{skillTab:i.stdSkill.tab,loc:t.data.a},ServerPacket.LOGIC_URL),e.skills[t.data.a].setData(t.data.b)},e),e}return __extends(e,t),e.prototype.euiCompete=function(){t.prototype.euiCompete.call(this),this.challenge.visible=!1,this.skills=[];for(var e=92,i=GlobalVo.GAME_W-6*e-176,n=i/8,r=0;7>r;r++)this["skill"+r].name=r+"",3>r?this["skill"+r].x=e*r+(r+1)*n:6>r&&(this["skill"+r].x=GlobalVo.GAME_W-(6-r)*e-(6-r)*n),this.skills.push(this["skill"+r]),this.skills[r].monitorCD=!0;DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.fightPower,this.upPower,this),DataEventDispatcher.dispatcher.addEventListener(GameEvent.INIT_ROLE,this.upSkillList,this),UIDmgr.bindingUID(this.skill0,uid.skill0),UIDmgr.bindingUID(this.g0,uid.jnP0),UIDmgr.bindingUID(this.s,uid.jnP2);var s=new clips.BmpClip;s.y=109,s.x=53,ModelResMgr.getOtherEffect(10013,s),s.play(-1),this.challenge.addChild(s);var s=new clips.BmpClip;s.x=100,s.y=10,ModelResMgr.getOtherEffect(10015,s),s.play(-1),this.challenge.addChild(s),this.upRed(null),this.navBtn=[this.roleBtn,this.bagBtn,this.riskBtn,this.skillBtn,this.achieveBtn],this.viewAr=[PlayerWin,BagWin,null,SkillWin,AchievementWin];for(var a=0;a<this.navBtn.length;a++)this.addTouchEvent(this.navBtn[a],this.onClick);this.addTouchEvent(this.arenaBtn,this.onOpenBtn),this.addTouchEvent(this.copyBtn,this.onOpenBtn),this.addTouchEvent(this.mailBtn,this.onOpenBtn),this.addTouchEvent(this.rankBtn,this.onOpenBtn),this.addTouchEvent(this.taskBtn,this.onOpenBtn),this.addTouchEvent(this.shopBtn,this.onOpenBtn),this.addTouchEvent(this.noticeBtn,this.onOpenBtn),this.addTouchEvent(this.newsBtn,this.onOpenBtn),this.addTouchEvent(this.chatBtn,this.onOpenBtn),this.addTouchEvent(this.firstBtn,this.onOpenBtn),this.addTouchEvent(this.mcBtn,this.onOpenBtn),this.addTouchEvent(this.mbBtn,this.onOpenBtn),UIDmgr.bindingUID(this.roleBtn,uid.roleBtn),UIDmgr.bindingUID(this.bagBtn,uid.bag),UIDmgr.bindingUID(this.taskBtn,uid.rw0),UIDmgr.bindingUID(this.copyBtn,uid.fb0),UIDmgr.bindingUID(this.skillBtn,uid.jn0),UIDmgr.bindingUID(this.arenaBtn,uid.p0),UIDmgr.bindingUID(this.achieveBtn,uid.cj0),UIDmgr.bindingUID(this.riskBtn,uid.back1),UIDmgr.bindingUID(this.reBornBtn,uid.cs0),this.addEvent(GameEvent.RED_MAIN_TASK,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_DAY_TASK,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_ACHEIEVEMENT,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_SKILL,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_ARTIFACE,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_STRENG,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_EQUIP_LVL,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_GEM_LVL,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_EMAIL,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_BAG_RED,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.STUDY_SKILL,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_ACTIVETY,DataEventDispatcher.dispatcher,this.upRed),this.upRed(null),UserVo.ins.isRecharge&&ActivetyMgr.ins().checkAtivityEnd(ActivetyMgr.FIRST_CHARGE,1)?this.firstBtn.parent&&this.firstBtn.parent.removeChild(this.firstBtn):ViewManager.effectToTarge(this.firstBtn,!0),ViewManager.effectToTarge(this.mcBtn,!0),ViewManager.effectToTarge(this.mbBtn,!0)},e.prototype.upRed=function(t){var e=SkillMgr.NEW_STUDY.length>0;RemindMgr.taskGetSatus[3]&&(e=!0),!e&&RemindMgr.CAN_UP_SKILL.length>0&&(e=!0),(!e&&-1!=RemindMgr.artifactTips.indexOf(1)||-1!=RemindMgr.artifactTips.indexOf(2))&&(e=!0),RemindMgr.StrengEquips.length>0&&(e=!0),RemindMgr.upEquipsLvl.length>0&&(e=!0),!e&&RemindMgr.GEM&&(e=!0),ViewManager.redToTarge(this.mainBtn,e),ViewManager.redToTarge(this.actionBtn,RemindMgr.activetyRED),ViewManager.redToTarge(this.achieveBtn,1==RemindMgr.taskGetSatus[3]),ViewManager.redToTarge(this.taskBtn,1==RemindMgr.taskGetSatus[1]||1==RemindMgr.taskGetSatus[2]),ViewManager.redToTarge(this.skillBtn,RemindMgr.CAN_UP_SKILL.length>0||SkillMgr.NEW_STUDY.length>0),ViewManager.redToTarge(this.roleBtn,-1!=RemindMgr.artifactTips.indexOf(1)||-1!=RemindMgr.artifactTips.indexOf(2)||RemindMgr.StrengEquips.length>0||RemindMgr.upEquipsLvl.length>0||RemindMgr.GEM),ViewManager.redToTarge(this.mailBtn,RemindMgr.HAVE_READ_EMAIL),ViewManager.redToTarge(this.bagBtn,RemindMgr.hasOtherItem)},e.prototype.upSkillList=function(){for(var t=0;t<this.skills.length;t++)this.skills[t].data||UserVo.ins.skillColumn[t]&&this.skills[t].setData(SkillMgr.ins.getRoleSkill(ConfigMgr.gameConfig.skill[UserVo.ins.skillColumn[t]].secondarySkill_id))},e.prototype.upPower=function(){this.labfight.text=UserVo.ins.fightPower+""},e.prototype.challengeStatus=function(t){var e=this;if(-2==t.data)this.challenge.visible=!1,this.pro.visible=GameMap.ins().onHookMap;else if(-1==t.data){if(this.challenge.visible)return;this.challenge.x=GlobalVo.GAME_W,this.challenge.visible=!0;egret.Tween.get(this.challenge).to({x:GlobalVo.GAME_W/2-this.challenge.width/2},150).call(function(){UIDmgr.bindingUID(e.challenge,uid.bossBtn)},this)}else 0==t.data&&(this.challenge.visible=!1)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this.addTouchEvent(this.mainBtn,this.onTap),this.addTouchEvent(this.reBornBtn,this.onTap);for(var n=0;n<this.skills.length;n++)this.addEvent(egret.TouchEvent.TOUCH_BEGIN,this.skills[n],this.onTap),this.addEvent(egret.TouchEvent.TOUCH_END,this.skills[n],this.onTap);this.addTouchEvent(this.challenge,this.onTap),this.addTouchEvent(this.exit,this.onTap),this.addTouchEvent(this.reBtn,this.onTap),this.addTouchEvent(this.actionBtn,this.onTap),this.addTouchEvent(this.vipBtn,this.onTap),this.upPower(),this.addEvent(GameEvent.RED_MAIN_TASK,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_DAY_TASK,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_ACHEIEVEMENT,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_SKILL,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_ARTIFACE,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_STRENG,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_EQUIP_LVL,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_GEM_LVL,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_EMAIL,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.STUDY_SKILL,DataEventDispatcher.dispatcher,this.upRed)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.reBtn:ViewManager.ins().open(RechargeWin);break;case this.exit:GameMap.ins().inJJCMap?PVPMgr.ins().pVPFightEnd(!1):GameMap.ins().inFBMap&&FBMgr.ins.eixtFb(!0);break;case this.challenge:HttpMgr.ins.sendMessage(ClientPacket.S_10004,{},ServerPacket.LOGIC_URL),this.challenge.visible=!1;break;case this.mainBtn:this.g0.visible=!0,this.qiehuan.visible=this.s.visible=!1;break;case this.actionBtn:ViewManager.ins().open(ActivityWin);break;case this.vipBtn:ViewManager.ins().open(VipWin);break;case this.reBornBtn:if(!SystemOpenMgr.checkOpen(ReborthWin,!0))return;ViewManager.ins().open(ReborthWin);break;default:var e=t.currentTarget;if(e&&e.canClick){if(GameMap.ins().inJJCMap)return void UserTips.ins().showTipsBigToSmall("竞技场内,无法手动释放技能!");e.data.initiativeSkill?UserTips.ins().showTipsBigToSmall("被动技能,无需手动释放!"):Human.ins.addSkill(e.data)}}},e.prototype.onClick=function(t){var e=t.currentTarget;e==this.riskBtn?(this.g0.visible=!1,this.qiehuan.visible=this.s.visible=!0):this.selectView(e),UIDmgr.bindingUID(this.riskBtn,uid.back1)},e.prototype.onOpenBtn=function(t){switch(t.currentTarget){case this.chatBtn:ViewManager.ins().open(ChatWin);break;case this.firstBtn:ViewManager.ins().open(FirstCharge);break;case this.mbBtn:ViewManager.ins().open(LimitCard);break;case this.mcBtn:ViewManager.ins().open(MonthCard);break;case this.arenaBtn:ViewManager.ins().open(PVPWin);break;case this.copyBtn:ViewManager.ins().open(PVEWin);break;case this.shopBtn:ViewManager.ins().open(ShopWin);break;case this.rankBtn:ViewManager.ins().open(RankWin);break;case this.taskBtn:ViewManager.ins().open(TaskWin);break;case this.mailBtn:ViewManager.ins().open(EmailView);break;case this.noticeBtn:ViewManager.ins().open(NoticeView);break;case this.newsBtn:ViewManager.ins().open(MessageView);break;default:UserTips.ins().showTipsBigToSmall("敬请期待")}},e.prototype.selectView=function(t){var e=this.navBtn.indexOf(t),i=this.viewAr[e]?ViewManager.ins().open(this.viewAr[e]):null;return i?!0:!1},e}(BaseEuiView);__reflect(MainUIWin.prototype,"MainUIWin"),ViewManager.ins().reg(MainUIWin,LayerManager.UI_Main);var MapMess=function(t){function e(){var e=t.call(this)||this;return e.RX=95,e.RY=72,e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.mmap.mask=this.mm,DataEventDispatcher.dispatcher.addEventListener(BaseMap.LOAD_MAP_COMPLETE,function(){var t=GameMap.ins();e.mmap.source=ResMgr.getMapImage(t.lastFile+".jpg"),e.ln.text=t.mapType==MapType.TYPE_3?"竞技场":t.mapType==MapType.TYPE_2?"副本(第"+parseInt(t.mc.partID)%100+"层)":"第"+t.mc.pointId+"关"},this),TimerManager.ins().doTimer(500,0,function(){e.rr.visible=!e.rr.visible},this),DataEventDispatcher.dispatcher.addEventListener(GameEvent.CHANGE_MINIMAP,function(t){var i=DisplayMapObject.MINMAP_SCALE,n=MapVo.ins.miniMapW,r=MapVo.ins.miniMapH,s=t.data.a/i,a=t.data.b/i;s-=e.mm.width/2,s=-s,a-=e.mm.height/2,a=-a,s>=0?(e.rr.x=e.RX-s,s=0):s<=e.mm.width-n?(e.rr.x=e.RX+(-s+e.mm.width-n),s=e.mm.width-n):e.rr.x=e.RX,a>=0?(e.rr.y=e.RY-a,a=0):a<=e.mm.height-r?(e.rr.y=e.RY+(-a+e.mm.height-r),a=e.mm.height-r):e.rr.y=e.RY,e.mmap.x=s+e.mm.x,e.mmap.y=a+38},this)},e}(eui.Component);__reflect(MapMess.prototype,"MapMess");var MoneyPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="moneySkin",e}return __extends(e,t),Object.defineProperty(e.prototype,"moneyType",{set:function(t){this.mt=t,this.goldImg.source=ResMgr.getGameItemPng(t),DataEventDispatcher.dispatcher.addEventListener(GameEvent.MONEY_TYPE_CHANGE,this.upVal,this),this.upVal()},enumerable:!0,configurable:!0}),e.prototype.upVal=function(){this.labGold.text=CommonUtils.overLength(MoneyUtils.getMoneyNum(this.mt))},e}(eui.Component);__reflect(MoneyPanel.prototype,"MoneyPanel");var PProgress=function(t){function e(){var e=t.call(this)||this;return e.pp=!1,e}return __extends(e,t),e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),DataEventDispatcher.dispatcher.addEventListener(GameEvent.MONSTER_COUNT_CHANGE,this.challengeStatus,this),DataEventDispatcher.dispatcher.addEventListener(BaseMap.LOAD_MAP_COMPLETE,function(){ConfigMgr.gameConfig.pointInfo[UserVo.ins.points+""];e.pp=UserVo.ins.points%3==2;var t=UserVo.ins.points-(e.pp?1:0);e.l0000.text=t+"",e.l1111.text=t+1+""},this)},e.prototype.challengeStatus=function(t){if(-2==t.data)this.hp.value=0;else if(-1==t.data);else{this.pp=UserVo.ins.points%3==2;var e=t.data/GameLogic.SKILL_MONSTER_COUNT;e=e>1?1:e,e*=.5,e+=this.pp?.5:0,this.hp.value=100*e}},e}(eui.Component);__reflect(PProgress.prototype,"PProgress");var Btn01=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"s0",{get:function(){return this._s0},set:function(t){this._s0=t,this.n0&&(this.n0.source=this.s0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"s1",{get:function(){return this._s1},set:function(t){this._s1=t,this.n1&&(this.n1.source=this.s1)},enumerable:!0,configurable:!0}),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.s1&&(this.n1.source=this.s1),this.s0&&(this.n0.source=this.s0)},e}(eui.Button);__reflect(Btn01.prototype,"Btn01");var RoleIcon=function(t){function e(){var e=t.call(this)||this;return e.skinName="roleIconSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.level,this.upLvl,this),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.rebirthNum,this.upLvl,this),this.upLvl(),this.icon.source="human"+UserVo.ins.sex+"_png";var e=new clips.BmpClip;ModelResMgr.getOtherEffect(10029,e),e.play(-1),this.eff.addChild(e)},e.prototype.upLvl=function(){this.lvl.text=UserVo.ins.rebirthNum+"重"+UserVo.ins.level+"级"},e}(eui.Component);__reflect(RoleIcon.prototype,"RoleIcon");var SelectSkillPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="selectSkillSkin",e}return __extends(e,t),e.prototype.euiCompete=function(){var e=this;t.prototype.euiCompete.call(this);for(var i=0;4>i;i++)this.addTouchEvent(this["skill"+i],function(t){0==t.currentTarget.data.level?UserTips.ins().showTipsBigToSmall("技能未学习,无法使用!"):DataEventDispatcher.dispatchEventWith(GameEvent.SELECT_SKILL,{a:e.dx,b:t.currentTarget.data}),e.visible=!1})},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this.dx=e[0];
for(var n=SkillMgr.ins.getRoleSkillByGroup(e[1].stdSkill.skill_id),r=0;r<n.length;r++)this["skill"+r].setData(n[r],!0),this["skill"+r].monitorCD=!1;UIDmgr.bindingUID(this.skill1,uid.skill1),this.visible=!0;egret.MainContext.instance.stage.stageWidth>750?(egret.MainContext.instance.stage.stageWidth-750)/2:0,egret.MainContext.instance.stage.stageHeight>1334?egret.MainContext.instance.stage.stageHeight-1334:0;switch(this.dx){case 0:case 1:case 2:case 3:case 4:case 5:break;case 6:}},e}(BaseEuiView);__reflect(SelectSkillPanel.prototype,"SelectSkillPanel");var SkillCompeonent=function(t){function e(){var e=t.call(this)||this;e.radiu=51,e.isMaxSkill=!1,e.openCD=!1,e.skinName="SkillCompeonentSkin";var i=e._shape=new egret.Shape;return e.addChildAt(i,3),e.myTime=new egret.Timer(200),e.myTime.addEventListener(egret.TimerEvent.TIMER,e.downCD,e),e}return __extends(e,t),e.prototype.changeGraphics=function(t){var e=this._shape;e.graphics.clear(),e.graphics.beginFill(0,.5),e.graphics.moveTo(0,0),e.graphics.lineTo(this.radiu,0),e.graphics.drawArc(0,0,this.radiu,0,t*Math.PI/180,!0),e.graphics.lineTo(0,0),e.graphics.endFill()},e.prototype.setData=function(t){this.vo=t,0!=t.level&&t?(this.suo.visible=!1,this.icon.source=ResMgr.skillIcon(t.stdSkill.skillIcon),this.openCD?(this.isMaxSkill=SkillMgr.ins.isMaxSkill(this.vo),this.isMaxSkill?this.sname.text=t.stdSkill.name:this.sname.text=t.stdSkill.name,this.vo.canUse||this.UpCd(null)):(this.sname.text="",this.suo.visible=0==t.level,this.suo.visible)):(this.suo.visible=!0,this.icon.source=t?this.openCD?null:ResMgr.skillIcon(t.stdSkill.skillIcon):null,this.sname.text="",t&&(this.isMaxSkill=SkillMgr.ins.isMaxSkill(this.vo))),this.w1.source=this.isMaxSkill?"ww1":"ww2",this.isMaxSkill?(this.icon.scaleX=this.icon.scaleY=1.2,this.icon.verticalCenter=-5,this.icon.horizontalCenter=-1,this._shape.x=87,this._shape.y=65):(this._shape.x=56,this._shape.y=58)},e.prototype.UpCd=function(t){t&&t.data!=this.vo||(this.isMaxSkill?this.radiu=54:this.radiu=44.5,this.myTime.stop(),this.downCD(),this.myTime.reset(),this.myTime.start())},e.prototype.downCD=function(){if(this.vo)if(this.vo.canUse)this.changeGraphics(0),this._shape.mask=null,this.cd.text="",this.myTime.stop();else{var t=this.vo._currentCD-GameLogic.ins.gameRunTick;this.cd.text=Math.floor(t/100)+"",this.changeGraphics((this.vo.stdSkill.CD-t)/this.vo.stdSkill.CD*360)}},Object.defineProperty(e.prototype,"data",{get:function(){return this.vo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canClick",{get:function(){return this.vo?0!=this.vo.level:!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"monitorCD",{set:function(t){this.openCD=t,t?DataEventDispatcher.dispatcher.addEventListener(SkillVo.SKILL_DOWN_CD,this.UpCd,this):DataEventDispatcher.dispatcher.removeEventListener(SkillVo.SKILL_DOWN_CD,this.UpCd,this)},enumerable:!0,configurable:!0}),e}(eui.Component);__reflect(SkillCompeonent.prototype,"SkillCompeonent");var TopPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.nn.text=UserVo.ins.playerName,this.m2.moneyType=MoneyUtils.M_2,this.m3.moneyType=MoneyUtils.M_3,this.addTouchEvent(this.m3.addGBtn,function(){ViewManager.ins().open(RechargeWin)})},e}(BaseView);__reflect(TopPanel.prototype,"TopPanel");var UIView=function(t){function e(){var e=t.call(this)||this;return e.skinName="UIViewSkin",e.touchEnabled=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.navBtn=[this.roleBtn,this.bagBtn,this.riskBtn,this.skillBtn,this.achieveBtn],this.viewAr=[PlayerWin,BagWin,null,SkillWin,AchievementWin];for(var i=0;i<this.navBtn.length;i++)this.addTouchEvent(this.navBtn[i],this.onClick);this.addTouchEvent(this.arenaBtn,this.onOpenBtn),this.addTouchEvent(this.copyBtn,this.onOpenBtn),this.addTouchEvent(this.mailBtn,this.onOpenBtn),this.addTouchEvent(this.rankBtn,this.onOpenBtn),this.addTouchEvent(this.taskBtn,this.onOpenBtn),this.addTouchEvent(this.shopBtn,this.onOpenBtn),this.addTouchEvent(this.noticeBtn,this.onOpenBtn),this.addTouchEvent(this.newsBtn,this.onOpenBtn),DataEventDispatcher.dispatcher.addEventListener(BaseMap.LOAD_MAP_COMPLETE,this.updateRoleData,this),this.updateRoleData(),UIDmgr.bindingUID(this.roleBtn,uid.roleBtn),UIDmgr.bindingUID(this.bagBtn,uid.bag),UIDmgr.bindingUID(this.taskBtn,uid.rw0),UIDmgr.bindingUID(this.copyBtn,uid.fb0),UIDmgr.bindingUID(this.skillBtn,uid.jn0),UIDmgr.bindingUID(this.arenaBtn,uid.p0),UIDmgr.bindingUID(this.achieveBtn,uid.cj0),UIDmgr.bindingUID(this.riskBtn,uid.back1),this.addEvent(GameEvent.RED_MAIN_TASK,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_DAY_TASK,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_ACHEIEVEMENT,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_SKILL,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_ARTIFACE,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_STRENG,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_EQUIP_LVL,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_GEM_LVL,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_EMAIL,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_BAG_RED,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.STUDY_SKILL,DataEventDispatcher.dispatcher,this.upRed),this.upRed(null),t[0]&&ViewManager.ins().open(t[0],t[1])},e.prototype.upRed=function(t){ViewManager.redToTarge(this.achieveBtn,1==RemindMgr.taskGetSatus[3]),ViewManager.redToTarge(this.taskBtn,1==RemindMgr.taskGetSatus[1]||1==RemindMgr.taskGetSatus[2]),ViewManager.redToTarge(this.skillBtn,RemindMgr.CAN_UP_SKILL.length>0||SkillMgr.NEW_STUDY.length>0),ViewManager.redToTarge(this.roleBtn,-1!=RemindMgr.artifactTips.indexOf(1)||-1!=RemindMgr.artifactTips.indexOf(2)||RemindMgr.StrengEquips.length>0||RemindMgr.upEquipsLvl.length>0||RemindMgr.GEM),ViewManager.redToTarge(this.mailBtn,RemindMgr.HAVE_READ_EMAIL),ViewManager.redToTarge(this.bagBtn,RemindMgr.hasOtherItem)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];DataEventDispatcher.dispatcher.removeEventListener(BaseMap.LOAD_MAP_COMPLETE,this.updateRoleData,this)},e.prototype.updateRoleData=function(){ConfigMgr.gameConfig.pointInfo[UserVo.ins.points+""]},e.prototype.onClick=function(t){var e=t.currentTarget;e==this.riskBtn?(ViewManager.ins().closeTopLevel(),ViewManager.ins().close(this)):this.selectView(e),UIDmgr.bindingUID(this.riskBtn,uid.back1)},e.prototype.onOpenBtn=function(t){switch(t.currentTarget){case this.arenaBtn:ViewManager.ins().open(PVPWin);break;case this.copyBtn:ViewManager.ins().open(PVEWin);break;case this.shopBtn:ViewManager.ins().open(ShopWin);break;case this.rankBtn:ViewManager.ins().open(RankWin);break;case this.taskBtn:ViewManager.ins().open(TaskWin);break;case this.mailBtn:ViewManager.ins().open(EmailView);break;case this.noticeBtn:ViewManager.ins().open(NoticeView);break;case this.newsBtn:ViewManager.ins().open(MessageView);break;default:UserTips.ins().showTipsBigToSmall("敬请期待")}},e.prototype.selectView=function(t){var e=this.navBtn.indexOf(t),i=this.viewAr[e]?ViewManager.ins().open(this.viewAr[e]):null;return i?!0:!1},e}(BaseEuiView);__reflect(UIView.prototype,"UIView"),ViewManager.ins().reg(UIView,LayerManager.UI_Main);var VipIcon=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.vipLevel,this.upVip,this),this.upVip()},e.prototype.upVip=function(){this.vip.text=""+UserVo.ins.vipLevel},e}(eui.Component);__reflect(VipIcon.prototype,"VipIcon");var OfflineWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="offlineSkin",e}return __extends(e,t),e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this);var n=e[0];this.l0.text="离线时间:"+DateTimeUtils.toTimeString(n.offlineTime),this.l1.text=""+CommonUtils.overLength(n.gold),this.l2.text=""+CommonUtils.overLength(n.exp),this.b0.visible=0==n.amplitude,this.l4.text=""+CommonUtils.overLength(n.gold*n.amplitude/100),this.l5.text=""+CommonUtils.overLength(n.exp*n.amplitude/100),this.addTouchEvent(this.b0,this.onTap),this.addTouchEvent(this.b1,this.onTap),this.addEvent(egret.Event.ADDED_TO_STAGE,this,this.addStage)},e.prototype.addStage=function(){this.addTouchEvent(this.stage,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.b0:ViewManager.ins().open(MonthCard)}ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(OfflineWin.prototype,"OfflineWin"),ViewManager.ins().reg(OfflineWin,LayerManager.UI_Tips);var PlayerEquipItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="PlayerEquipItemSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.dataChanged=function(){if(this.clears(),this.data&&0!=this.data.itemId){var t=this.data.itemId;this.itemConfing=BagVo.ins().getItem(t),this.item.data=this.data}},e.prototype.clears=function(){this.item.data=null},e}(BaseItemRender);__reflect(PlayerEquipItem.prototype,"PlayerEquipItem");var PlayerEquipReplaceView=function(t){function e(){var e=t.call(this)||this;return e.skinName="PlayerEquipReplaceSkin",e.unloadBtn=e.c.repBtn,e.unloadBtn.skinName="Btn001Skin",e.c.repBtn.label="卸下",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.itemList.itemRenderer=ReplaceItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curInfo=t[0],this.selectPos=0|t[1],this.addTouchEvent(this.unloadBtn,this.onTap),this.update(),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UPDATE_BAG_DATA,this.update,this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];DataEventDispatcher.dispatcher.addEventListener(GameEvent.UPDATE_BAG_DATA,this.update,this)},e.prototype.update=function(){this.c.data=this.curInfo=UserVo.ins.Columns[this.selectPos].itemInfo;var t=BagVo.ins().getPosEquipList(this.selectPos);this.itemList.dataProvider=new eui.ArrayCollection(t)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.unloadBtn:HttpMgr.ins.sendMessage(ClientPacket.S_10031,{loc:this.selectPos},ServerPacket.LOGIC_URL,!0),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(PlayerEquipReplaceView.prototype,"PlayerEquipReplaceView"),ViewManager.ins().reg(PlayerEquipReplaceView,LayerManager.UI_Popup);var PlayerTypesView=function(t){function e(){var e=t.call(this)||this;return e.skinName="PlayerTypesSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.itemInfo=t[0],this.update()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.update=function(){var t=UserVo.ins.playerAttrInfo,e=0,i="",n="",r=["hitRate","dodgeRate","attackRange","skillsConsumption","speedAnger"];for(var s in t)"__class__"!=s&&"__types__"!=s&&ConfigMgr.gameConfig.attributeName[s]&&-1==r.indexOf(s)&&(e%2==0?(i+=ConfigMgr.gameConfig.attributeName[s].value+":"+Math.floor(t[s])+PbPlayerAttrInfo.isPercent(s),i+="\n"):(n+=ConfigMgr.gameConfig.attributeName[s].value+":"+Math.floor(t[s])+PbPlayerAttrInfo.isPercent(s),n+="\n"),e++);this.l0.textFlow=(new egret.HtmlTextParser).parser(i),this.l1.textFlow=(new egret.HtmlTextParser).parser(n)},e}(BaseEuiView);__reflect(PlayerTypesView.prototype,"PlayerTypesView"),ViewManager.ins().reg(PlayerTypesView,LayerManager.UI_Popup);var PlayerWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="PlayerSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.dg.itemRenderer=PropertyRender,this.role.source="h_"+UserVo.ins.sex+"_png"},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this.update();for(var n=0;n<UserVo.ins.Columns.length;n++)this.addTouchEvent(this["equip"+n],this.onEquip),this["equip"+n].name=n+"";this.addTouchEvent(this.labTypes,this.onTap),this.addTouchEvent(this.btnGem,this.onTap),this.addTouchEvent(this.btnForge,this.onTap),this.addTouchEvent(this.btnArtifact,this.onTap),this.addEvent(GameEvent.UPDATE_PLAYER_WIN,DataEventDispatcher.dispatcher,this.update),this.addEvent(GameEvent.UPDATE_BAG_DATA,DataEventDispatcher.dispatcher,this.update),this.addEvent(GameEvent.UP_STRENGTH,DataEventDispatcher.dispatcher,this.update),this.addEvent(GameEvent.UP_ADVANCE,DataEventDispatcher.dispatcher,this.update),this.addEvent(GameEvent.UPDATE_ARTIFACT_WIN,DataEventDispatcher.dispatcher,this.update),this.addEvent(GameEvent.UPDATE_GEM_DATA,DataEventDispatcher.dispatcher,this.update),this.addEvent(GameEvent.UP_PLAYER_PROPERTY+propertyType.level,DataEventDispatcher.dispatcher,this.update),this.addEvent(GameEvent.UP_PLAYER_PROPERTY+propertyType.fightPower,DataEventDispatcher.dispatcher,this.upPower),UIDmgr.bindingUID(this.btnForge,uid.forgeBtn0),UIDmgr.bindingUID(this.btnArtifact,uid.af0),UIDmgr.bindingUID(this.btnGem,uid.bs0),this.upPower(),this.addEvent(GameEvent.RED_ARTIFACE,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_STRENG,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_EQUIP_LVL,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_GEM_LVL,DataEventDispatcher.dispatcher,this.upRed),this.addEvent(GameEvent.RED_GEM_LVL,DataEventDispatcher.dispatcher,this.upRed),this.upRed(null)},e.prototype.upPower=function(){this.f.text=UserVo.ins.fightPower+""},e.prototype.upRed=function(t){t&&t.type!=GameEvent.RED_ARTIFACE||ViewManager.redToTarge(this.btnArtifact,-1!=RemindMgr.artifactTips.indexOf(1)||-1!=RemindMgr.artifactTips.indexOf(2)),(!t||t.type==GameEvent.RED_STRENG||GameEvent.RED_EQUIP_LVL)&&ViewManager.redToTarge(this.btnForge,RemindMgr.StrengEquips.length>0||RemindMgr.upEquipsLvl.length>0),t&&t.type!=GameEvent.RED_GEM_LVL||ViewManager.redToTarge(this.btnGem,RemindMgr.GEM)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];DataEventDispatcher.dispatcher.removeEventListener(GameEvent.UPDATE_PLAYER_WIN,this.update,this),DataEventDispatcher.dispatcher.removeEventListener(GameEvent.UPDATE_BAG_DATA,this.update,this),DataEventDispatcher.dispatcher.removeEventListener(GameEvent.UP_STRENGTH,this.update,this),DataEventDispatcher.dispatcher.removeEventListener(GameEvent.UP_ADVANCE,this.update,this),DataEventDispatcher.dispatcher.removeEventListener(GameEvent.UPDATE_ARTIFACT_WIN,this.update,this),DataEventDispatcher.dispatcher.removeEventListener(GameEvent.UPDATE_GEM_DATA,this.update,this),DataEventDispatcher.dispatcher.removeEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.level,this.update,this)},e.prototype.update=function(){if(UserVo.ins.Columns){for(var t=0;t<UserVo.ins.Columns.length;t++){var i=UserVo.ins.Columns[t].itemInfo;this["equip"+t].data=i?i:null}for(var n=[],r=0;12>r;r++)e.HERO_TYPE[r]&&n.push([ConfigMgr.gameConfig.attributeName[e.HERO_TYPE[r]].value,Math.floor(UserVo.ins.playerAttrInfo[e.HERO_TYPE[r]])]);this.dg.dataProvider=new eui.ArrayCollection(n)}},e.prototype.onTap=function(t){ViewManager.ins().getView(UIView);switch(t.currentTarget){case this.labTypes:ViewManager.ins().open(PlayerTypesView);break;case this.btnForge:ViewManager.ins().open(ForgeWin);break;case this.btnGem:ViewManager.ins().open(GemWin);break;case this.btnArtifact:ViewManager.ins().open(ArtifactWin)}},e.prototype.onEquip=function(t){var e=t.currentTarget,i=parseInt(e.name);ViewManager.ins().open(PlayerEquipReplaceView,e.data,i)},e.HERO_TYPE=["attackInit","armorInit","magicAttack","magicArmorInit","critRate","critDamage","blood"],e}(BaseEuiView);__reflect(PlayerWin.prototype,"PlayerWin"),ViewManager.ins().reg(PlayerWin,LayerManager.UI_MainUI);var PropertyRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="PropertySkin",e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.pn.text=this.data[0],this.pv.text=this.data[1]},e}(eui.ItemRenderer);__reflect(PropertyRender.prototype,"PropertyRender");var ReplaceItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="ReplaceItemSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.euiCompete=function(){this.dataChanged(),this.addTouchEvent(this.repBtn,this.onTap)},e.prototype.dataChanged=function(){if(!this.data)return this.itemIcon.data=null,void(this.g0.visible=!1);this.g0.visible=!0,this.itemIcon.data=this.data;var t=ConfigMgr.gameConfig.equip[this.data.itemId];this.eFighting.text=t.initialScore;for(var e=["power","intellect","alacrity","physique","attackInit","armorInit","magicAttack","magicArmorInit","critRate","critDamage","blood","attackSpeed","attackRange","movingSpeed"],i=0,n=0;4>n;n++)for(this["labType"+n].text="",i;i<e.length;i++)if(t[e[i]]>0){this["labType"+n].text=ConfigMgr.gameConfig.attributeName[e[i]].value+":"+t[e[i]],i++;break}},e.prototype.onTap=function(t){HttpMgr.ins.sendMessage(ClientPacket.S_10008,{uuid:this.data.uuid},ServerPacket.LOGIC_URL,!0)},e}(BaseItemRender);__reflect(ReplaceItemRender.prototype,"ReplaceItemRender");var FightResultWin=function(t){function e(){var e=t.call(this)||this;return e.horizontalCenter=e.verticalCenter=0,e.skinName="FightResultSkin",e.touchChildren=!1,e.items.itemRenderer=BaseItem,e}return __extends(e,t),e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];if(t.prototype.open.call(this,e),this.addTouchEvent(this,this.onClose),SystemInstance.addTimeHandle(this.onClose,2e3,this),this.re.source=0==e[0]||2==e[0]?"组-44_png":"组-4_png",this.call=e[1],e[0]<2)this.i0.source=0==e[0]?"result12":"result11",this.s6.visible=!1,this.s5.visible=!0,0==e[0]?(this.ww.text="很遗憾!",this.ww0.textFlow=ColorUtlis.COLOR_STR("当前排名下降至:XXX",!1)):(this.ww.text="恭喜您!",this.ww0.textFlow=ColorUtlis.COLOR_STR("当前排名上升至:XXX",!0));else if(this.s6.visible=!0,this.s5.visible=!1,3==e[0]){this.ww1.textFlow=ColorUtlis.COLOR_STR("恭喜您获得如下奖励:",!0);var n=[],r=e[2];if(r&&""!=r)for(var s,a,o=r.split("#"),h=0;h<o.length;h++){a=new ItemInfo,a.showEquipsCount=!0,s=o[h].split(":"),a.itemId=parseInt(s[0]),a.itemNum=s[1]?parseInt(s[1]):1;BagVo.ins().getItem(a.itemId);n.push(a)}if(e[3])for(h=0;h<e[3].length;h++)a=new ItemInfo,a.moneyType=e[3][h].key,a.itemNum=e[3][h].val,n.push(a);this.items.dataProvider=new eui.ArrayCollection(n),this.items.visible=!0}else this.items.dataProvider=new eui.ArrayCollection([]),this.items.visible=!1,this.ww1.textFlow=ColorUtlis.COLOR_STR("革命尚未成功,同志仍需努力!",!1)},e.prototype.onClose=function(){this.call&&this.call(),SystemInstance.removeTimeHandle(this.onClose),ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(FightResultWin.prototype,"FightResultWin"),ViewManager.ins().reg(FightResultWin,LayerManager.UI_Popup);var PVERender=function(t){function e(){var e=t.call(this)||this;return e.skinName="PVERenderSkinII",e.touchChildren=!1,e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,function(){e.data&&(0==e.itemIndex?UIDmgr.bindingUID(e,uid.fb1):1==e.itemIndex?UIDmgr.bindingUID(e,uid.fb11):UIDmgr.bindingUID(e,uid.fb111))},e),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.partChallengNumInfos,e.upCount,e),e}return __extends(e,t),e.prototype.dataChanged=function(){this.l0.text=this.data.sectionName.replace("☆",""),this.l1.text="",this.l2.text="进入条件需要战力:"+this.data.entryConditions;var t=1==this.data.partType?"<font color='#fffab3'>升阶石":2==this.data.partType?"<font color='#23b62e'>宝石":"<font color='#f69c00'>技能玉";this.l4.textFlow=(new egret.HtmlTextParser).parser("挑战可获得:"+t),this.upCount(),this.bg.source="fb"+(4+this.itemIndex)+"_png"},e.prototype.upCount=function(){this.l3.text="剩余挑战次数:"+FBMgr.ins.getCountByType(this.data.partID)},e.prototype.onTap=function(){0==this.itemIndex?ViewManager.ins().open(PVEWinII,FBMgr.ins.fbData[this.itemIndex]):SystemOpenMgr.checkOpen(null,!0,this.itemIndex+1)&&ViewManager.ins().open(PVEWinII,FBMgr.ins.fbData[this.itemIndex])},e}(eui.ItemRenderer);__reflect(PVERender.prototype,"PVERender");var PVERenderII=function(t){function e(){var e=t.call(this)||this;return e.skinName="PVERenderSkinII",e.touchChildren=!1,e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,function(){e.data&&0==e.itemIndex&&UIDmgr.bindingUID(e,uid.fb2)},e),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.partChallengNumInfos,e.upCount,e),e}return __extends(e,t),e.prototype.dataChanged=function(){this.l0.text=this.data.sectionName,this.l2.text="进入条件需要战力:"+this.data.entryConditions;var t=1==this.data.partType?"<font color='#fffab3'>升阶石":2==this.data.partType?"<font color='#23b62e'>宝石":"<font color='#f69c00'>技能玉";this.l4.textFlow=(new egret.HtmlTextParser).parser("挑战可获得: "+t),this.upCount(),this.bg.source="fb"+(3+this.data.partType)+"_png"},e.prototype.upCount=function(){this.l3.text="剩余挑战次数:"+FBMgr.ins.getCountByType(this.data.partID)},e.prototype.onTap=function(){return this.data?(ViewManager.ins().close(SkillWin),ViewManager.ins().close(PVEWin),ViewManager.ins().close(PVEWinII),GameMap.ins().onHookMap?0==FBMgr.ins.getCountByType(this.data.partID)?UserTips.ins().showTipsBigToSmall("次数不足,无法挑战!"):void HttpMgr.ins.sendMessage(ClientPacket.S_10028,{partId:this.data.partID},ServerPacket.LOGIC_URL,!0):UserTips.ins().showTipsBigToSmall("非挂机地图,无法挑战!")):void 0},e}(eui.ItemRenderer);__reflect(PVERenderII.prototype,"PVERenderII");var ItemIcon=function(t){function e(){var e=t.call(this)||this;return e.skinName="ItemIconSkin",e}return __extends(e,t),e.prototype.euiCompete=function(){},e.prototype.dataChanged=function(){if(this.data){var t=0;if(isNaN(this.data))t=this.data.itemId;else{var e=new ItemInfo;e.itemId=this.data,e.itemNum=0,t=e.itemId}0!=t&&(this.itemConfing=BagVo.ins().getItem(t),this.setQuality(this.itemConfing.rank),this.setIcon(ResMgr.getGameItemPng(this.itemConfing.iconID)))}},e.prototype.setData=function(t){},e.prototype.setIcon=function(t){this.iconStr=t,this.imgIcon.source=t},e.prototype.setQuality=function(t){this.imgBg.source=0==t?null:-1==t?"quality_10":"quality_1"+t,t>=3?(this.mc||(this.mc=new clips.BmpClip),ModelResMgr.getOtherEffect(10007+t,this.mc),this.eff.addChild(this.mc),this.mc.play(-1)):this.mc&&(this.mc.stop(),this.mc.parent&&this.mc.parent.removeChild(this.mc))},Object.defineProperty(e.prototype,"tips",{get:function(){return this._tips},set:function(t){this._tips=t,t?this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tipsShow,this):this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.tipsShow,this)},enumerable:!0,configurable:!0}),e.prototype.tipsShow=function(){ViewManager.ins().open(ItemTipView,this.itemConfing)},e}(BaseItemRender);__reflect(ItemIcon.prototype,"ItemIcon");var PVEWinII=function(t){function e(){var e=t.call(this)||this;return e.skinName="PVEIISkin",e}return __extends(e,t),e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this.ls.dataProvider=new eui.ArrayCollection(e[0])},e.prototype.closeCall=function(){t.prototype.closeCall.call(this),ViewManager.ins().open(PVEWin)},e}(BaseEuiView);__reflect(PVEWinII.prototype,"PVEWinII"),ViewManager.ins().reg(PVEWinII,LayerManager.UI_MainUI);var PVPRender=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(!e.vo)return UserTips.ins().showTipsBigToSmall("无数据信息,无法挑战!");if(!GameMap.ins().onHookMap)return UserTips.ins().showTipsBigToSmall("非挂机地图,无法挑战!");if(0!=UserVo.ins.challengeNum)ViewManager.ins().close(UIView),ViewManager.ins().close(PVPWin),HttpMgr.ins.sendMessage(ClientPacket.S_10022,{otherPlayerId:e.vo.otherPlayerId},ServerPacket.LOGIC_URL,!0);else{var t=PVPMgr.ins().buyCount;ViewManager.ins().open(TipsWin,"确定","是否花费"+t[0]+"购买挑战一次数!","提示","取消",function(){t[1]?HttpMgr.ins.sendMessage(ClientPacket.S_10021,{otherPlayerId:e.vo.otherPlayerId},ServerPacket.LOGIC_URL,!0):UserTips.ins().showTipsBigToSmall(MoneyUtils.getMoneyName(MoneyUtils.M_3)+"不足,无法购买!")},null,e)}},e),e}return __extends(e,t),Object.defineProperty(e.prototype,"data",{set:function(t){this.vo=t,t?(this.rname.text=t.otherPlayerName,this.power.text="战斗力"+t.otherFightPower,this.rank.text="第"+t.otherRankings+"名",this.role.source="h_"+t.sex+"_png",this.icon.source=t.otherRankings<4?"pvp0"+(4+t.otherRankings):null,this.eff.source=t.otherRankings<4?"pvp"+(9+t.otherRankings):null):(this.rname.text=this.power.text=this.rank.text="",this.eff.source=this.icon.source=this.role.source=null,this.role.source=null)},enumerable:!0,configurable:!0}),e}(eui.Component);__reflect(PVPRender.prototype,"PVPRender");var RankRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="RankRenderSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.l0.text=this.itemIndex+1+"",this.l1.text=this.data.otherPlayerName,this.l2.text=this.data.otherPlayerLevel+"",this.l3.text=this.data.otherFightPower+"",this.tt.source=this.itemIndex%2==0?"rankI":null},e}(eui.ItemRenderer);__reflect(RankRender.prototype,"RankRender");var RankWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="RankSkin",e.dg.itemRenderer=RankRender,e.cpArr=[ClientPacket.S_10025,ClientPacket.S_30001,ClientPacket.S_30002,ClientPacket.S_10024],e.spArr=[ServerPacket.C_20025,ServerPacket.C_40001,ServerPacket.C_40002,ServerPacket.C_20024],e.lbs=[["排名","名字","等级","战力"],["排名","名字","等级","重生"],["排名","名字","vip","战力"],["排名","名字","等级","战力"]],e}return __extends(e,t),e.prototype.euiCompete=function(){var e=this;t.prototype.euiCompete.call(this);for(var i=0;4>i;i++)this["btn"+i].name=i+"",this["btn"+i].addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){e.currBtn&&(e.currBtn.selected=!1),HttpMgr.ins.sendMessage(e.cpArr[parseInt(t.currentTarget.name)],{},ServerPacket.LOGIC_URL,!0),e.currBtn=t.currentTarget,e.currBtn.selected=!0;for(var i=e.lbs[parseInt(t.currentTarget.name)],n=0;4>n;n++)e["l"+n].text=i[n]},this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this);for(var n=0;n<this.spArr.length;n++)this.addEvent(this.spArr[n],DataEventDispatcher.dispatcher,this.upData);var r=this.currBtn?this.currBtn:this.btn0;r.dispatchEventWith(egret.TouchEvent.TOUCH_TAP)},e.prototype.upData=function(t){this.spArr.indexOf(t.type)+""==this.currBtn.name&&(this.dg.dataProvider=new eui.ArrayCollection(t.data.rankingsInfos),this.r0.text="我的排名:"+(-1==t.data.rankings?"未上榜":t.data.rankings))},e}(BaseEuiView);__reflect(RankWin.prototype,"RankWin"),ViewManager.ins().reg(RankWin,LayerManager.UI_MainUI);var RechargeItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="RechargeItemSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.addTouchEvent(this.buyBtn,this.onTap)},e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.euiCompete=function(){this.dataChanged()},e.prototype.dataChanged=function(){if(this.clears(),this.data){var t=this.data.gold.split("#"),e=this.data.payAward.split("#"),i=e[1]?t[1]+"钻石":"月卡充值";this.title.text=i,this.labName.text="月卡充值"==this.data.payDesc?"":"首次"+this.data.payDesc,this.labName.visible=!UserVo.ins.isRecharge;this.data.gold;this.labNum.text=this.data.price+"元",this.price=this.data.price,this.mallId=this.data.id,this.validateNow()}},e.prototype.onTap=function(){if(100==this.data.id){var t=UserVo.ins.monthCardInfo;if(t&&t.cardEndDay)return void ViewManager.ins().open(TipsWin,"确定","月卡已经购买，不能重复购买","提示","",function(){},null,this)}0==ParamMgr.SPID?(RechargeVo.ins().sendRechargeOrderRequest(this.mallId),UserVo.ins.isRecharge=!0):MoneyUtils.recharge(this.data),this.validateNow()},e.prototype.ReturnSignData=function(t){var e="";return t.forEach(function(t){var i=t.split("=");e+=i[1]}),MoneyUtils.MD5(e)},e.prototype.clears=function(){this.labNum.text=""},e}(BaseItemRender);__reflect(RechargeItem.prototype,"RechargeItem");var RechargeWin=function(t){function e(){var e=t.call(this)||this;return e.RENDER_H=210,e.RENDER_W=340,e.skinName="RechargeSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this),this.update(),this.reItemGroup.itemRenderer=RechargeItem;var n=ConfigMgr.gameConfig.paymentBase;this.reItemGroup.dataProvider=new eui.ArrayCollection(n)},e.prototype.update=function(){},e}(BaseEuiView);__reflect(RechargeWin.prototype,"RechargeWin"),ViewManager.ins().reg(RechargeWin,LayerManager.UI_MainUI);var ShopBuyTips=function(t){function e(){var e=t.call(this)||this;return e.count=1,e.skinName="suerBuyTipSkin",e.left=e.right=e.top=e.bottom=0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.data=t[0],this.lbNum.restrict="0-9",this.count=1,this.lbNum.text="1",this.goldImg.source=this.data.consume,this.setBuyData(),this.addTouchEvent(this.sureBtn,this.onTap),this.addTouchEvent(this.samllBtn,this.onTap),this.addTouchEvent(this.maxBtn,this.onTap),this.addChangeEvent(this.lbNum,this.changeInput)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.sureBtn:this.onBuyItem();break;case this.samllBtn:this.count-=1,this.setBuyData();break;case this.maxBtn:this.count+=1,this.setBuyData()}},e.prototype.changeInput=function(){this.count=parseInt(this.lbNum.text),this.setBuyData()},e.prototype.setBuyData=function(){this.count<=0?this.count=1:this.count>999&&(this.count=999),this.data.limitPlayerDayNum>0&&this.count>ShopVo.ins().getShopBuyNum(this.data.seqId)&&(this.count=ShopVo.ins().getShopBuyNum(this.data.seqId)),this.lbNum.text=this.count+"",this.lbMoney.text=this.count*this.data.consumeNum+""},e.prototype.onBuyItem=function(){if(0==ShopVo.ins().getShopBuyNum(this.data.seqId))return void UserTips.ins().showTipsBigToSmall("购买次数不足");var t=ShopVo.ins().getStoreItem(this.data.seqId);return t.consumeNum*this.count>MoneyUtils.getMoneyNum(t.consume)?UserTips.ins().showTipsBigToSmall("货币不足,无法购买!"):void ShopVo.ins().sendBuyGoodsRequest(this.data.seqId,this.count)},e}(BaseEuiView);__reflect(ShopBuyTips.prototype,"ShopBuyTips"),ViewManager.ins().reg(ShopBuyTips,LayerManager.UI_Tips);var ShopItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="shopItemSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.addTouchEvent(this.buyBtn,this.onTap)},e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.euiCompete=function(){this.dataChanged(),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_SHOP_BUY,this.upCount,this),this.item.tips=!0},e.prototype.dataChanged=function(){this.clears(),this.data&&0!=this.data.goods&&(this.labName.visible=!0,this.item.data=this.data.goods,this.itemConfig=ConfigMgr.gameConfig.item[this.data.goods],this.labName.text=this.itemConfig.name,this.labName.textColor=ColorUtlis.QUALITY_COLOR[this.itemConfig.rank],this.lbMoney.data=[this.data.consume,this.data.consumeNum],this.validateNow(),this.upCount())},e.prototype.upCount=function(){var t=ShopVo.ins().getShopBuyNum(this.data.seqId);-1==t?this.c.text="":this.c.text="剩余购买次数:"+t},e.prototype.onTap=function(){this.data&&ViewManager.ins().open(ShopBuyTips,this.data)
},e.prototype.clears=function(){this.labName.text=""},e}(BaseItemRender);__reflect(ShopItemRender.prototype,"ShopItemRender");var ToggleBtn01=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"s0",{get:function(){return this._s0},set:function(t){this._s0=t,this.n0&&(this.n0.source=this.s0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"s1",{get:function(){return this._s1},set:function(t){this._s1=t,this.n1&&(this.n1.source=this.s1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"c0",{get:function(){return this._c0},set:function(t){this._c0=t,this.a0&&(this.a0.source=this.c0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"c1",{get:function(){return this._c1},set:function(t){this._c1=t,this.a1&&(this.a1.source=this.c1)},enumerable:!0,configurable:!0}),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.n1&&(this.n1.source=this.s1),this.n0&&(this.n0.source=this.s0),this.a1&&this.c1&&(this.a1.source=this.c1),this.a0&&this.c0&&(this.a0.source=this.c0)},e}(eui.ToggleButton);__reflect(ToggleBtn01.prototype,"ToggleBtn01");var LookSkillPanel=function(t){function e(){var e=t.call(this)||this;return e.canUp=!1,e.skinName="lookSkillSkin",e.l.source=ResMgr.getGameItemPng(MoneyUtils.M_5),e.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return e.canUp?UserVo.ins.levelLimit(e.skillVo.stdSkill.need_role_lzs,e.skillVo.stdSkill.need_role_lvl)?void HttpMgr.ins.sendMessage(ClientPacket.S_10006,{skillTab:e.skillVo.stdSkill.tab},ServerPacket.LOGIC_URL):UserTips.ins().showTipsBigToSmall("重生等级或者等级不足 "+e.skillVo.stdSkill.need_role_lvl+",无法升级!"):UserTips.ins().showTipsBigToSmall("材料不足,无法升级!")},e),DataEventDispatcher.dispatcher.addEventListener(GameEvent.SKILL_UP_LVL,e.updata,e),DataEventDispatcher.dispatcher.addEventListener(GameEvent.STUDY_SKILL,e.updata,e),DataEventDispatcher.dispatcher.addEventListener(GameEvent.MONEY_TYPE_CHANGE,e.updata,e),e.btn0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return"装 配 中"==e.btn0.label?UserTips.ins().showTipsBigToSmall("该技能已装配至战斗页对应的技能栏中!"):(UserVo.ins.skillColumn[e.skillDx]=e.skillVo.stdSkill.tab,DataEventDispatcher.dispatchEventWith(GameEvent.SELECT_SKILL,{a:e.skillDx,b:e.skillVo}),void(e.btn0.label="装 配 中"))},e),e}return __extends(e,t),e.prototype.upStatus=function(){this.btn0.label=-1!=UserVo.ins.skillColumn.indexOf(this.skillVo.stdSkill.tab)?"装 配 中":"装 配"},e.prototype.setData=function(t,e,i){this.skillDx=i,this.jt.x=190+120*e,this.skillVo=t,this.updata(),this.upStatus(),UIDmgr.bindingUID(this.btn,uid.jn2);SkillMgr.ins.skillGroup[UserVo.ins.jobId];UIDmgr.bindingUID(this.btn0,uid.jn3)},e.prototype.updata=function(){if(this.skillVo){this.des.text=this.skillVo.stdSkill.description;var t=MoneyUtils.getMoneyNum(MoneyUtils.M_5);this.l6.text=t+"/"+this.skillVo.stdSkill.upgrade_money,this.canUp=t>=this.skillVo.stdSkill.upgrade_money,this.g1.setSkillData(this.skillVo.stdSkill);var e=ConfigMgr.gameConfig.skill[SkillMgr.autoFillTab(this.skillVo.stdSkill.secondarySkill_id,this.skillVo.level+1)];e?(this.g0.setSkillData(e,1),this.g2.visible=this.g0.visible=!0,this.l7.visible=!1):(this.g2.visible=this.g0.visible=!1,this.l7.visible=!0)}},e}(eui.Component);__reflect(LookSkillPanel.prototype,"LookSkillPanel");var SkillIconItem=function(t){function e(){var e=t.call(this)||this;return e._lookSkill=!1,e.skinName="SkillItemSkin",e.n_icon=e.icon.imgIcon,e.touchChildren=!1,DataEventDispatcher.dispatcher.addEventListener(GameEvent.SKILL_UP_LVL,e.upSkillLvl,e),DataEventDispatcher.dispatcher.addEventListener(GameEvent.STUDY_SKILL,e.upSkillLvl,e),DataEventDispatcher.dispatcher.addEventListener(GameEvent.RED_SKILL,function(){ViewManager.redToTarge(e,-1!=RemindMgr.CAN_UP_SKILL.indexOf(e.skillVo)||-1!=SkillMgr.NEW_STUDY.indexOf(e.skillVo))},e),DataEventDispatcher.dispatcher.addEventListener(GameEvent.SELECT_SKILL,e.useSkill,e),e}return __extends(e,t),Object.defineProperty(e.prototype,"lookSkill",{get:function(){return this._lookSkill},set:function(t){this._lookSkill=t},enumerable:!0,configurable:!0}),e.prototype.useSkill=function(){this.skillVo&&(this.l0.visible=-1!=UserVo.ins.skillColumn.indexOf(this.skillVo.stdSkill.tab))},e.prototype.dataChanged=function(){if(this.skillVo=SkillMgr.ins.getRoleSkill(this.data.secondarySkill_id),this.labName.text=this.data.description2,this.n_icon.source=ResMgr.skillIcon(this.data.skillIcon),this.upSkillLvl(),this.useSkill(),!this._lookSkill){var t=SkillMgr.ins.groupSkillId[0];(this.data.secondarySkill_id==t||this.data.secondarySkill_id==t+1)&&this.addEventListener(egret.Event.ADDED_TO_STAGE,this.checkGuide,this),this.checkGuide()}},e.prototype.checkGuide=function(){var t=SkillMgr.ins.groupSkillId[0];this.data.secondarySkill_id==t?UIDmgr.bindingUID(this,uid.jn1):UIDmgr.bindingUID(this,uid.jn4)},e.prototype.upSkillLvl=function(t){void 0===t&&(t=null),this.skillVo&&(this.labLv.text="LV."+this.skillVo.level,this.suo.visible=0==this.skillVo.level,t&&t.type!=GameEvent.STUDY_SKILL||ViewManager.redToTarge(this,-1!=SkillMgr.NEW_STUDY.indexOf(this.skillVo)||-1!=RemindMgr.CAN_UP_SKILL.indexOf(this.skillVo)))},e}(eui.ItemRenderer);__reflect(SkillIconItem.prototype,"SkillIconItem");var SkillIconItemII=function(t){function e(){var e=t.call(this)||this;return e.skinName="SkillItemSkin",e.n_icon=e.icon.imgIcon,e.suo.visible=!1,e.touchChildren=!1,DataEventDispatcher.dispatcher.addEventListener(GameEvent.SKILL_UP_LVL,e.upSkillLvl,e),DataEventDispatcher.dispatcher.addEventListener(GameEvent.STUDY_SKILL,e.upSkillLvl,e),e}return __extends(e,t),e.prototype.setSkillData=function(t,e){void 0===e&&(e=0),this.offLvl=e,this.skillVo=SkillMgr.ins.getRoleSkill(t.secondarySkill_id),this.labName.text=t.description2,this.n_icon.source=ResMgr.skillIcon(t.skillIcon),this.upSkillLvl()},e.prototype.upSkillLvl=function(t){void 0===t&&(t=null),this.skillVo&&(this.labLv.text="LV."+(this.skillVo.level+this.offLvl))},e}(eui.Component);__reflect(SkillIconItemII.prototype,"SkillIconItemII");var SkillLvlItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="SkillLvItemRender",e.skillList.itemRenderer=SkillIconItem,DataEventDispatcher.dispatcher.addEventListener(GameEvent.STUDY_SKILL,e.upStatus,e),e}return __extends(e,t),Object.defineProperty(e.prototype,"skillData",{set:function(t){this.$vo=t,this.n0.text=t[0].need_role_lvl+"级解锁!",this.labLv.text=t[0].need_role_lvl,this.skillList.dataProvider=new eui.ArrayCollection(t),this.l3.text=t[0].name,this.upStatus()},enumerable:!0,configurable:!0}),e.prototype.upStatus=function(){for(var t=!0,e=0;e<this.$vo.length;e++)if(SkillMgr.ins.getRoleSkill(this.$vo[e].secondarySkill_id).level>0){t=!1;break}this.g0.visible=t},e}(eui.Component);__reflect(SkillLvlItem.prototype,"SkillLvlItem");var SkillWin=function(t){function e(){var e=t.call(this)||this;return e.RENDER_H=180,e.skinName="SkillSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this);for(var n=0;n<this.itemGroup.numChildren-1;n++)this.itemGroup.getChildAt(n)!=this.lookPanel&&this.addTouchEvent(this.itemGroup.getChildAt(n),this.onClick);UIDmgr.bindingUID(this,uid.jnP1)},e.prototype.onClick=function(t){if(t.currentTarget instanceof SkillLvlItem){var e=parseInt(t.currentTarget.name);if(t.target instanceof SkillIconItem){if(0==t.target.skillVo.level)return void UserTips.ins().showTipsBigToSmall("当前技能还未开启!");this.lookPanel.setData(t.target.skillVo,t.target.itemIndex,e),this.lookPanel.visible=!0,this.lookPanel.y=(e+1)*this.RENDER_H-28;for(var i=0;i<this.itemGroup.numChildren-1;i++)e>=i?this.itemGroup.getChildAt(i).y=i*this.RENDER_H:this.itemGroup.getChildAt(i).y=this.lookPanel.y+this.lookPanel.height+10+(i-e-1)*this.RENDER_H;var e=SkillMgr.NEW_STUDY.indexOf(t.target.skillVo);-1!=e&&(SkillMgr.NEW_STUDY.splice(e,1),-1==RemindMgr.CAN_UP_SKILL.indexOf(t.target.skillVo)&&ViewManager.redToTarge(t.target,!1),DataEventDispatcher.dispatchEventWith(GameEvent.RED_SKILL))}}},e.prototype.euiCompete=function(){t.prototype.euiCompete.call(this);var e,i=SkillMgr.ins.skillGroup[UserVo.ins.jobId],n=0;this.lookPanel=new LookSkillPanel;for(var r in i)e=new SkillLvlItem,e.name=n+"",e.skillData=i[r],e.y=n*this.RENDER_H,this.itemGroup.addChild(e),n++;this.itemGroup.addChild(this.lookPanel),this.lookPanel.visible=!1},e}(BaseEuiView);__reflect(SkillWin.prototype,"SkillWin"),ViewManager.ins().reg(SkillWin,LayerManager.UI_MainUI);var SmeltItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="SmeltItemSkin",e}return __extends(e,t),e.prototype.init=function(){this.addTouchEvent(this,this.onTap)},e.prototype.dataChanged=function(){this.item.isClick=!1,this.item.data=this.data,-1!=SmeltWin.showItem.indexOf(this.item.data)?this.selectGr.visible=!0:this.selectGr.visible=!1},e.prototype.onTap=function(){},e}(BaseItemRender);__reflect(SmeltItemRender.prototype,"SmeltItemRender");var SmeltWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="SmeltSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.group.visible=!0,this.userItem.isClick=!1,this.smaltItem.isClick=!1},e.prototype.open=function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];t.prototype.open.call(this,i),this.addTouchEvent(this.smeltBtn,this.onTap),this.itemList.itemRenderer=SmeltItemRender,DataEventDispatcher.dispatcher.addEventListener(GameEvent.UPDATE_BAG_DATA,this.onBox,this),e.showItem=[];for(var r=[16777215,255,16711935,16776960,15110456,16767334],s=0;6>s;s++)this.addChangeEvent(this["box"+s],this.onBox),this["box"+s].getChildAt(2).textColor=r[s];this.itemList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onList,this),this.onBox(null),UIDmgr.bindingUID(this.smeltBtn,uid.rl1)},e.prototype.updateList=function(){this.dataList&&(this.itemList.dataProvider=new eui.ArrayCollection(this.dataList),this.updateObtain())},e.prototype.onTap=function(t){switch(t.currentTarget){case this.smeltBtn:this.sendSmelt()}},e.prototype.onBox=function(t){var i=t?t.currentTarget:void 0;if(i){e.selectAr=[];for(var n=0;6>n;n++)this["box"+n].selected&&e.selectAr.push(n)}i&&i instanceof eui.CheckBox||(this.dataList=BagVo.ins().getQualitySmeltList([0])),e.showItem=BagVo.ins().getQualitySmeltList(e.selectAr),this.updateList()},e.prototype.onList=function(t){var i=t.itemRenderer;i.selectGr.visible=!i.selectGr.visible,i.selectGr.visible?e.showItem.push(i.data):e.showItem.splice(e.showItem.indexOf(i.data),1),this.updateObtain()},e.prototype.updateObtain=function(){if(!e.showItem||0==e.showItem.length)return this.userItem.data=null,void(this.smaltItem.data=null);this.userItem.setQuality(1),this.userItem.setIcon("money_6"),this.userItem.setName("升阶石"),this.userItem.setCount(UserVo.ins.reinforcedEquipmentStone),this.smaltItem.setQuality(1),this.smaltItem.setIcon("money_6"),this.smaltItem.setName("升阶石");var t=0;for(var i in e.showItem){var n=e.showItem[i],r=ConfigMgr.gameConfig.equip[n.itemId];t+=r.fenjieEquipmentStone}this.smaltItem.setCount(UserVo.ins.reinforcedEquipmentStone+t)},e.prototype.sendSmelt=function(){if(0==e.showItem.length)return UserTips.ins().showTipsBigToSmall("没有可熔炼的装备!");var t={};t.uuids=[];for(var i in e.showItem){var n=e.showItem[i];t.uuids.push(n.uuid)}HttpMgr.ins.sendMessage(ClientPacket.S_10012,t,ServerPacket.LOGIC_URL,!0)},e.selectAr=[],e}(BaseEuiView);__reflect(SmeltWin.prototype,"SmeltWin"),ViewManager.ins().reg(SmeltWin,LayerManager.UI_MainUI);var ActivityItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityItemSkin",e.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){HttpMgr.ins.sendMessage(ClientPacket.S_10032,{activityId:e.data.activityId,activityIndex:e.itemIndex+1},ServerPacket.LOGIC_URL,!0)},e),e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.dg.itemRenderer=BaseItem},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.dg.dataProvider=new eui.ArrayCollection(ActivetyMgr.ins().getActivityAwards(this.data)),this.upStatus(!ActivetyMgr.ins().checkAtivityEnd(this.data.activityId,this.itemIndex+1)),this.data.activityId==ActivetyMgr.CONTINUE_LOGIN?this.title.text="持续登陆"+this.data.part1+"天!":this.data.activityId==ActivetyMgr.STAGE_AWARD?this.title.text="关卡达到"+this.data.part1+"层!":this.data.activityId==ActivetyMgr.INVEST_PLAN?this.title.text="重生等级达到"+this.data.part1+"级!":this.title.text="累计消费"+this.data.part1+"!"},e.prototype.upStatus=function(t){-1!=t&&(this.btn.label=t?"领取":"已领取",this.btn.enabled=t,ViewManager.redToTarge(this.btn,t))},e}(eui.ItemRenderer);__reflect(ActivityItem.prototype,"ActivityItem");var AwardShow=function(t){function e(){var e=t.call(this)||this;return e.skinName="AwardShowSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.goldImg.source=ResMgr.getGameItemPng(this.data[0]),this.labGold.text="x"+this.data[1]},e}(eui.ItemRenderer);__reflect(AwardShow.prototype,"AwardShow");var TaskRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="AchieveRenderSkin",e.btn1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){HttpMgr.ins.sendMessage(ClientPacket.S_10027,{taskId:e.data.taskId},ServerPacket.LOGIC_URL,!0)},e),e.items.labName.visible=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){for(t.prototype.dataChanged.call(this);this.g0.numChildren;)this.g0.removeChildAt(0);this.l1.text=this.data.taskTarget;var e=this.getitems();this.items.data=e[0],0==this.data.isReceive?(this.btn1.label="已领取",this.btn1.visible=!0,this.btn.visible=this.btn1.enabled=!1):2==this.data.isReceive?(this.btn.visible=!1,this.btn1.label="领取奖励",this.btn1.enabled=this.btn1.visible=!0):(this.btn1.enabled=this.btn1.visible=!1,this.btn.visible=!0),0==this.itemIndex&&(1==this.data.taskType?UIDmgr.bindingUID(this.btn1,uid.rw1):UIDmgr.bindingUID(this.btn1,uid.cj1)),this.l0.text=this.data.name},e.prototype.getitems=function(){var t,e,i="奖励:",n=this.data.awardGoods.split("#");if(n&&""!=this.data.awardGoods)for(;n.length;)t=n.shift().split(":"),i+=BagVo.ins().getItem(parseInt(t[0])).name,i+="X",i+=t[1]?t[1]:1,i+="  ",e||(e=new ItemInfo,e.itemId=parseInt(t[0]),e.itemNum=t[1]?parseInt(t[1]):1);if(n=this.data.awardCurrency.split("#"),n&&""!=this.data.awardCurrency)for(var r;n.length;)t=n.shift().split(":"),r=new AwardShow,r.data=[t[0],t[1]?parseInt(t[1]):1],this.g0.addChild(r),e||(e=new ItemInfo,e.moneyType=t[0],e.itemNum=0);return[e,i]},e}(eui.ItemRenderer);__reflect(TaskRender.prototype,"TaskRender");var ActivityWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivitySkin",e}return __extends(e,t),e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this.checkRed(),this.addEvent(GameEvent.RED_ACTIVETY,DataEventDispatcher.dispatcher,this.checkRed)},e.prototype.checkRed=function(){for(var t,e=0;4>e;e++)t=this.viewStack.getChildAt(e),ViewManager.redToTarge(this.tabBar.getChildAt(e),RemindMgr.activetyAwards[t.activetyID+""].length)},e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this);for(var i,n=0;n<this.tabBar.numChildren;n++)i=this.tabBar.getChildAt(n),i.name=n+"",i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){e.switchPage(t,parseInt(t.currentTarget.name))},this),0==n&&i.dispatchEventWith(egret.TouchEvent.TOUCH_TAP)},e.prototype.switchPage=function(t,e){this.viewStack.$children.forEach(function(t,i){t.visible=i==e}),this.tabBar.$children.forEach(function(t,i){var n=t;n.currentState=i==e?"down":"up"})},e}(BaseEuiView);__reflect(ActivityWin.prototype,"ActivityWin"),ViewManager.ins().reg(ActivityWin,LayerManager.UI_MainUI);var rewardItemTip=function(t){function e(){var e=t.call(this)||this;return e.skinName="rewardItemTipSkin",e.horizontalCenter=e.verticalCenter=0,e}return __extends(e,t),e.prototype.open=function(){for(var e=this,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];t.prototype.open.call(this,i);var r=Object.assign(ConfigMgr.gameConfig.item,ConfigMgr.gameConfig.gainInfo);this.itemVo=r[i[0]],this.itemVo.description,this.item.source="resource/assets/item/"+this.itemVo.iconID+".png",this.nn.text=this.itemVo.name,this.l3.text=this.itemVo.description,this.btn2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){ViewManager.ins().close(e)},this)},e.getItemAtt=function(t,e){void 0===e&&(e=2);var i;i=2==e?ConfigMgr.gameConfig.equip[t.itemId]:ConfigMgr.gameConfig.gemAttr[t.itemId];var n="";for(var r in i)UserVo.ins.playerAttrInfo[r]&&0!=i[r]&&ConfigMgr.gameConfig.attributeName[r]&&(n+=ConfigMgr.gameConfig.attributeName[r].value+":"+i[r]+PbPlayerAttrInfo.isPercent(r),n+="\n");return n},e.prototype.onTap=function(t){ViewManager.ins().close(this)},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.close.call(this,e)},e}(BaseEuiView);__reflect(rewardItemTip.prototype,"rewardItemTip"),ViewManager.ins().reg(rewardItemTip,LayerManager.UI_Popup);var UserTips=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.showitemTips=function(t){void 0===t&&(t="");var e=ViewManager.ins().open(ItemTips);DelayOptManager.ins().addDelayOptFunction(e,e.showTips,t)},e.prototype.showTipsDownToUp=function(t,e){void 0===t&&(t=""),void 0===e&&(e=!1);var i=ObjectPool.pop("egret.TextField");i.size=24,i.y=GlobalVo.GAME_H/2,e?i.textColor=ColorUtlis.COLOR_RED:i.textColor=ColorUtlis.COLOR_GREEN,i.alpha=0,i.width=500,i.text=t,i.strokeColor=0,i.x=GlobalVo.GAME_W/2-i.width/2,i.stroke=2,i.bold=!0,i.textAlign=egret.HorizontalAlign.CENTER,egret.log(i.textAlign,i.x),LayerManager.UI_Tips.contains(i)||LayerManager.UI_Tips.addChild(i);var n=function(){LayerManager.UI_Tips.contains(i)&&(LayerManager.UI_Tips.removeChild(i),ObjectPool.push(i))},r=function(){egret.Tween.get(i).to({alpha:0},500).call(n,this)};i.visible=!0,egret.Tween.get(i).to({y:i.y-120,alpha:1},800,egret.Ease.backOut).call(r,this)},e.prototype.showTipsLeftOrRight=function(t,e,i){void 0===t&&(t=""),void 0===e&&(e=!1),void 0===i&&(i=!0);var n=ObjectPool.pop("egret.TextField");n.size=24,n.y=GlobalVo.GAME_H/2,e?n.textColor=ColorUtlis.COLOR_RED:n.textColor=ColorUtlis.COLOR_GREEN,n.alpha=0,n.anchorOffsetX=n.anchorOffsetY=0,n.width=500,n.text=t,n.strokeColor=0,i?n.x=-n.width:n.x=GlobalVo.GAME_W,n.stroke=2,n.bold=!0,n.textAlign=egret.HorizontalAlign.CENTER,LayerManager.UI_Tips.contains(n)||LayerManager.UI_Tips.addChild(n),i?egret.Tween.get(n).to({x:GlobalVo.GAME_W/2-n.width/2,alpha:1},300,egret.Ease.sineInOut):egret.Tween.get(n).to({x:GlobalVo.GAME_W/2-n.width/2,alpha:1},300,egret.Ease.sineInOut),egret.setTimeout(function(){i?egret.Tween.get(n).to({x:GlobalVo.GAME_W},300,egret.Ease.sineIn):egret.Tween.get(n).to({x:-n.width},300,egret.Ease.sineIn)},this,1300),egret.setTimeout(function(){LayerManager.UI_Tips.contains(n)&&(LayerManager.UI_Tips.removeChild(n),ObjectPool.push(n))},this,1600)},e.prototype.showTipsFromCenter=function(t,e){void 0===t&&(t=""),void 0===e&&(e=!1);var i=ObjectPool.pop("egret.TextField");i.size=24,i.y=GlobalVo.GAME_H/2,e?i.textColor=ColorUtlis.COLOR_RED:i.textColor=ColorUtlis.COLOR_GREEN,i.alpha=0,i.width=500,i.text=t,i.strokeColor=0,i.x=GlobalVo.GAME_W/2,i.stroke=2,i.bold=!0,i.textAlign=egret.HorizontalAlign.CENTER,LayerManager.UI_Tips.contains(i)||LayerManager.UI_Tips.addChild(i),i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.scaleX=0,i.scaleY=0;var n=function(){LayerManager.UI_Tips.contains(i)&&(LayerManager.UI_Tips.removeChild(i),ObjectPool.push(i))};egret.Tween.get(i).to({scaleX:1,scaleY:1,alpha:1},200),egret.setTimeout(function(){egret.Tween.get(i).to({alpha:0},500).call(n,this)},this,1e3)},e.prototype.showTipsBigToSmall=function(t,e){void 0===t&&(t=""),void 0===e&&(e=!0);var i=ObjectPool.pop("egret.TextField");i.size=24,i.y=GlobalVo.GAME_H/2,e?i.textColor=ColorUtlis.COLOR_RED:i.textColor=ColorUtlis.COLOR_GREEN,i.alpha=0,i.width=500,i.text=t,i.strokeColor=0,i.x=GlobalVo.GAME_W/2,i.stroke=2,i.bold=!0,i.textAlign=egret.HorizontalAlign.CENTER,LayerManager.UI_Tips.contains(i)||LayerManager.UI_Tips.addChild(i),i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.scaleX=4,i.scaleY=4;var n=function(){LayerManager.UI_Tips.contains(i)&&(LayerManager.UI_Tips.removeChild(i),i.anchorOffsetX=i.anchorOffsetY=0,ObjectPool.push(i))};egret.Tween.get(i).to({scaleX:1,scaleY:1,alpha:1},200),egret.setTimeout(function(){egret.Tween.get(i).to({alpha:0},500).call(n,this)},this,1e3)},e}(BaseClass);__reflect(UserTips.prototype,"UserTips");var ItemTips=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.showTips=function(t){var e=new TipsItem;e.bg.visible=!0,e.verticalCenter=400,e.horizontalCenter=0,e.labelText=t,this.addChild(e),this.list.unshift(e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeTip,this);for(var i=this.list.length-1;i>=0;i--){egret.Tween.removeTweens(this.list[i]);var n=egret.Tween.get(this.list[i]);n.to({verticalCenter:-60*i+400},500)}},e}(TipsView);__reflect(ItemTips.prototype,"ItemTips"),ViewManager.ins().reg(ItemTips,LayerManager.UI_Tips);var TipsItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="tips_skin",e}return __extends(e,t),Object.defineProperty(e.prototype,"labelText",{get:function(){return this._labelText},set:function(t){var e=this;this._labelText=t,this.label.textFlow=TextFlowMaker.generateTextFlow(this._labelText),this.bg.width=this.label.width+20,this.bg.height=this.label.height+20,this.bg.x=-10,this.bg.y=-10,this.label.alpha=1,this.bg.y=0,this.label.verticalCenter=-1;var i=egret.Tween.get(this.bg);i.to({y:-30},500).wait(800).to({alpha:0},200).call(function(){e.parent&&e.parent.removeChild(e)},this);var n=egret.Tween.get(this.label);n.to({verticalCenter:-30},500).wait(800).to({alpha:0},200)},enumerable:!0,configurable:!0}),e}(BaseView);__reflect(TipsItem.prototype,"TipsItem");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var TipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="TipsViewSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t[3]&&""!=t[3]?(this.buyBtn1.visible=this.buyBtn2.visible=!0,this.buyBtn0.visible=!1,this.buyBtn1.label=t[0],this.buyBtn2.label=t[3]):(this.buyBtn1.visible=this.buyBtn2.visible=!1,this.buyBtn0.visible=!0,this.buyBtn0.label=t[0]),this.labDesc.text=t[1],this.win1.titleS=t[2]?t[2]:"提示",this.call0=t[4],this.call1=t[5],this.arg=t[6],this.addTouchEvent(this.buyBtn0,this.onTap),this.addTouchEvent(this.buyBtn1,this.onTap),this.addTouchEvent(this.buyBtn2,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.buyBtn0:case this.buyBtn1:this.call0&&this.call0.apply(this.arg);break;default:this.call1&&this.call1.apply(this.arg)}ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(TipsWin.prototype,"TipsWin"),ViewManager.ins().reg(TipsWin,LayerManager.UI_Tips);var VipAwardRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="VipAwardSkin",e.dg.itemRenderer=BaseItem,e.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){console.log("======touch");var i={vipLvl:e.itemIndex+1};HttpMgr.ins.sendMessage(ClientPacket.S_10043,i,ServerPacket.LOGIC_URL,!0)},e),DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20043,function(t){t.data.isSuccess&&(UserVo.ins.vipLvlList.push(t.data.vipLvl),e.upStatus())},e),DataEventDispatcher.dispatcher.addEventListener(GameEvent.UP_PLAYER_PROPERTY+propertyType.vipLevel,e.upStatus,e),e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.dg.dataProvider=new eui.ArrayCollection(ActivetyMgr.ins().getActivityAwards(this.data)),this.upStatus(),this.lvl.text=this.itemIndex+1+""},e.prototype.upStatus=function(){UserVo.ins.vipLevel>=this.itemIndex+1?-1!=UserVo.ins.vipLvlList.indexOf(this.itemIndex+1)?(this.btn.enabled=!1,this.btn.label="已 领 取"):(this.btn.enabled=!0,this.btn.label="领  取"):(this.btn.enabled=!1,this.btn.label="未 达 成")},e}(eui.ItemRenderer);__reflect(VipAwardRender.prototype,"VipAwardRender");var VipWin=function(t){function e(){var i=t.call(this)||this;return i.skinName="VipSkin",e.MAX_VIP_LVL=ConfigMgr.gameConfig.vipBase.length,i.vipList.itemRenderer=VipAwardRender,i.vipList.dataProvider=new eui.ArrayCollection(ConfigMgr.gameConfig.vipBase),i}return __extends(e,t),e.prototype.upVip=function(){var t=UserVo.ins.vipLevel>=e.MAX_VIP_LVL?"VIP达到最大等级":ConfigMgr.gameConfig.vipBase[UserVo.ins.vipLevel].vipDesc;this.labNext.text=t,this.progress.maximum=UserVo.ins.vipLevel>=e.MAX_VIP_LVL?100:ConfigMgr.gameConfig.vipBase[UserVo.ins.vipLevel].payGold,this.progress.value=UserVo.ins.vipExp,this.c.text="当前VIP等级:"+UserVo.ins.vipLevel},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this),this.addEvent(GameEvent.UP_PLAYER_PROPERTY+propertyType.vipLevel,DataEventDispatcher.dispatcher,this.upVip),this.addEvent(GameEvent.UP_PLAYER_PROPERTY+propertyType.vipExp,DataEventDispatcher.dispatcher,this.upVip),this.upVip()},e}(BaseEuiView);__reflect(VipWin.prototype,"VipWin"),ViewManager.ins().reg(VipWin,LayerManager.UI_MainUI);var ArtifactVo=function(t){function e(){var e=t.call(this)||this;return e.equipPos=-1,e.gemPos=-1,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initEvent=function(){DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20018,this.onActivation,this),DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20019,this.onReinforced,this)},e.prototype.sendActivation=function(t){var e={itemId:t};HttpMgr.ins.sendMessage(ClientPacket.S_10018,e,ServerPacket.LOGIC_URL,!0)},e.prototype.onActivation=function(t){t.data.isSuccess&&(UserTips.ins().showTipsBigToSmall("神器激活成功！",!1),this.updateArtList(t.data.itemId))},e.prototype.sendReinforced=function(t){var e={itemId:t};HttpMgr.ins.sendMessage(ClientPacket.S_10019,e,ServerPacket.LOGIC_URL,!0)},e.prototype.onReinforced=function(t){t.data.isSuccess&&(UserTips.ins().showTipsBigToSmall("神器升级成功！",!1),this.updateArtList(t.data.itemId))},e.prototype.updateArtList=function(t){var e=ConfigMgr.gameConfig.artifact;if(UserVo.ins.artifactInfos){for(var i=!1,n=0;n<UserVo.ins.artifactInfos.length;n++){var r=UserVo.ins.artifactInfos[n],s=e[r];if(s.artifactType==e[t].artifactType){AttributeUtlis.attributeMgr(s,!1),UserVo.ins.artifactInfos[n]=t,AttributeUtlis.attributeMgr(e[t+""],!0),i=!0;break}}i||(UserVo.ins.artifactInfos.push(t),AttributeUtlis.attributeMgr(e[t],!0))}else UserVo.ins.artifactInfos=[],UserVo.ins.artifactInfos.push(t),AttributeUtlis.attributeMgr(e[t],!0);DataEventDispatcher.dispatchEventWith(GameEvent.UPDATE_ARTIFACT_WIN,-1)},e.prototype.initArtPropertys=function(t){t=t?t:UserVo.ins;for(var e=ConfigMgr.gameConfig.artifact,i=0;i<t.artifactInfos.length;i++){var n=t.artifactInfos[i],r=e[n];AttributeUtlis.attributeMgr(r,!0,t.playerAttrInfo,t.jobId)}},e.prototype.listSort=function(t,e){return t>e?-1:e>t?1:0},e}(BaseClass);__reflect(ArtifactVo.prototype,"ArtifactVo");var BuffVo=function(){function t(){this.value=0,this.endTime=0,this.triggerCount=0,this.hurtType=-1,this.interval=[]}return t.prototype.reset=function(t,e){this.type=t,this.value=e},t.create=function(e,i){var n;return n=t.pooling.length?t.pooling.shift():new t,t.seed++,n.handle=t.seed,n.reset(e,i),n},t.prototype.destruct=function(){if(this.interval.length=0,this.endTime=0,this.triggerCount=0,this.hurtType=-1,this.effs)for(;this.effs.length;)this.effs.shift().destruct();this.effs=null,t.pooling.push(this)},t.pooling=new Array,t.seed=0,t}();__reflect(BuffVo.prototype,"BuffVo");var BuffType=function(){function t(){}return t.SUSTAIN_HP=1,t}();__reflect(BuffType.prototype,"BuffType");var ComAttribute=function(){function t(){}return t.hurt=1,t.critRatePCT=10,t.hurtPCT=34,t.giddyPCT=35,t.invincible=36,t.thornsPCT=37,t.leechPCT=38,t.intellectHurt=39,t.frost=49,t.sprint=50,t}();__reflect(ComAttribute.prototype,"ComAttribute");var GemVo=function(t){function e(){var e=t.call(this)||this;return e.equipPos=-1,e.gemPos=-1,e.gemAtts=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initEvent=function(){DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20014,this.gemMountResponse,this),DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20017,this.onGemComposeInGrooveResponse,this),DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20015,this.onGemRemoveResponse,this)},e.prototype.sendGemMountRequest=function(t,e){void 0===e&&(e=-1);var i=e;if(-1==e&&(i=this.getGemPos(this.equipPos)),this.gemPos=i,-1!=i){var n={columnLoc:this.equipPos,grooveLoc:i,uuid:t};HttpMgr.ins.sendMessage(ClientPacket.S_10014,n,ServerPacket.LOGIC_URL,!0)}},e.prototype.gemMountResponse=function(t){t.data.isSuccess&&this.updateCurrEquipGem(t.data.itemId)},e.prototype.sendGemRemoveRequest=function(t){HttpMgr.ins.sendMessage(ClientPacket.S_10015,{columnLoc:this.equipPos,grooveLoc:t},ServerPacket.LOGIC_URL)},e.prototype.onGemRemoveResponse=function(t){t.data.isSuccess&&(UserTips.ins().showTipsBigToSmall("成功卸下宝石",!1),this.equipPos=t.data.columnLoc,this.gemPos=t.data.grooveLoc,this.updateCurrEquipGem(0))},e.prototype.sendGemComposeInGrooveResponse=function(t,e){HttpMgr.ins.sendMessage(ClientPacket.S_10017,{columnLoc:t,grooveLoc:e},ServerPacket.LOGIC_URL)},e.prototype.onGemComposeInGrooveResponse=function(t){t.data.isSuccess&&(UserTips.ins().showTipsBigToSmall("宝石升级成功",!1),this.updateCurrEquipGem(t.data.gemId,t.data.columnLoc,t.data.grooveLoc))},e.prototype.getGemPos=function(t){var e=UserVo.ins.Columns[t].gemGrooves.gemGrooves,i=0;for(var n in e){var r=e[n];if(0==r.gemId&&r.isOpen)break;if(!r.isOpen){UserTips.ins().showTipsBigToSmall("没有开启的宝石槽"),i=-1;break}i++}return i},e.prototype.updateCurrEquipGem=function(t,e,i){void 0===e&&(e=this.equipPos),void 0===i&&(i=this.gemPos);var n=UserVo.ins.Columns[e].gemGrooves.gemGrooves;for(var r in n){var s=n[r];if(s.loc==i){if(this.gemAtts[e]&&this.gemAtts[e][i]&&AttributeUtlis.attributeMgr(this.gemAtts[e][i],!1),s.gemId=t,t>0){var a=ConfigMgr.gameConfig.gemAttr[t];this.gemAtts[e]||(this.gemAtts[e]=[]),this.gemAtts[e][i]=a,AttributeUtlis.attributeMgr(a,!0)}else this.gemAtts[e]&&(this.gemAtts[e][i]=null);break}}DataEventDispatcher.dispatchEventWith(GameEvent.UPDATE_GEM_DATA,-1)},e.prototype.addGemAtts=function(t){var e=t?t==UserVo.ins:!0;t=t?t:UserVo.ins;for(var i=t.Columns,n=0;n<i.length;n++){e&&(this.gemAtts[n]=[]);var r=i[n].gemGrooves.gemGrooves;if(r)for(var s=0;s<r.length;s++)if(0!=r[s].gemId){var a=ConfigMgr.gameConfig.gemAttr[r[n].gemId];e&&(this.gemAtts[n][s]=a),AttributeUtlis.attributeMgr(a,!0,t.playerAttrInfo,t.jobId)}else e&&(this.gemAtts[n][s]=null)}},e.prototype.getGemLv=function(t){var e=this.getGemAttr(t);return t-1e3-10*(e.AttrType-100)+1},e.prototype.getGemAttr=function(t){var e,i=ConfigMgr.gameConfig.gemAttr;for(var n in i)if(i[n].id==t){e=i[n];break}return e},e.prototype.upGem=function(t){var e=BagVo.ins().getBagGemList(),i=this.getGemAttr(t.gemId);if(0==i.nextId)return UserTips.ins().showTipsBigToSmall("已达到最高等级");var n=i.AttrType;for(var r in e){var s=e[r],a=this.getGemAttr(s.itemId).AttrType;if(n==a&&s.itemNum>=i.compose-1)return void this.sendGemComposeInGrooveResponse(this.equipPos,t.loc)}UserTips.ins().showTipsBigToSmall("所需宝石数量不足")},e.prototype.isEquipGem=function(t){var e=this.getGemAttr(t),i=UserVo.ins.Columns[this.equipPos].gemGrooves.gemGrooves;
for(var n in i){var r=this.getGemAttr(i[n].gemId);if(r&&r.AttrType==e.AttrType)return r.loc}return-1},e.prototype.getGemType=function(t){for(var i=this.getGemAttr(t),n="",r=0;r<e.GEM_TYPE.length;r++)i[e.GEM_TYPE[r]]>0&&(n+=e.GEM_TYPE_VALUE[r]+"+"+i[e.GEM_TYPE[r]]+"\n");return n},e.GEM_TYPE=["powerQuality","intellectQuality","alacrityQuality","physiqueQuality","attackInit","armorInit","magicAttack","magicArmorInit","critRate","critDamage","blood"],e.GEM_TYPE_VALUE=["力量资质","智力资质","敏捷资质","体力资质","物理攻击","物理防御","魔法攻击","魔法防御","暴击率","暴击伤害","生命值"],e}(BaseClass);__reflect(GemVo.prototype,"GemVo");var GlobalVo=function(){function t(){}return Object.defineProperty(t,"GAME_W",{get:function(){return StageUtils.ins().getWidth()},enumerable:!0,configurable:!0}),Object.defineProperty(t,"GAME_H",{get:function(){return StageUtils.ins().getHeight()},enumerable:!0,configurable:!0}),t.RANK=["","绿","蓝","紫","金","暗金"],t.EQUIPS=["武器","头盔","铠甲","吊坠","手镯","手镯","戒指","戒指","腰带","靴子"],t}();__reflect(GlobalVo.prototype,"GlobalVo");var CdKeyPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return""==e.txt.text?UserTips.ins().showTipsBigToSmall("请输入要兑换的激活码!"):(HttpMgr.ins.sendMessage(ClientPacket.S_10045,{giftCode:e.txt.text},ServerPacket.LOGIC_URL,!0),void(e.txt.text=""))},this)},e}(eui.Component);__reflect(CdKeyPanel.prototype,"CdKeyPanel");var MapVo=function(){function t(){this.flags=[],this.minXYpo=new egret.Point,this.bornPoint=[],this.refreshPoint=[],this.mapNodeArr=[],this.nodePool=[],this.showNode=[]}return Object.defineProperty(t,"ins",{get:function(){return t._ins||(t._ins=new t),t._ins},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mapData",{set:function(t){t.position=0,this.flags.splice(0),t.readDouble(),t.readDouble(),t.readByte(),t.readUTF(),t.readByte(),t.readShort(),t.readByte();var e=t.readDouble(),i=new egret.ByteArray;t.readBytes(i,0,e),this.mapFile=i.readUTF(),this.mapW=i.readShort(),this.mapH=i.readShort(),this.imgW=i.readShort(),this.imgH=i.readShort(),this.gridW=i.readShort(),this.gridH=i.readShort(),this.gridRows=i.readShort(),this.gridCols=i.readShort(),this.imgRows=i.readShort(),this.imgCols=i.readShort(),e=i.readUnsignedInt();for(var n=0;e>n;n++)this.flags.push(i.readByte());this.minXYpo.x=GlobalVo.GAME_W-this.mapW,this.minXYpo.y=GlobalVo.GAME_H-this.mapH,this.miniMapW=this.mapW/DisplayMapEffect.MINMAP_SCALE,this.miniMapH=this.mapH/DisplayMapEffect.MINMAP_SCALE,this.clearMapNode()},enumerable:!0,configurable:!0}),t.prototype.autoChangeDX=function(){if(0==this.order){if(this.refreshDx>=this.refreshPoint.length-1)return this.order=1,this.refreshDx-=1,!0;this.refreshDx++}else 0==this.refreshDx?(this.order=0,this.refreshDx=1):this.refreshDx--;return!1},t.prototype.resetData=function(){this.refreshDx=-1,this.order=0},Object.defineProperty(t.prototype,"data",{set:function(t){for(this.resetData();this.bornPoint.length;)ObjectPool.push(this.bornPoint.pop());for(;this.refreshPoint.length;)ObjectPool.push(this.refreshPoint.pop());var e=ObjectPool.pop("egret.Point"),i=t.bron.split("#");e.x=parseInt(i[0]),e.y=parseInt(i[1]),this.bornPoint.push(e),i=t.point.split("#");for(var n=0;n<i.length/2;n++)e=ObjectPool.pop("egret.Point"),e.x=parseInt(i[2*n]),e.y=parseInt(i[2*n+1]),this.refreshPoint.push(e)},enumerable:!0,configurable:!0}),t.prototype.moveable=function(e,i){var n=e+i*this.gridCols;return e>=this.gridCols?!1:i>=this.gridRows?!1:0==this.flags[n]||0==(this.flags[n]&t.UNWALK)},t.prototype.markNode=function(t,e,i){this.mapNodeArr[t]||(this.mapNodeArr[t]=[]);var n=this.mapNodeArr[t][e];n||(n=this.nodePool.length>0?this.nodePool.pop():new MapNode,this.mapNodeArr[t][e]=n,this.showNode.push(n)),n.mark(i)},t.prototype.unMarkNode=function(t,e,i){if(t&&e&&this.mapNodeArr[t]&&this.mapNodeArr[t][e]){var n=this.mapNodeArr[t][e];n&&n.unMark(i)}},Object.defineProperty(t.prototype,"markNodeCount",{get:function(){for(var t=0,e=0;e<this.mapNodeArr.length;e++)if(this.mapNodeArr[e])for(var i=0;i<this.mapNodeArr[e].length;i++)this.mapNodeArr[e][i]&&0!=this.mapNodeArr[e][i].state&&t++;return t},enumerable:!0,configurable:!0}),t.prototype.clearMapNode=function(){for(;this.showNode.length;)this.showNode[0].reset(),this.nodePool.push(this.showNode.shift());this.mapNodeArr.length=0},t.prototype.mapUNMarkNode=function(t,e,i){void 0===i&&(i=0);for(var n,r=ObjectPool.pop("egret.Point"),s=DisplayMapObject.DIR_LS,a=i>=0?1:Math.abs(i);;){for(n=0;n<s.length;n++)if(r.x=t+s[n].x*a,r.y=e+s[n].y*a,this.moveable(r.x,r.y)&&!this.hasActor(r.x,r.y))return r;if(i>=0){if(a++,a==i)break}else if(a--,0==a)break}return null},t.prototype.hasActor=function(t,e){return this.mapNodeArr[t]&&this.mapNodeArr[t][e]&&0!=this.mapNodeArr[t][e].state},t.prototype.hasOtherHuman=function(t,e){return this.mapNodeArr[t]&&this.mapNodeArr[t][e]&&this.mapNodeArr[t][e].markers[MapNode.PLAYER]>1?!0:!1},t.prototype.isOverlap=function(t,e){return this.mapNodeArr[t][e].entityCount>1},t.prototype.hasItem=function(t,e,i){void 0===i&&(i=!0);var n=this.mapNodeArr[t]&&this.mapNodeArr[t][e]&&(4&this.mapNodeArr[t][e].state)>0;if(!i)return n;if(n)return!0;for(var r=DisplayMapObject.DIR_LS,s=0;s<r.length;s++)if(this.hasItem(t+r[s].x,e+r[s].y,!1))return!0;return!1},t.WALK=0,t.UNWALK=1,t.CROSSED=2,t.PROJECTION=4,t}();__reflect(MapVo.prototype,"MapVo");var MapNode=function(){function t(){this.state=0,this.markers=[]}return t.prototype.reset=function(){this.state=0,this.markers.length=0},Object.defineProperty(t.prototype,"entityCount",{get:function(){for(var e=0,i=0;i<this.markers.length;i++)this.markers[i]&&this.markers[i]!=t.ITEM&&(e+=this.markers[i]);return e},enumerable:!0,configurable:!0}),t.prototype.mark=function(t){this.state|=t,void 0==this.markers[t]?this.markers[t]=1:this.markers[t]=this.markers[t]+1},t.prototype.unMark=function(t){void 0==this.markers[t]?this.markers[t]=0:this.markers[t]>0&&(this.markers[t]=this.markers[t]-1),0==this.markers[t]&&0!=this.state&&(this.state^=t)},t.PLAYER=1,t.MONSTER=2,t.ITEM=4,t}();__reflect(MapNode.prototype,"MapNode");var MonsterVo=function(){function t(e){this.jobId=4,this.playerAttrInfo=new PbPlayerAttrInfo,this.nid=e.monsterModel,this.difficultyFactor=e.difficultyFactor,this.testName=t.TEST_NAME+"",t.TEST_NAME++;var i;if(0!=e.skillId1&&e.skillId1&&""!=e.skillId1&&"0"!=e.skillId1){i=e.skillId1.split("#");var n;this.skillArr=[];for(var r=0;r<i.length;r++)n=new SkillVo(parseInt(i[r]),1),this.skillArr.push(n)}for(var s in e)void 0!=this.playerAttrInfo[s]&&(this.playerAttrInfo[s]=e[s]);this.nHp=this.nMaxHp}return Object.defineProperty(t.prototype,"nMaxHp",{get:function(){return this.playerAttrInfo.blood},enumerable:!0,configurable:!0}),t.TEST_NAME=0,t}();__reflect(MonsterVo.prototype,"MonsterVo");var PbPlayerAttrInfo=function(){function t(){this.power=0,this.intellect=0,this.alacrity=0,this.physique=0,this.powerQuality=0,this.intellectQuality=0,this.alacrityQuality=0,this.physiqueQuality=0,this.attackInit=0,this.armorInit=0,this.magicAttack=0,this.magicArmorInit=0,this.blood=0,this.hitRate=0,this.dodgeRate=0,this.critRate=0,this.critDamage=0,this.attackSpeed=0,this.attackRange=0,this.movingSpeed=0,this.akillDamage=0,this.attackDamage=0,this.damageReduction=0,this.speedAnger=0,this.skillInterval=0,this.skillsConsumption=0,this.fireDamage=0,this.waterDamage=0,this.thunderDamage=0,this.windDamage=0,this.fireDefenses=0,this.waterDefense=0,this.thunderDefense=0,this.windDefense=0,this.rebirthAttributeIncome=0,this.rebirthMaterialIncome=0,this.goldIncreased=0,this.experienceGained=0,this.offHook=0,this.propertyPCT=1,this.bonusDamage=0}return t.isPercent=function(t){return"critRate"==t||"critDamage"==t?"%":""},t.getSpecialAttr=function(t,e,i){switch(void 0===i&&(i=!1),e){case 1:return t.attackInit;case 2:return t.magicAttack;case 3:return i?t.fireDefenses:t.fireDamage;case 4:return i?t.waterDefense:t.waterDamage;case 5:return i?t.thunderDefense:t.thunderDamage;case 6:return i?t.windDefense:t.windDamage}},t}();__reflect(PbPlayerAttrInfo.prototype,"PbPlayerAttrInfo");var RechargeVo=function(t){function e(){var e=t.call(this)||this;return e.buyData=null,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initEvent=function(){DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20034,this.onRechargeOrderRequest,this)},e.prototype.sendRechargeOrderRequest=function(t){this.buyData={mallId:t},HttpMgr.ins.sendMessage(ClientPacket.S_10034,this.buyData,ServerPacket.LOGIC_URL,!0)},e.prototype.onRechargeOrderRequest=function(t){if(egret.log(t.data),t.data.orderId){var e="购买成功 orderId = "+t.data.orderId;UserTips.ins().showTipsBigToSmall(e,!1),egret.log(t.data.orderId)}else UserTips.ins().showTipsBigToSmall("购买失败")},e.prototype.upDateRechargeNum=function(){},e.prototype.getRechargeNum=function(t){return-1},e.prototype.upDateDiamondsNum=function(){},e}(BaseClass);__reflect(RechargeVo.prototype,"RechargeVo");var ShopVo=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initEvent=function(){DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_20013,this.onBuyGoodsRequest,this)},e.prototype.sendBuyGoodsRequest=function(t,e){var i={seqId:t,num:e};this.buyData=i,HttpMgr.ins.sendMessage(ClientPacket.S_10013,i,ServerPacket.LOGIC_URL,!0)},e.prototype.onBuyGoodsRequest=function(t){t.data.isSuccess&&(UserTips.ins().showTipsBigToSmall("购买成功",!1),this.upDateShopNum(t.data.seqId))},e.prototype.upDateShopNum=function(t){if(this.buyData){var e=UserVo.ins.storeInfos,i=!1;for(var n in e){var r=e[n];if(r.seqId==t){e[n].limitPlayerNum++,i=!0;break}}i||UserVo.ins.storeInfos.push({seqId:t,limitPlayerNum:1}),DataEventDispatcher.dispatchEventWith(GameEvent.UP_SHOP_BUY)}},e.prototype.getShopBuyNum=function(t){var e=UserVo.ins.storeInfos,i=this.getStoreItem(t),n=i.limitPlayerNum>0?i.limitPlayerNum:i.limitPlayerDayNum>0?i.limitPlayerDayNum:-1;if(-1==n)return n;for(var r in e){var s=e[r];if(s.seqId==t)return n-s.limitPlayerNum}return n},e.prototype.getStoreItem=function(t){for(var e=ConfigMgr.gameConfig.store,i=0;i<e.length;i++)if(e[i].seqId==t)return e[i]},e}(BaseClass);__reflect(ShopVo.prototype,"ShopVo");var SkillVo=function(){function t(t,e,i,n){this.skillRange=new StdSkillRange,this.actions=[],this.sceneEffect=[],this.unMissileEffects=[],this.skillId=t,this.level=e,this._currentCD=0,void 0!==i&&(this._currentCD=i),void 0!==n&&(this._prevuseTime=n),this.buffHandle=[]}return Object.defineProperty(t.prototype,"level",{get:function(){return this.nlevel},set:function(e){if(this.nlevel=e,this.stdSkill=SkillMgr.skillConfigByID(this.skillId,0>=e?1:e),this.stdSkill){var i;this.skillRange.data=this.stdSkill.skillRange;var n;if(this.actions.length=0,this.stdSkill.actions&&""!=this.stdSkill.actions&&"0"!=this.stdSkill.actions){i=this.stdSkill.actions.split("#");var r;for(n=0;n<i.length;n++)r=new StdSkillAction,r.data=i[n],this.actions.push(r)}else this.actions.length=0;if(this.sceneEffect.length=this.unMissileEffects.length=0,this.stdSkill.playEffect&&""!=this.stdSkill.playEffect&&"0"!=this.stdSkill.playEffect){i=this.stdSkill.playEffect.split("#");var s;for(n=0;n<i.length;n++)s=new StdSkillHitEffect,s.data=i[n],s.type==t.SKILL_EFF_TYPE_1||s.type==t.SKILL_EFF_TYPE_2?this.sceneEffect.push(s):this.unMissileEffects.push(s)}0!=this.stdSkill.disTarge?(i=this.stdSkill.disTarge.split(","),this.needTarge="1"==i[0],this.dis=this.needTarge?parseInt(i[1]):0):this.needTarge=!1,this.stdSkill.HitNum&&""!=this.stdSkill.HitNum&&"0"!=this.stdSkill.HitNum&&0!=this.stdSkill.HitNum?this.HitNum=(this.stdSkill.HitNum+"").split(","):this.HitNum=null,this.initiativeSkill="infinite"==this.stdSkill.duration,this.stdSkill.skillHit&&""!=this.stdSkill.skillHit&&"0"!=this.stdSkill.skillHit?this.skillHit=this.stdSkill.skillHit.split("#"):this.skillHit=null}},enumerable:!0,configurable:!0}),t.prototype.useSkill=function(){this._prevuseTime=GameLogic.ins.gameRunTick,this._currentCD=this._prevuseTime+this.stdSkill.CD,DataEventDispatcher.dispatchEventWith(t.SKILL_DOWN_CD,this)},Object.defineProperty(t.prototype,"prevUseTime",{get:function(){return this._prevuseTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canUse",{get:function(){return this._currentCD<GameLogic.ins.gameRunTick},enumerable:!0,configurable:!0}),t.prototype.resetCD=function(){this._currentCD=GameLogic.ins.gameRunTick},Object.defineProperty(t.prototype,"singleAttack",{get:function(){return 1==this.skillRange.g||1==this.skillRange.w&&1==this.skillRange.h},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"multipleAttack",{get:function(){return this.HitNum?parseInt(this.HitNum[0]):0},enumerable:!0,configurable:!0}),t.SKILL_EFF_TYPE_0=0,t.SKILL_EFF_TYPE_1=1,t.SKILL_EFF_TYPE_2=2,t.SKILL_DOWN_CD="SKILL_DOWN_CD",t}();__reflect(SkillVo.prototype,"SkillVo");var StdSkillAction=function(){function t(){this.effect=0,this.hasDir=0,this.dataArr=["act","effect","hasDir"]}return Object.defineProperty(t.prototype,"data",{set:function(t){for(var e=t.split(","),i=0;i<e.length;i++)this[this.dataArr[i]]=0!=i?parseInt(e[i]):e[i]},enumerable:!0,configurable:!0}),t}();__reflect(StdSkillAction.prototype,"StdSkillAction");var StdSkillHitEffect=function(){function t(){this.effect=0,this.times=1,this.keepTime=-1,this.targeType=1,this.speed=80,this.flag=-1,this.dataArr=["type","effect","targeType","times","keepTime","flag","speed"]}return Object.defineProperty(t.prototype,"data",{set:function(t){for(var e=t.split(","),i=0;i<e.length;i++)this[this.dataArr[i]]=parseInt(e[i])},enumerable:!0,configurable:!0}),t}();__reflect(StdSkillHitEffect.prototype,"StdSkillHitEffect");var StdSkillRange=function(){function t(){}return Object.defineProperty(t.prototype,"data",{set:function(t){if(this.clear(),t&&""!=t&&"0"!=t){var e=t.split(",");switch(e[0]){case"0":this.type=0,this.g=parseInt(e[1]);break;case"1":this.type=1,this.w=parseInt(e[1]),this.h=parseInt(e[2]);break;case"2":this.type=2,this.g=parseInt(e[1])}}},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this.w=this.h=this.g=this.c=null,this.type=-1},t}();__reflect(StdSkillRange.prototype,"StdSkillRange");var UserVo=function(){function t(){this.uuid="",this.userId=0,this.playerId="",this.jobId=0,this.playerName="",this.gold=0,this.diamond=0,this.headId=0,this.exp=0,this.level=0,this.vipLevel=0,this.sex=1,this.playerAttrInfo=null,this.nHp=0,this.rebirthNum=0,this.points=1,this.strengthenArtifactStone=0,this.upgradeSkillsJade=0,this.reinforcedEquipmentStone=0,this.skillTabs=null,this.skillColumn=null,this.fightPower=0,this.Columns=null,this.storeInfos=null,this.sportsMoney=0,this.artifactInfos=null,this.challengeNum=0,this.challengeCount=0,this.playerTaskInfos=null,this.partChallengNumInfos=null,this.refreshPurchaseCount=0,this.offlineRewardInfo=null,this.activityInfos=null,this.drawCardInfo=null,this.vipExp=0,this.vipLvlList=null,this.monthCardInfo=null,this.purchaseInvestment=35,this.guideStep=0,this.isRecharge=!1,this.historyMaxLevel=0,this.historyMaxPointsId=0,this.playerAttrInfo=new PbPlayerAttrInfo}return Object.defineProperty(t,"ins",{get:function(){return null==t._ins&&(t._ins=new t),t._ins},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nMaxHp",{get:function(){return this.playerAttrInfo.blood},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MAX_LVL",{get:function(){return this.historyMaxLevel>this.level?this.historyMaxLevel:this.level},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MAX_POINTS",{get:function(){return this.historyMaxPointsId>this.points?this.historyMaxPointsId:this.points},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){DataEventDispatcher.dispatcher.removeEventListener(ServerPacket.C_30004,this.upFight,this),DataEventDispatcher.dispatcher.removeEventListener(ServerPacket.C_30005,this.upMoney,this)},t.prototype.upFight=function(t){this.upUserVo({fightPower:t.data.fightPower})},t.prototype.upMoney=function(t){var e=MoneyUtils.getPropertyByType(t.data.currencyType),i={};i[e]=t.data.changeNum,this.upUserVo(i),DataEventDispatcher.dispatcher.dispatchEventWith(GameEvent.MONEY_TYPE_CHANGE)},t.prototype.setData=function(e,i){this==t.ins&&(DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_30004,this.upFight,this),DataEventDispatcher.dispatcher.addEventListener(ServerPacket.C_30005,this.upMoney,this));var n=i?i:this;for(var r in e)n[r]=e[r];var s=ConfigMgr.gameConfig.heroAttribute[this.jobId+""];AttributeUtlis.attributeMgr(s,!0,this.playerAttrInfo,this.jobId),this.addLevelPro(this.level),isNaN(this.nHp)&&(this.nHp=this.nMaxHp);var a=this.skillColumn.concat();this.skillColumn=[];for(var o=0;o<a.length;o++)this.skillColumn[a[o].loc]=a[o].skillTab;this.Columns&&(ForgeVo.ins().setEquipAttr(this),GemVo.ins().addGemAtts(this)),this.artifactInfos&&ArtifactVo.ins().initArtPropertys(this),this.offlineRewardInfo&&this==t.ins&&ViewManager.ins().open(OfflineWin,this.offlineRewardInfo),this==t.ins&&(GuideMgr.createAndInit([this.guideStep]),GuideMgr.dispatchTiggerEvent(tigger.points,t.ins.points),GuideMgr.dispatchTiggerEvent(tigger.rebirthNum,t.ins.rebirthNum),GuideMgr.dispatchTiggerEvent(tigger.level,t.ins.level))},t.prototype.addLevelPro=function(t,e){void 0===e&&(e=1);for(var i,n,r,s,a=ConfigMgr.gameConfig.attributesIncrease,o=a.length/3,h=t-e,i=o-1;i>=0;i--)if(s=a[(this.jobId-1)*o+i],s.lvMin<=t)if(t-s.lvMin>=h){for(n=0;h>n;n++)for(r in s)if("heroType"!=r&&"lvMin"!=r&&"lvMax"!=r){var l={};l[""+r]=s[r],AttributeUtlis.attributeMgr(l,!0,this.playerAttrInfo,this.jobId)}}else for(h-=t-a[(this.jobId-1)*o+i].lvMin,n=0;h>n;n++)for(r in s)"heroType"!=r&&"lvMin"!=r&&"lvMax"!=r&&AttributeUtlis.attributeMgr({key:s[r]},!0,this.playerAttrInfo,this.jobId)},t.prototype.levelLimit=function(t,e){return t<=this.rebirthNum&&e<=this.MAX_LVL},t.prototype.upUserVo=function(t){for(var e in t)if(void 0!=this[e]){switch(e){case"level":this.addLevelPro(t[e],this.level),GuideMgr.dispatchTiggerEvent(tigger.level,t[e]);break;case"points":GuideMgr.dispatchTiggerEvent(tigger.points,t[e]);break;case"rebirthNum":GuideMgr.dispatchTiggerEvent(tigger.rebirthNum,t[e])}var i=MoneyUtils.isMoneyType(e);-1!=i&&t[e]>this[e]&&UserTips.ins().showitemTips(MoneyUtils.getMoneyName(MoneyUtils.ALL_MONEY[i])+": +"+(t[e]-this[e]));var n=this[e]!=t[e];this[e]=t[e],n&&DataEventDispatcher.dispatcher.dispatchEventWith(GameEvent.UP_PLAYER_PROPERTY+propertyType[e])}},t.prototype.getTaskInfo=function(t){switch(t){case 1:return this.playerTaskInfos.threadTaskInfos;case 2:return this.playerTaskInfos.dayTaskInfos;default:return this.playerTaskInfos.achieveTaskInfos}},t.prototype.upFbCount=function(t){for(var e=ConfigMgr.gameConfig.partInfo[t.partId],i=0;i<this.partChallengNumInfos.length;i++)if(this.partChallengNumInfos[i].partType==e.partType)return this.partChallengNumInfos[i].partChallengNum=t.partChallengNum,void DataEventDispatcher.dispatcher.dispatchEventWith(GameEvent.UP_PLAYER_PROPERTY+propertyType.partChallengNumInfos)},t.prototype.PK_ROLE_DATA=function(t){for(var e=["playerId","playerName","level","jobId","headId","fightPower","skillTabs","skillColumn","Columns","artifactInfos","sex"],i=["otherPlayerId","otherPlayerName","level","otherJobId","otherHeadId","otherFightPower","skillTabs","skillColumn","Columns","artifactInfos","sex"],n={},r=0;r<e.length;r++)n[e[r]]=t.fightTargetDetailInfo[i[r]];this.setData(n),PVPMgr.ChallegeRank=t.fightTargetDetailInfo.otherRankings},t.NO_GUIDE=!1,t}();__reflect(UserVo.prototype,"UserVo");var propertyType;!function(t){t[t.level=0]="level",t[t.challengeNum=1]="challengeNum",t[t.fightPower=2]="fightPower",t[t.gold=3]="gold",t[t.vipExp=4]="vipExp",t[t.vipLevel=5]="vipLevel",t[t.isRecharge=6]="isRecharge",t[t.partChallengNumInfos=10]="partChallengNumInfos",t[t.rebirthNum=11]="rebirthNum",t[t.points=12]="points"}(propertyType||(propertyType={}));